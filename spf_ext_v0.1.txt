# spf_ext v0.1
# External file editor
# Simon Finch
# https://github.com/spiffin/spf_ext

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMjp7czo0OiJuYW1lIjtzOjc6InNwZl9leHQiO3M6NzoidmVyc2lvbiI7czozOiIwLjEi
O3M6NjoiYXV0aG9yIjtzOjExOiJTaW1vbiBGaW5jaCI7czoxMDoiYXV0aG9yX3VyaSI7czoz
NDoiaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dCI7czoxMToiZGVzY3JpcHRp
b24iO3M6MjA6IkV4dGVybmFsIGZpbGUgZWRpdG9yIjtzOjU6Im9yZGVyIjtzOjE6IjUiO3M6
NDoidHlwZSI7czoxOiIzIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6ODoidGV4dHBhY2siO3M6
NTg3OiIjQHNwZl9leHQKc3BmX2V4dF9maWxlcyA9PiBFeHRlcm5hbCBGaWxlcwpzcGZfZXh0
X2RpciA9PiBFeHRlcm5hbCBmaWxlcyBkaXJlY3RvcnkKc3BmX2ZpbGVuYW1lID0+IEZpbGVu
YW1lCnNwZl9lZGl0X2ZpbGUgPT4gWW91IGFyZSBlZGl0aW5nIGZpbGUKc3BmX2FsbF9maWxl
cyA9PiBBbGwgRmlsZXMKc3BmX2ZpbGVfdXBkYXRlZCA9PiBGaWxlIDxzdHJvbmc+e25hbWV9
PC9zdHJvbmc+IHVwZGF0ZWQuCnNwZl9maWxlX25hbWUgPT4gRXh0ZXJuYWwgZmlsZSBuYW1l
CnNwZl9jb3B5X2ZpbGUgPT4gJiM4MjMwO29yIGNvcHkgZmlsZSBhcwpzcGZfY3JlYXRlX25l
d19maWxlID0+IENyZWF0ZSBuZXcgZmlsZQpzcGZfZmlsZV9jcmVhdGVkID0+IEZpbGUgPHN0
cm9uZz57bmFtZX08L3N0cm9uZz4gY3JlYXRlZC4Kc3BmX2ZpbGVfbmFtZV9yZXF1aXJlZCA9
PiBQbGVhc2UgcHJvdmlkZSBhIG5hbWUgZm9yIHlvdXIgZmlsZS4Kc3BmX2ZpbGVfZXhpc3Rz
ID0+IEZpbGUgPHN0cm9uZz57bmFtZX08L3N0cm9uZz4gYWxyZWFkeSBleGlzdHMuCnNwZl9m
aWxlX2RlbGV0ZWQgPT4gRmlsZSA8c3Ryb25nPntuYW1lfTwvc3Ryb25nPiBkZWxldGVkLiI7
czo0OiJoZWxwIjtzOjMyNzA6IjxoMT5FeHRlcm5hbCBmaWxlIGVkaXRvcjwvaDE+Cgo8cD5D
cmVhdGUsIGVkaXQgYW5kIGRlbGV0ZSBleHRlcm5hbCAodG8gVGV4dHBhdHRlcm4pIGZpbGVz
IGluIFRleHRwYXR0ZXJuIGFkbWluLjwvcD4KCjxwPlJFUVVJUkVTOiBUZXhwYXR0ZXJuIDQu
NC4xIGFuZCBQSFAgNSBhbmQgc2hlbGwgYWNjZXNzIChmb3Igc3ltLWxpbmtpbmcgZXhpc3Rp
bmcgZmlsZXMpLjwvcD4KCjxwPjxzdHJvbmc+UGxlYXNlIHJlYWQgdGhlIGluc3RydWN0aW9u
cyBhbmQgbm90ZXMgYmVsb3cgYmVmb3JlIHVzZS48L3N0cm9uZz48L3A+Cgo8cD5MYXRlc3Qg
dmVyc2lvbjogPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dCI+
c3BmX2V4dCBHaXRIdWIgcmVwb3NpdG9yeTwvYT4uPC9wPgoKPHA+VGhpcyBwbHVnaW4gY3Jl
YXRlcyBleHRlcm5hbCBmaWxlcyB5b3UgY2FuIG1hbmFnZSBhbmQgZWRpdCB2aWEgdGhlIGFk
bWluIGludGVyZmFjZS4gQWxsIGZpbGVzIGFyZSBzYXZlZCB0byB0aGUgZGlyZWN0b3J5IHlv
dSBjcmVhdGUgaW4gc3RlcCAxIG9mIHRoZSBpbnN0cnVjdGlvbnMgYmVsb3cuIFN5bnRheCBo
aWdobGlnaHRpbmcgaXMgYXZhaWxhYmxlIHZpYSB0aGUgPGEgaHJlZj0iaHR0cHM6Ly9naXRo
dWIuY29tL3NwaWZmaW4vQ29kZU1pcnJvclRleHRwYXR0ZXJuIj5Db2RlbWlycm9yIGFkbWlu
IHRoZW1lPC9hPiAoY3VycmVudGx5IEhUTUwsIFBIUCBhbmQgSmF2YVNjcmlwdCAtIG1vcmUg
dG8gY29tZSkuPC9wPgoKPGJyIC8+CjxociAvPgo8YnIgLz4KCjxoMz5XaHk/PC9oMz4KCjx1
bD4KCjxsaT5UaGlzIHBsdWdpbiBhbGxvd3MgeW91IHRvIGVkaXQgYW5kIG1hbmFnZSBzaXRl
IGZpbGVzIHJlc2lkaW5nIG91dHNpZGUgVGV4dHBhdHRlcm4gd2l0aGluIHRoZSBUZXh0cGF0
dGVybiBhZG1pbiBhcmVhIChzZWUgJ1Byb2NlZHVyZSBmb3IgbWFuYWdpbmcgZXhpc3Rpbmcg
ZmlsZXMnIGJlbG93KS48L2xpPgoKPGxpPkl0IG9mZmVycyBhbiBlYXN5IHdheSB0byBjcmVh
dGUgc3RhdGljIGZpbGVzIHlvdSBjYW4gZWRpdCBhbmQgYWNjZXNzIHZpYSB5b3VyIHBhZ2Ug
dGVtcGxhdGVzOiA8Y29kZT4mbHQ7dHhwOnNpdGVfdXJsIC8mZ3Q7ZXh0X2ZpbGVzL3lvdXJm
aWxlLmh0bWw8L2NvZGU+PC9saT4KCjwvdWw+Cgo8YnIgLz4KPGhyIC8+CjxiciAvPgoKCTxo
Mz5JbnN0cnVjdGlvbnM6PC9oMz4KCTxvbD4KCQk8bGk+Q3JlYXRlIGEgZGlyZWN0b3J5IGZv
ciB0aGUgc3RhdGljIGV4dGVybmFsIGZpbGVzIGluIHRoZSByb290IG9mIHlvdXIgdGV4dHBh
dHRlcm4gaW5zdGFsbGF0aW9uIGNhbGxlZCAnZXh0X2ZpbGVzJyAob3Igd2hhdGV2ZXIgeW91
IGxpa2UpLiBZb3Ugc2hvdWxkIG1ha2Ugc3VyZSB0aGF0IFBIUCBpcyBhYmxlIHRvIHdyaXRl
IHRvIHRoYXQgZGlyZWN0b3J5LjwvbGk+CgkJPGxpPlZpc2l0IHRoZSA8YSBocmVmPSJpbmRl
eC5waHA/ZXZlbnQ9cHJlZnMmYW1wO3N0ZXA9YWR2YW5jZWRfcHJlZnMiPmFkdmFuY2VkIHBy
ZWZlcmVuY2VzPC9hPiBhbmQgbWFrZSBzdXJlIHRoZSAmIzgyMjA7RXh0ZXJuYWwgZmlsZXMg
ZGlyZWN0b3J5JiM4MjIxOyBwcmVmZXJlbmNlIGNvbnRhaW5zIHRoZSBkaXJlY3RvcnkgeW91
IGNyZWF0ZWQgaW4gc3RlcCAxIChieSBkZWZhdWx0ICdleHRfZmlsZXMnKS4gVGhpcyBwYXRo
IGlzIHJlbGF0aXZlIHBhdGggdG8gdGhlIGRpcmVjdG9yeSBvZiB5b3VyIHJvb3QgVGV4dHBh
dHRlcm4gaW5zdGFsbGF0aW9uLjwvbGk+CgkJPGxpPkFjdGl2YXRlIHRoaXMgcGx1Z2luLjwv
bGk+CgkJPGxpPkdvIHRvIEV4dGVuc2lvbnMgPiBFeHRlcm5hbCBGaWxlcyBhbmQgY3JlYXRl
IGZpbGVzIHlvdSdkIGxpa2UgdG8gbWFuYWdlLjwvbGk+CgkJPGxpPkFsd2F5cyBpbmNsdWRl
IGEgZmlsZSBleHRlbnNpb24gaW4gdGhlIGZpbGUgbmFtZSAoLmh0bWwsIC5waHAsIGV0Yy4p
LjwvbGk+Cgk8L29sPgoKPGJyIC8+CjxociAvPgo8YnIgLz4KCgk8aDM+UHJvY2VkdXJlIGZv
ciBtYW5hZ2luZyBleGlzdGluZyBmaWxlczo8L2gzPgoJPG9sPgoJCTxsaT5Db3B5IHRoZSBj
b250ZW50cyBvZiB0aGUgZmlsZSAoY2FsbGVkIGZvciBleGFtcGxlIG15ZmlsZS5waHApIGlu
dG8gYSBuZXcgZmlsZSBpbiBFeHRlbnNpb25zID4gRXh0ZXJuYWwgRmlsZXMgPiBDcmVhdGUg
bmV3IGZpbGUuPC9saT4KCQk8bGk+TmFtZSB0aGUgbmV3IGZpbGUgKEV4dGVybmFsIGZpbGUg
bmFtZTopICdteWZpbGUucGhwJy48L2xpPgoJCTxsaT5SZW5hbWUgdGhlIG9yaWdpbmFsIGZp
bGUgKHRvLCBmb3IgZXhhbXBsZSwgJ215ZmlsZV9vcmlnaW5hbC5waHAnKSAtIHRoZW4geW91
J2xsIGhhdmUgYSBiYWNrdXAuPC9saT4KCQk8bGk+TWFrZSBhIHN5bWJvbGljIGxpbmssIGlu
IHRoZSBvcmlnaW5hbCBmaWxlIGxvY2F0aW9uLCB0byB0aGUgbmV3IGZpbGUgKGUuZy4gY2Qg
dG8gdGhlICdleHRfZmlsZXMnIGRpcmVjdG9yeSBhbmQgdGhlbiAnbG4gLXMgL29yaWdpbmFs
X2RpcmVjdG9yeV9wYXRoL215ZmlsZS5waHAgLi9teWZpbGUucGhwJykuPC9saT4KCTwvb2w+
Cgo8YnIgLz4KPGhyIC8+CjxiciAvPgoKCTxoMz5Ob3Rlczo8L2gzPgogICAgICAgIDxvbD4K
ICAgICAgICA8bGk+WW91IGNhbiBvbmx5IG1hbmFnZSBmaWxlcyB3aGljaCBhcmUgcmVhZC93
cml0ZSB0byB5b3VyIHdlYiBzZXJ2ZXIgKGkuZS4gd2l0aGluIHlvdXIgd2ViIHJvb3QpIC0g
ZS5nLiBNaW5pZnkgY29uZmlnIGZpbGVzLCBleHRlcm5hbCBzY3JpcHRzPC9saT4KCiAgICAg
ICAgPGxpPkRlbGV0aW5nIGEgZmlsZSB2aWEgdGhlIEV4dGVybmFsIEZpbGVzIHRhYiBkZWxl
dGVzIHRoZSBhY3R1YWwgZmlsZSAoYXMgd2VsbCBhcyB0aGUgZGF0YWJhc2UgZW50cnkpIC0g
dXNlIHdpdGggY2FyZSEuPC9wPgogICAgICAgIDwvb2w+Cgo8YnIgLz4KPGhyIC8+CjxiciAv
PgoKICAgICAgICA8aDM+TGFuZ3VhZ2VzIChUZXh0cGFjayk8L2gzPgoKICAgICAgICA8cD5U
aGlzIHBsdWdpbiBpbnN0YWxscyBhbiBFbmdsaXNoIFRleHRwYWNrIGJ5IGRlZmF1bHQuPC9w
PgogICAgICAgIDxwPlRvIGluc3RhbGwgYSBUZXh0cGFjayBmb3IgeW91ciBvd24gbGFuZ3Vh
Z2Ugc2VlIHRoZSA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vc3BpZmZpbi9zcGZfZXh0
L2Jsb2IvbWFzdGVyL3NwZl9leHRfdGV4dHBhY2sudHh0Ij5pbnN0cnVjdGlvbnMgb24gR2l0
SHViPC9hPi48L3A+Cgo8YnIgLz4KPGhyIC8+CjxiciAvPgoKICAgICAgICA8aDM+VmVyc2lv
biBoaXN0b3J5PC9oMz4KCjAuMSAtIEFwcmlsIDIwMTIgLSBmaXJzdCByZWxlYXNlLiI7czo0
OiJjb2RlIjtzOjg1Njg6Ii8qKgogKiBzcGZfZXh0IC0gRXh0ZXJuYWwgZmlsZSBlZGl0b3Ig
Zm9yIFRleHRwYXR0ZXJuCiAqCiAqIMKpIDIwMTIgU2ltb24gRmluY2ggLSBodHRwczovL2dp
dGh1Yi5jb20vc3BpZmZpbi9zcGZfZXh0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIEdOVSBHZW5l
cmFsIFB1YmxpYyBMaWNlbnNlIHZlcnNpb24gMgogKiBodHRwOi8vd3d3LmdudS5vcmcvbGlj
ZW5zZXMvZ3BsLTIuMC5odG1sCiAqCiAqIFZlcnNpb24gMC4xIC0tIDI4IEFwcmlsIDIwMTIK
ICovCgovKioKICogU2V0dXAgdGFicyBhbmQgY2FsbGJhY2sKICovCgppZiAoQHR4cGludGVy
ZmFjZSA9PSAnYWRtaW4nKSB7CgogICAgYWRkX3ByaXZzKCdzcGZfZXh0JywgJzEnKTsKICAg
IHJlZ2lzdGVyX3RhYignZXh0ZW5zaW9ucycsICdzcGZfZXh0JywgZ1R4dCgnc3BmX2V4dF9m
aWxlcycpKTsKICAgIHJlZ2lzdGVyX2NhbGxiYWNrKCdzcGZfZXh0X2d1aScsICdzcGZfZXh0
Jyk7CiAgICByZWdpc3Rlcl9jYWxsYmFjaygnc3BmX2V4dF9pbnN0YWxsJywgJ3BsdWdpbl9s
aWZlY3ljbGUuc3BmX2V4dCcpOwoKfQoKLyoqCiAqIEdVSSBmdW5jdGlvbnMgLyBzdGVwIGRp
c3BhdGNoZXIKICovCgpmdW5jdGlvbiBzcGZfZXh0X2d1aSgpIHsKCiAgICBnbG9iYWwgJGV2
ZW50LCAkc3RlcDsKCiAgICBpZiAoJGV2ZW50ID09ICdzcGZfZXh0JykgewogICAgICAgIHJl
cXVpcmVfcHJpdnMoJ3NwZl9leHQnKTsKCiAgICAgICAgYm91bmNlcigkc3RlcCwKICAgICAg
ICAgICAgYXJyYXkoCiAgICAgICAgICAgICAgICAnc3BmX2V4dF9lZGl0X3JhdycgICA9PiBm
YWxzZSwKICAgICAgICAgICAgICAgICdwb3VyJyAgICAgICAgICAgICAgPT4gZmFsc2UsCiAg
ICAgICAgICAgICAgICAnc3BmX2V4dF9zYXZlJyAgICAgICA9PiB0cnVlLAogICAgICAgICAg
ICAgICAgJ3NwZl9leHRfY29weScgICAgICAgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdz
cGZfZXh0X2RlbGV0ZScgICAgID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3BmX2V4dF9l
ZGl0JyAgICAgICA9PiBmYWxzZSwKICAgICAgICAgICAgKQogICAgICAgICk7CgogICAgICAg
IHN3aXRjaCAoJHN0ZXApIHsKICAgICAgICAgICAgY2FzZSAnJzogc3BmX2V4dF9lZGl0KCk7
ICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdzcGZf
ZXh0X2VkaXRfcmF3Jzogc3BmX2V4dF9lZGl0KCk7ICAgICAgICAgIGJyZWFrOwogICAgICAg
ICAgICBjYXNlICdwb3VyJzogc3BmX2V4dF9lZGl0KCk7ICAgICAgICAgICAgICAgICAgICAg
YnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3NwZl9leHRfc2F2ZSc6IHNwZl9leHRfc2F2ZSgp
OyAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3NwZl9leHRfY29weSc6
IHNwZl9leHRfY29weSgpOyAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug
J3NwZl9leHRfZGVsZXRlJzogc3BmX2V4dF9kZWxldGUoKTsgICAgICAgICAgYnJlYWs7CiAg
ICAgICAgICAgIGNhc2UgJ3NwZl9leHRfZWRpdCc6IHNwZl9leHRfZWRpdCgpOwogICAgICAg
IH0KICAgIH0KfQoKLyoqCiAqIEluc3RhbGxlciBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNw
Zl9leHRfaW5zdGFsbCgkZXZlbnQ9JycsICRzdGVwPScnKSB7CgogICAgZ2xvYmFsICRwcmVm
czsKCiAgICBpZigkc3RlcCA9PSAnZGVsZXRlZCcpIHsKCiAgICAgICAgc2FmZV9kZWxldGUo
CiAgICAgICAgICAgICd0eHBfcHJlZnMnLAogICAgICAgICAgICAibmFtZT0nc3BmX2V4dF9k
aXInIgogICAgICAgICk7CgogICAgICAgIC8vIERvbid0IGRyb3AgdGhlIHRhYmxlIC0ganVz
dCBpbiBjYXNlLi4KICAgICAgICAvL0BzYWZlX3F1ZXJ5KAogICAgICAgIC8vICAgICdEUk9Q
IFRBQkxFIElGIEVYSVNUUyAnLnNhZmVfcGZ4KCdzcGZfZXh0JykKICAgICAgICAvLyk7Cgog
ICAgICAgIC8vIGRlbGV0ZSB0aGUgVGV4dHBhY2sKCiAgICAgICAgc2FmZV9kZWxldGUoCiAg
ICAgICAgICAgICd0eHBfbGFuZycsCiAgICAgICAgICAgICJldmVudCA9ICdzcGZfZXh0JyIK
ICAgICAgICApOwoKICAgICAgICByZXR1cm47CgogICAgfQoKICAgIGlmKCFpc3NldCgkcHJl
ZnNbJ3NwZl9leHRfZGlyJ10pKSB7CgogICAgICAgIHNhZmVfcXVlcnkoCiAgICAgICAgICAg
ICJDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyAiLnNhZmVfcGZ4KCdzcGZfZXh0JykuIiAo
CiAgICAgICAgICAgICAgICBmaWxlbmFtZSB2YXJjaGFyKDI1NSkgTk9UIE5VTEwgZGVmYXVs
dCAnJywKICAgICAgICAgICAgICAgIGNvbnRlbnQgbG9uZ3RleHQgTk9UIE5VTEwsCiAgICAg
ICAgICAgICAgICBQUklNQVJZIEtFWShmaWxlbmFtZSkKICAgICAgICAgICAgKSBDSEFSU0VU
PXV0ZjgiCiAgICAgICAgKTsKCiAgICAgICAgaWYoIXNhZmVfY291bnQoInNwZl9leHQiLCAi
ZmlsZW5hbWU9J2R1bW15LnR4dCciKSkgewoKICAgICAgICAgICAgc2FmZV9pbnNlcnQoInNw
Zl9qcyIsICJmaWxlbmFtZT0nZGVmYXVsdCcsIGNvbnRlbnQ9J0R1bW15IHRleHQgZmlsZS4u
LnlvdSBuZWVkIGF0IGxlYXN0IG9uZSBmaWxlIGhlcmUuJyIpOwoKICAgICAgICB9CgogICAg
ICAgIHNhZmVfaW5zZXJ0KAogICAgICAgICAgICAndHhwX3ByZWZzJywKICAgICAgICAgICAg
InByZWZzX2lkPTEsCiAgICAgICAgICAgIG5hbWU9J3NwZl9leHRfZGlyJywKICAgICAgICAg
ICAgdmFsPSdleHRfZmlsZXMnLAogICAgICAgICAgICB0eXBlPTEsCiAgICAgICAgICAgIGV2
ZW50PSdhZG1pbicsCiAgICAgICAgICAgIGh0bWw9J3RleHRfaW5wdXQnLAogICAgICAgICAg
ICBwb3NpdGlvbj0yMiIKICAgICAgICApOwogICAgfQp9CgovKioKICogTGlzdCBmdW5jdGlv
bgogKi8KCmZ1bmN0aW9uIHNwZl9leHRfbGlzdCgkY3VycmVudCkgewoKICAgICRvdXRbXSA9
IHN0YXJ0VGFibGUoJ2xpc3QnLCAnbGVmdCcpOwoKICAgICRycyA9IHNhZmVfcm93c19zdGFy
dCgnZmlsZW5hbWUnLCAnc3BmX2V4dCcsICIxPTEiKTsKCiAgICBpZiAoJHJzKSB7CgogICAg
ICAgIHdoaWxlICgkYSA9IG5leHRSb3coJHJzKSkgewogICAgICAgICAgICBleHRyYWN0KCRh
KTsKICAgICAgICAgICAgJGVkaXQgPSAoJGN1cnJlbnQgIT0gJGZpbGVuYW1lKSA/IGVMaW5r
KCdzcGZfZXh0JywgJycsICdmaWxlbmFtZScsICRmaWxlbmFtZSwgJGZpbGVuYW1lKSA6IGh0
bWxzcGVjaWFsY2hhcnMoJGZpbGVuYW1lKTsKICAgICAgICAgICAgJGRlbGV0ZSA9ICgkZmls
ZW5hbWUpID8gZExpbmsoJ3NwZl9leHQnLCAnc3BmX2V4dF9kZWxldGUnLCAnZmlsZW5hbWUn
LCAkZmlsZW5hbWUpIDogJyc7CiAgICAgICAgICAgICRvdXRbXSA9IHRyKHRkKCRlZGl0KS50
ZCgkZGVsZXRlKSk7CiAgICAgICAgfQoKICAgICAgICAkb3V0W10gPSAgZW5kVGFibGUoKTsK
CiAgICAgICAgcmV0dXJuIGpvaW4oJycsICRvdXQpOwoKICAgIH0KfQoKLyoqCiAqIEVkaXQg
ZnVuY3Rpb24KICovCgpmdW5jdGlvbiBzcGZfZXh0X2VkaXQoJG1lc3NhZ2U9JycpIHsKCiAg
ICBwYWdldG9wKGdUeHQoJ3NwZl9leHRfZmlsZXMnKSwkbWVzc2FnZSk7CiAgICBnbG9iYWwg
JHN0ZXAsICRwcmVmczsKICAgIHNwZl9leHRfZWRpdF9yYXcoKTsKCn0KCi8qKgogKiBFZGl0
IGZ1bmN0aW9uIChyYXcpCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9lZGl0X3JhdygpIHsKCiAg
ICBnbG9iYWwgJGV2ZW50LCAkc3RlcDsKCiAgICAkZmlyc3QgPSBzYWZlX3JvdygnZmlsZW5h
bWUnLCAnc3BmX2V4dCcsICIxPTEiKTsKICAgICRmaXJzdF9maWxlID0gJGZpcnN0WydmaWxl
bmFtZSddOwoKICAgIGV4dHJhY3QoZ3BzYShhcnJheSgnZmlsZW5hbWUnLCAnbmV3bmFtZScs
ICdjb3B5JywgJ3NhdmVuZXcnKSkpOwoKICAgIGlmICgkc3RlcCA9PSAnc3BmX2V4dF9kZWxl
dGUnIHx8IGVtcHR5KCRmaWxlbmFtZSkgJiYgJHN0ZXAgIT0gJ3BvdXInICYmICEkc2F2ZW5l
dykgewoKICAgICAgICAkZmlsZW5hbWUgPSAkZmlyc3RfZmlsZTsKCiAgICB9CgogICAgZWxz
ZWlmICgoJGNvcHkgfHwgJHNhdmVuZXcpICYmIHRyaW0ocHJlZ19yZXBsYWNlKCcvWzw+JiJc
J10vJywgJycsICRuZXduYW1lKSkpIHsKCiAgICAgICAgJGZpbGVuYW1lID0gJG5ld25hbWU7
CgogICAgfQoKICAgIGlmIChlbXB0eSgkZmlsZW5hbWUpKSB7CgogICAgICAgICRidXR0b25z
ID0gJzxkaXYgY2xhc3M9ImVkaXQtdGl0bGUiPicuCiAgICAgICAgZ1R4dCgnc3BmX2ZpbGVf
bmFtZScpLic6ICcKICAgICAgICAuZklucHV0KCd0ZXh0JywnbmV3bmFtZScsJycsJ2VkaXQn
LCcnLCcnLDIwKS4KICAgICAgICBoSW5wdXQoJ3NhdmVuZXcnLCdzYXZlbmV3JykuCiAgICAg
ICAgJzwvZGl2Pic7CiAgICAgICAgJGZpbGVjb250ZW50ID0gZ3BzKCdzcGZfZXh0Jyk7Cgog
ICAgfSBlbHNlIHsKCiAgICAgICAgJGJ1dHRvbnMgPSAnPGRpdiBjbGFzcz0iZWRpdC10aXRs
ZSI+Jy5nVHh0KCdzcGZfZWRpdF9zY3JpcHQnKS5zcC5zdHJvbmcoaHRtbHNwZWNpYWxjaGFy
cygkZmlsZW5hbWUpKS4nPC9kaXY+JzsKICAgICAgICAkZmlsZWNvbnRlbnQgPSBmZXRjaCgi
Y29udGVudCIsJ3NwZl9leHQnLCdmaWxlbmFtZScsJGZpbGVuYW1lKTsKCiAgICB9CgogICAg
aWYgKCFlbXB0eSgkZmlsZW5hbWUpKSB7CgogICAgICAgICRjb3B5ID0gJzxzcGFuIGNsYXNz
PSJjb3B5LWFzIj48bGFiZWwgZm9yPSJjb3B5LWZpbGUiPicuZ1R4dCgnc3BmX2NvcHlfZmls
ZScpLic8L2xhYmVsPicuc3AuZklucHV0KCd0ZXh0JywgJ25ld25hbWUnLCAnJywgJ2VkaXQn
LCAnJywgJycsICcnLCAnJywgJ2NvcHktZmlsZScpLnNwLgogICAgICAgICAgICBmSW5wdXQo
J3N1Ym1pdCcsICdjb3B5JywgZ1R4dCgnY29weScpLCAnc21hbGxlcmJveCcpLic8L3NwYW4+
JzsKCiAgICB9IGVsc2UgewoKICAgICAgICAkY29weSA9ICcnOwoKICAgIH0KCiAgICAkcmln
aHQgPQogICAgJzxkaXYgaWQ9ImNvbnRlbnRfc3dpdGNoZXIiPicuCiAgICBoZWQoZ1R4dCgn
c3BmX2FsbF9maWxlcycpLDIpLgogICAgZ3JhZihzTGluaygnc3BmX2V4dCcsICdwb3VyJywg
Z1R4dCgnc3BmX2NyZWF0ZV9uZXdfZmlsZScpKSwgJyBjbGFzcz0iYWN0aW9uLWNyZWF0ZSBz
bWFsbGVyYm94IicpLgogICAgc3BmX2V4dF9saXN0KCRmaWxlbmFtZSkuCiAgICAnPC9kaXY+
JzsKCiAgICBlY2hvCiAgICAnPGRpdiBpZD0iJy4kZXZlbnQuJ19jb250YWluZXIiIGNsYXNz
PSJ0eHAtY29udGFpbmVyIHR4cC1lZGl0Ij4nLgogICAgc3RhcnRUYWJsZSgnZWRpdCcpLgog
ICAgdHIoCiAgICAgICAgdGQoCiAgICAgICAgICAgIGZvcm0oCiAgICAgICAgICAgICAgICAn
PGRpdiBpZD0ibWFpbl9jb250ZW50Ij4nLgogICAgICAgICAgICAgICAgJGJ1dHRvbnMuCiAg
ICAgICAgICAgICAgICAnPHRleHRhcmVhIGlkPSJzcGZfZXh0IiBjbGFzcz0iY29kZSIgbmFt
ZT0ic3BmX2V4dCIgY29scz0iNzgiIHJvd3M9IjMyIiBzdHlsZT0ibWFyZ2luLXRvcDogNnB4
OyB3aWR0aDogNzAwcHg7IGhlaWdodDogNTE1cHg7Ij4nLmh0bWxzcGVjaWFsY2hhcnMoJGZp
bGVjb250ZW50KS4nPC90ZXh0YXJlYT4nLmJyLgogICAgICAgICAgICAgICAgZklucHV0KCdz
dWJtaXQnLCcnLGdUeHQoJ3NhdmUnKSwncHVibGlzaCcpLgogICAgICAgICAgICAgICAgZUlu
cHV0KCdzcGZfZXh0Jykuc0lucHV0KCdzcGZfZXh0X3NhdmUnKS4KICAgICAgICAgICAgICAg
IGhJbnB1dCgnZmlsZW5hbWUnLCRmaWxlbmFtZSkKICAgICAgICAgICAgICAgIC4kY29weS4K
ICAgICAgICAgICAgICAgICc8L2Rpdj4nCiAgICAgICAgICAgICwgJycsICcnLCAncG9zdCcs
ICdlZGl0LWZvcm0nLCAnJywgJ3N0eWxlX2Zvcm0nKQogICAgICAgICwgJycsICdjb2x1bW4n
KS4KICAgICAgICB0ZHRsKAogICAgICAgICAgICAkcmlnaHQKICAgICAgICAsICcgY2xhc3M9
ImNvbHVtbiInKQogICAgKS4KICAgIGVuZFRhYmxlKCkuCiAgICAnPC9kaXY+JzsKfQoKLyoq
CiAqIENvcHkgZnVuY3Rpb24KICoKICovCgpmdW5jdGlvbiBzcGZfZXh0X2NvcHkoKSB7Cgog
ICAgZXh0cmFjdChncHNhKGFycmF5KCdvbGRuYW1lJywgJ25ld25hbWUnKSkpOwoKICAgICRj
b250ZW50ID0gZG9TbGFzaChmZXRjaCgnY29udGVudCcsICdzcGZfZXh0JywgJ2ZpbGVuYW1l
JywgJG9sZG5hbWUpKTsKCiAgICAkcnMgPSBzYWZlX2luc2VydCgnc3BmX2V4dCcsICJjb250
ZW50ID0gJyRjb250ZW50JywgZmlsZW5hbWUgPSAnIi5kb1NsYXNoKCRuZXduYW1lKS4iJyIp
OwoKICAgIHNwZl9leHRfZWRpdCgKICAgICAgICBnVHh0KCdzcGZfZmlsZV9jcmVhdGVkJywg
YXJyYXkoJ3tuYW1lfScgPT4gJG5ld25hbWUpKQogICAgKTsKfQoKLyoqCiAqIFNhdmUgZnVu
Y3Rpb24KICovCgpmdW5jdGlvbiBzcGZfZXh0X3NhdmUoKSB7CgogICAgZXh0cmFjdChncHNh
KGFycmF5KCdmaWxlbmFtZScsJ3NwZl9leHQnLCdzYXZlbmV3JywnbmV3bmFtZScsJ2NvcHkn
KSkpOwogICAgJGNvbnRlbnQgPSBkb1NsYXNoKCRzcGZfZXh0KTsKCiAgICBpZiAoJHNhdmVu
ZXcgb3IgJGNvcHkpIHsKCiAgICAgICAgJG5ld25hbWUgPSBkb1NsYXNoKHRyaW0ocHJlZ19y
ZXBsYWNlKCcvWzw+JiJcJ10vJywgJycsIGdwcygnbmV3bmFtZScpKSkpOwoKICAgICAgICBp
ZiAoJG5ld25hbWUgYW5kIHNhZmVfZmllbGQoJ2ZpbGVuYW1lJywgJ3NwZl9leHQnLCAiZmls
ZW5hbWUgPSAnJG5ld25hbWUnIikpIHsKCiAgICAgICAgICAgICRtZXNzYWdlID0gZ1R4dCgn
c3BmX2ZpbGVfZXhpc3RzJywgYXJyYXkoJ3tuYW1lfScgPT4gJG5ld25hbWUpKTsKCiAgICAg
ICAgICAgIGlmICgkc2F2ZW5ldykgewoKICAgICAgICAgICAgICAgICRfUE9TVFsnbmV3bmFt
ZSddID0gJyc7CgogICAgICAgICAgICB9CgogICAgICAgIH0gZWxzZWlmICgkbmV3bmFtZSkg
ewoKICAgICAgICAgICAgc2FmZV9pbnNlcnQoJ3NwZl9leHQnLCAiZmlsZW5hbWUgPSAnIi4k
bmV3bmFtZS4iJywgY29udGVudCA9ICckY29udGVudCciKTsKCiAgICAgICAgICAgICRtZXNz
YWdlID0gZ1R4dCgnc3BmX2ZpbGVfY3JlYXRlZCcsIGFycmF5KCd7bmFtZX0nID0+ICRuZXdu
YW1lKSk7CgogICAgICAgICAgICBzcGZfZXh0X3dyaXRlKCk7CgogICAgICAgIH0gZWxzZSB7
CgogICAgICAgICAgICAkbWVzc2FnZSA9IGFycmF5KGdUeHQoJ3NwZl9maWxlX25hbWVfcmVx
dWlyZWQnKSwgRV9FUlJPUik7CgogICAgICAgIH0KCiAgICAgICAgc3BmX2V4dF9lZGl0KCRt
ZXNzYWdlKTsKCiAgICB9IGVsc2UgewoKICAgICAgICBzYWZlX3VwZGF0ZSgnc3BmX2V4dCcs
ICJjb250ZW50ID0gJyRjb250ZW50JyIsICJmaWxlbmFtZSA9ICciLmRvU2xhc2goJGZpbGVu
YW1lKS4iJyIpOwoKICAgICAgICAkbWVzc2FnZSA9IGdUeHQoJ3NwZl9maWxlX3VwZGF0ZWQn
LCBhcnJheSgne25hbWV9JyA9PiAkZmlsZW5hbWUpKTsKCiAgICAgICAgc3BmX2V4dF93cml0
ZSgpOwoKICAgICAgICBzcGZfZXh0X2VkaXQoJG1lc3NhZ2UpOwoKICAgIH0KCn0KCi8qKgog
KiBXcml0ZSBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNwZl9leHRfd3JpdGUoKSB7CgogICAg
Z2xvYmFsICRwcmVmczsKICAgIGV4dHJhY3QoZ3BzYShhcnJheSgnZmlsZW5hbWUnLCdzcGZf
ZXh0Jywnc2F2ZW5ldycsJ25ld25hbWUnLCdjb3B5JykpKTsKCiAgICAkZmlsZW5hbWUgPSAo
cHMoJ2NvcHknKSBvciBwcygnc2F2ZW5ldycpKSA/IHBzKCduZXduYW1lJykgOiBwcygnZmls
ZW5hbWUnKTsKICAgICRmaWxlID0gJHByZWZzWydwYXRoX3RvX3NpdGUnXS4nLycuJHByZWZz
WydzcGZfZXh0X2RpciddLicvJy4kZmlsZW5hbWU7CgogICAgaWYgKGVtcHR5KCRwcmVmc1sn
c3BmX2V4dF9kaXInXSkgb3IgISRmaWxlbmFtZSkgewoKICAgICAgICByZXR1cm47CgogICAg
fSBlbHNlIHsKCiAgICAkY29udGVudF9yYXcgPSBmZXRjaCgiY29udGVudCIsICJzcGZfZXh0
IiwgJ2ZpbGVuYW1lJywgJGZpbGVuYW1lKTsgLy8gTW92ZWQgaGVyZSB0byBzYXZlIG5ld2x5
LWNyZWF0ZWQgZmlsZXMKCiAgICAgICAgJGhhbmRsZSA9IGZvcGVuKCRmaWxlLCAnd2InKTsK
ICAgICAgICBmd3JpdGUoJGhhbmRsZSwgJGNvbnRlbnRfcmF3KTsKICAgICAgICBmY2xvc2Uo
JGhhbmRsZSk7CiAgICAgICAgY2htb2QoJGZpbGUsIDA2NDQpOwogICAgfQoKfQoKLyoqCiAq
IERlbGV0ZSBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNwZl9leHRfZGVsZXRlKCkgewoKICAg
IGdsb2JhbCAkcHJlZnM7CgogICAgJGZpbGVuYW1lID0gcHMoJ2ZpbGVuYW1lJyk7CiAgICAk
ZmlsZSA9ICRwcmVmc1sncGF0aF90b19zaXRlJ10uJy8nLiRwcmVmc1snc3BmX2V4dF9kaXIn
XS4nLycuJGZpbGVuYW1lOwoKICAgICAgICBpZiAoIWVtcHR5KCRwcmVmc1snc3BmX2V4dF9k
aXInXSkgYW5kICRmaWxlbmFtZSkgewoKICAgICAgICAgICAgc2FmZV9kZWxldGUoJ3NwZl9l
eHQnLCAiZmlsZW5hbWUgPSAnIi5kb1NsYXNoKCRmaWxlbmFtZSkuIiciKTsKCiAgICAgICAg
ICAgIEB1bmxpbmsoJGZpbGUpOwoKICAgICAgICBzcGZfZXh0X2VkaXQoCgogICAgICAgICAg
ICBnVHh0KCdzcGZfZmlsZV9kZWxldGVkJywgYXJyYXkoJ3tuYW1lfScgPT4gJGZpbGVuYW1l
KSkKICAgICAgICApOwoKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKfSI7
czozOiJtZDUiO3M6MzI6IjY5MDljOWNhOGMxYWU5ZTEyNjA2NDc3YjEwOWY0OTI2Ijt9
