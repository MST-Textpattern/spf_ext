# spf_ext v0.1
# External file editor
# Simon Finch
# https://github.com/spiffin/spf_ext

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMjp7czo0OiJuYW1lIjtzOjc6InNwZl9leHQiO3M6NzoidmVyc2lvbiI7czozOiIwLjEi
O3M6NjoiYXV0aG9yIjtzOjExOiJTaW1vbiBGaW5jaCI7czoxMDoiYXV0aG9yX3VyaSI7czoz
NDoiaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dCI7czoxMToiZGVzY3JpcHRp
b24iO3M6MjA6IkV4dGVybmFsIGZpbGUgZWRpdG9yIjtzOjU6Im9yZGVyIjtzOjE6IjUiO3M6
NDoidHlwZSI7czoxOiIzIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6ODoidGV4dHBhY2siO3M6
NTg3OiIjQHNwZl9leHQKc3BmX2V4dF9maWxlcyA9PiBFeHRlcm5hbCBGaWxlcwpzcGZfZXh0
X2RpciA9PiBFeHRlcm5hbCBmaWxlcyBkaXJlY3RvcnkKc3BmX2ZpbGVuYW1lID0+IEZpbGVu
YW1lCnNwZl9lZGl0X2ZpbGUgPT4gWW91IGFyZSBlZGl0aW5nIGZpbGUKc3BmX2FsbF9maWxl
cyA9PiBBbGwgRmlsZXMKc3BmX2ZpbGVfdXBkYXRlZCA9PiBGaWxlIDxzdHJvbmc+e25hbWV9
PC9zdHJvbmc+IHVwZGF0ZWQuCnNwZl9maWxlX25hbWUgPT4gRXh0ZXJuYWwgZmlsZSBuYW1l
CnNwZl9jb3B5X2ZpbGUgPT4gJiM4MjMwO29yIGNvcHkgZmlsZSBhcwpzcGZfY3JlYXRlX25l
d19maWxlID0+IENyZWF0ZSBuZXcgZmlsZQpzcGZfZmlsZV9jcmVhdGVkID0+IEZpbGUgPHN0
cm9uZz57bmFtZX08L3N0cm9uZz4gY3JlYXRlZC4Kc3BmX2ZpbGVfbmFtZV9yZXF1aXJlZCA9
PiBQbGVhc2UgcHJvdmlkZSBhIG5hbWUgZm9yIHlvdXIgZmlsZS4Kc3BmX2ZpbGVfZXhpc3Rz
ID0+IEZpbGUgPHN0cm9uZz57bmFtZX08L3N0cm9uZz4gYWxyZWFkeSBleGlzdHMuCnNwZl9m
aWxlX2RlbGV0ZWQgPT4gRmlsZSA8c3Ryb25nPntuYW1lfTwvc3Ryb25nPiBkZWxldGVkLiI7
czo0OiJoZWxwIjtzOjMyNzA6IjxoMT5FeHRlcm5hbCBmaWxlIGVkaXRvcjwvaDE+Cgo8cD5D
cmVhdGUsIGVkaXQgYW5kIGRlbGV0ZSBleHRlcm5hbCAodG8gVGV4dHBhdHRlcm4pIGZpbGVz
IGluIFRleHRwYXR0ZXJuIGFkbWluLjwvcD4KCjxwPlJFUVVJUkVTOiBUZXhwYXR0ZXJuIDQu
NC4xIGFuZCBQSFAgNSBhbmQgc2hlbGwgYWNjZXNzIChmb3Igc3ltLWxpbmtpbmcgZXhpc3Rp
bmcgZmlsZXMpLjwvcD4KCjxwPjxzdHJvbmc+UGxlYXNlIHJlYWQgdGhlIGluc3RydWN0aW9u
cyBhbmQgbm90ZXMgYmVsb3cgYmVmb3JlIHVzZS48L3N0cm9uZz48L3A+Cgo8cD5MYXRlc3Qg
dmVyc2lvbjogPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dCI+
c3BmX2V4dCBHaXRIdWIgcmVwb3NpdG9yeTwvYT4uPC9wPgoKPHA+VGhpcyBwbHVnaW4gY3Jl
YXRlcyBleHRlcm5hbCBmaWxlcyB5b3UgY2FuIG1hbmFnZSBhbmQgZWRpdCB2aWEgdGhlIGFk
bWluIGludGVyZmFjZS4gQWxsIGZpbGVzIGFyZSBzYXZlZCB0byB0aGUgZGlyZWN0b3J5IHlv
dSBjcmVhdGUgaW4gc3RlcCAxIG9mIHRoZSBpbnN0cnVjdGlvbnMgYmVsb3cuIFN5bnRheCBo
aWdobGlnaHRpbmcgaXMgYXZhaWxhYmxlIHZpYSB0aGUgPGEgaHJlZj0iaHR0cHM6Ly9naXRo
dWIuY29tL3NwaWZmaW4vQ29kZU1pcnJvclRleHRwYXR0ZXJuIj5Db2RlbWlycm9yIGFkbWlu
IHRoZW1lPC9hPiAoY3VycmVudGx5IEhUTUwsIFBIUCBhbmQgSmF2YVNjcmlwdCAtIG1vcmUg
dG8gY29tZSkuPC9wPgoKPGJyIC8+CjxociAvPgo8YnIgLz4KCjxoMz5XaHk/PC9oMz4KCjx1
bD4KCjxsaT5UaGlzIHBsdWdpbiBhbGxvd3MgeW91IHRvIGVkaXQgYW5kIG1hbmFnZSBzaXRl
IGZpbGVzIHJlc2lkaW5nIG91dHNpZGUgVGV4dHBhdHRlcm4gd2l0aGluIHRoZSBUZXh0cGF0
dGVybiBhZG1pbiBhcmVhIChzZWUgJ1Byb2NlZHVyZSBmb3IgbWFuYWdpbmcgZXhpc3Rpbmcg
ZmlsZXMnIGJlbG93KS48L2xpPgoKPGxpPkl0IG9mZmVycyBhbiBlYXN5IHdheSB0byBjcmVh
dGUgc3RhdGljIGZpbGVzIHlvdSBjYW4gZWRpdCBhbmQgYWNjZXNzIHZpYSB5b3VyIHBhZ2Ug
dGVtcGxhdGVzOiA8Y29kZT4mbHQ7dHhwOnNpdGVfdXJsIC8mZ3Q7ZXh0X2ZpbGVzL3lvdXJm
aWxlLmh0bWw8L2NvZGU+PC9saT4KCjwvdWw+Cgo8YnIgLz4KPGhyIC8+CjxiciAvPgoKCTxo
Mz5JbnN0cnVjdGlvbnM6PC9oMz4KCTxvbD4KCQk8bGk+Q3JlYXRlIGEgZGlyZWN0b3J5IGZv
ciB0aGUgc3RhdGljIGV4dGVybmFsIGZpbGVzIGluIHRoZSByb290IG9mIHlvdXIgdGV4dHBh
dHRlcm4gaW5zdGFsbGF0aW9uIGNhbGxlZCAnZXh0X2ZpbGVzJyAob3Igd2hhdGV2ZXIgeW91
IGxpa2UpLiBZb3Ugc2hvdWxkIG1ha2Ugc3VyZSB0aGF0IFBIUCBpcyBhYmxlIHRvIHdyaXRl
IHRvIHRoYXQgZGlyZWN0b3J5LjwvbGk+CgkJPGxpPlZpc2l0IHRoZSA8YSBocmVmPSJpbmRl
eC5waHA/ZXZlbnQ9cHJlZnMmYW1wO3N0ZXA9YWR2YW5jZWRfcHJlZnMiPmFkdmFuY2VkIHBy
ZWZlcmVuY2VzPC9hPiBhbmQgbWFrZSBzdXJlIHRoZSAmIzgyMjA7RXh0ZXJuYWwgZmlsZXMg
ZGlyZWN0b3J5JiM4MjIxOyBwcmVmZXJlbmNlIGNvbnRhaW5zIHRoZSBkaXJlY3RvcnkgeW91
IGNyZWF0ZWQgaW4gc3RlcCAxIChieSBkZWZhdWx0ICdleHRfZmlsZXMnKS4gVGhpcyBwYXRo
IGlzIHJlbGF0aXZlIHBhdGggdG8gdGhlIGRpcmVjdG9yeSBvZiB5b3VyIHJvb3QgVGV4dHBh
dHRlcm4gaW5zdGFsbGF0aW9uLjwvbGk+CgkJPGxpPkFjdGl2YXRlIHRoaXMgcGx1Z2luLjwv
bGk+CgkJPGxpPkdvIHRvIEV4dGVuc2lvbnMgPiBFeHRlcm5hbCBGaWxlcyBhbmQgY3JlYXRl
IGZpbGVzIHlvdSdkIGxpa2UgdG8gbWFuYWdlLjwvbGk+CgkJPGxpPkFsd2F5cyBpbmNsdWRl
IGEgZmlsZSBleHRlbnNpb24gaW4gdGhlIGZpbGUgbmFtZSAoLmh0bWwsIC5waHAsIGV0Yy4p
LjwvbGk+Cgk8L29sPgoKPGJyIC8+CjxociAvPgo8YnIgLz4KCgk8aDM+UHJvY2VkdXJlIGZv
ciBtYW5hZ2luZyBleGlzdGluZyBmaWxlczo8L2gzPgoJPG9sPgoJCTxsaT5Db3B5IHRoZSBj
b250ZW50cyBvZiB0aGUgZmlsZSAoY2FsbGVkIGZvciBleGFtcGxlIG15ZmlsZS5waHApIGlu
dG8gYSBuZXcgZmlsZSBpbiBFeHRlbnNpb25zID4gRXh0ZXJuYWwgRmlsZXMgPiBDcmVhdGUg
bmV3IGZpbGUuPC9saT4KCQk8bGk+TmFtZSB0aGUgbmV3IGZpbGUgKEV4dGVybmFsIGZpbGUg
bmFtZTopICdteWZpbGUucGhwJy48L2xpPgoJCTxsaT5SZW5hbWUgdGhlIG9yaWdpbmFsIGZp
bGUgKHRvLCBmb3IgZXhhbXBsZSwgJ215ZmlsZV9vcmlnaW5hbC5waHAnKSAtIHRoZW4geW91
J2xsIGhhdmUgYSBiYWNrdXAuPC9saT4KCQk8bGk+TWFrZSBhIHN5bWJvbGljIGxpbmssIGlu
IHRoZSBvcmlnaW5hbCBmaWxlIGxvY2F0aW9uLCB0byB0aGUgbmV3IGZpbGUgKGUuZy4gY2Qg
dG8gdGhlICdleHRfZmlsZXMnIGRpcmVjdG9yeSBhbmQgdGhlbiAnbG4gLXMgL29yaWdpbmFs
X2RpcmVjdG9yeV9wYXRoL215ZmlsZS5waHAgLi9teWZpbGUucGhwJykuPC9saT4KCTwvb2w+
Cgo8YnIgLz4KPGhyIC8+CjxiciAvPgoKCTxoMz5Ob3Rlczo8L2gzPgogICAgICAgIDxvbD4K
ICAgICAgICA8bGk+WW91IGNhbiBvbmx5IG1hbmFnZSBmaWxlcyB3aGljaCBhcmUgcmVhZC93
cml0ZSB0byB5b3VyIHdlYiBzZXJ2ZXIgKGkuZS4gd2l0aGluIHlvdXIgd2ViIHJvb3QpIC0g
ZS5nLiBNaW5pZnkgY29uZmlnIGZpbGVzLCBleHRlcm5hbCBzY3JpcHRzPC9saT4KCiAgICAg
ICAgPGxpPkRlbGV0aW5nIGEgZmlsZSB2aWEgdGhlIEV4dGVybmFsIEZpbGVzIHRhYiBkZWxl
dGVzIHRoZSBhY3R1YWwgZmlsZSAoYXMgd2VsbCBhcyB0aGUgZGF0YWJhc2UgZW50cnkpIC0g
dXNlIHdpdGggY2FyZSEuPC9wPgogICAgICAgIDwvb2w+Cgo8YnIgLz4KPGhyIC8+CjxiciAv
PgoKICAgICAgICA8aDM+TGFuZ3VhZ2VzIChUZXh0cGFjayk8L2gzPgoKICAgICAgICA8cD5U
aGlzIHBsdWdpbiBpbnN0YWxscyBhbiBFbmdsaXNoIFRleHRwYWNrIGJ5IGRlZmF1bHQuPC9w
PgogICAgICAgIDxwPlRvIGluc3RhbGwgYSBUZXh0cGFjayBmb3IgeW91ciBvd24gbGFuZ3Vh
Z2Ugc2VlIHRoZSA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vc3BpZmZpbi9zcGZfZXh0
L2Jsb2IvbWFzdGVyL3NwZl9leHRfdGV4dHBhY2sudHh0Ij5pbnN0cnVjdGlvbnMgb24gR2l0
SHViPC9hPi48L3A+Cgo8YnIgLz4KPGhyIC8+CjxiciAvPgoKICAgICAgICA8aDM+VmVyc2lv
biBoaXN0b3J5PC9oMz4KCjAuMSAtIEFwcmlsIDIwMTIgLSBmaXJzdCByZWxlYXNlLiI7czo0
OiJjb2RlIjtzOjc5NjU6Ii8qKgogKiBzcGZfZXh0IC0gRXh0ZXJuYWwgZmlsZSBlZGl0b3Ig
Zm9yIFRleHRwYXR0ZXJuCiAqCiAqIMKpIDIwMTIgU2ltb24gRmluY2ggLSBodHRwczovL2dp
dGh1Yi5jb20vc3BpZmZpbi9zcGZfZXh0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIEdOVSBHZW5l
cmFsIFB1YmxpYyBMaWNlbnNlIHZlcnNpb24gMgogKiBodHRwOi8vd3d3LmdudS5vcmcvbGlj
ZW5zZXMvZ3BsLTIuMC5odG1sCiAqCiAqIFZlcnNpb24gMC4xIC0tIDI4IEFwcmlsIDIwMTIK
ICovCgovKioKICogU2V0dXAgdGFicyBhbmQgY2FsbGJhY2sKICovCgppZiAoQHR4cGludGVy
ZmFjZSA9PSAnYWRtaW4nKSB7CgogICAgYWRkX3ByaXZzKCdzcGZfZXh0JywgJzEnKTsKICAg
IHJlZ2lzdGVyX3RhYignZXh0ZW5zaW9ucycsICdzcGZfZXh0JywgZ1R4dCgnc3BmX2V4dF9m
aWxlcycpKTsKICAgIHJlZ2lzdGVyX2NhbGxiYWNrKCdzcGZfZXh0X2d1aScsICdzcGZfZXh0
Jyk7CiAgICByZWdpc3Rlcl9jYWxsYmFjaygnc3BmX2V4dF9pbnN0YWxsJywgJ3BsdWdpbl9s
aWZlY3ljbGUuc3BmX2V4dCcpOwoKfQoKLyoqCiAqIEdVSSBmdW5jdGlvbnMgLyBzdGVwIGRp
c3BhdGNoZXIKICovCgpmdW5jdGlvbiBzcGZfZXh0X2d1aSgpIHsKCiAgICBnbG9iYWwgJGV2
ZW50LCAkc3RlcDsKCiAgICBpZiAoJGV2ZW50ID09ICdzcGZfZXh0JykgewogICAgICAgIHJl
cXVpcmVfcHJpdnMoJ3NwZl9leHQnKTsKCiAgICAgICAgYm91bmNlcigkc3RlcCwKICAgICAg
ICAgICAgYXJyYXkoCiAgICAgICAgICAgICAgICAnc3BmX2V4dF9lZGl0X3JhdycgICA9PiBm
YWxzZSwKICAgICAgICAgICAgICAgICdwb3VyJyAgICAgICAgICAgICAgPT4gZmFsc2UsCiAg
ICAgICAgICAgICAgICAnc3BmX2V4dF9zYXZlJyAgICAgICA9PiB0cnVlLAogICAgICAgICAg
ICAgICAgJ3NwZl9leHRfY29weScgICAgICAgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdz
cGZfZXh0X2RlbGV0ZScgICAgID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3BmX2V4dF9l
ZGl0JyAgICAgICA9PiBmYWxzZSwKICAgICAgICAgICAgKQogICAgICAgICk7CgogICAgICAg
IHN3aXRjaCAoJHN0ZXApIHsKICAgICAgICAgICAgY2FzZSAnJzogc3BmX2V4dF9lZGl0KCk7
ICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdzcGZf
ZXh0X2VkaXRfcmF3Jzogc3BmX2V4dF9lZGl0KCk7ICAgICAgICAgIGJyZWFrOwogICAgICAg
ICAgICBjYXNlICdwb3VyJzogc3BmX2V4dF9lZGl0KCk7ICAgICAgICAgICAgICAgICAgICAg
YnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3NwZl9leHRfc2F2ZSc6IHNwZl9leHRfc2F2ZSgp
OyAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3NwZl9leHRfY29weSc6
IHNwZl9leHRfY29weSgpOyAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug
J3NwZl9leHRfZGVsZXRlJzogc3BmX2V4dF9kZWxldGUoKTsgICAgICAgICAgYnJlYWs7CiAg
ICAgICAgICAgIGNhc2UgJ3NwZl9leHRfZWRpdCc6IHNwZl9leHRfZWRpdCgpOwogICAgICAg
IH0KICAgIH0KfQoKLyoqCiAqIEluc3RhbGxlciBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNw
Zl9leHRfaW5zdGFsbCgkZXZlbnQ9JycsICRzdGVwPScnKSB7CgogICAgZ2xvYmFsICRwcmVm
czsKCiAgICBpZighaXNzZXQoJHByZWZzWydzcGZfZXh0X2RpciddKSkgewoKICAgICAgICBz
YWZlX3F1ZXJ5KAogICAgICAgICAgICAiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgIi5z
YWZlX3BmeCgnc3BmX2V4dCcpLiIgKAogICAgICAgICAgICAgICAgZmlsZW5hbWUgdmFyY2hh
cigyNTUpIE5PVCBOVUxMIGRlZmF1bHQgJycsCiAgICAgICAgICAgICAgICBjb250ZW50IGxv
bmd0ZXh0IE5PVCBOVUxMLAogICAgICAgICAgICAgICAgUFJJTUFSWSBLRVkoZmlsZW5hbWUp
CiAgICAgICAgICAgICkgQ0hBUlNFVD11dGY4IgogICAgICAgICk7CgogICAgICAgIHNhZmVf
aW5zZXJ0KAogICAgICAgICAgICAndHhwX3ByZWZzJywKICAgICAgICAgICAgInByZWZzX2lk
PTEsCiAgICAgICAgICAgIG5hbWU9J3NwZl9leHRfZGlyJywKICAgICAgICAgICAgdmFsPSdl
eHRfZmlsZXMnLAogICAgICAgICAgICB0eXBlPTEsCiAgICAgICAgICAgIGV2ZW50PSdhZG1p
bicsCiAgICAgICAgICAgIGh0bWw9J3RleHRfaW5wdXQnLAogICAgICAgICAgICBwb3NpdGlv
bj0yMiIKICAgICAgICApOwogICAgfQp9CgovKioKICogTGlzdCBmdW5jdGlvbgogKi8KCmZ1
bmN0aW9uIHNwZl9leHRfbGlzdCgkY3VycmVudCkgewoKICAgICRvdXRbXSA9IHN0YXJ0VGFi
bGUoJ2xpc3QnLCAnbGVmdCcpOwoKICAgICRycyA9IHNhZmVfcm93c19zdGFydCgnZmlsZW5h
bWUnLCAnc3BmX2V4dCcsICIxPTEiKTsKCiAgICBpZiAoJHJzKSB7CgogICAgICAgIHdoaWxl
ICgkYSA9IG5leHRSb3coJHJzKSkgewogICAgICAgICAgICBleHRyYWN0KCRhKTsKICAgICAg
ICAgICAgJGVkaXQgPSAoJGN1cnJlbnQgIT0gJGZpbGVuYW1lKSA/IGVMaW5rKCdzcGZfZXh0
JywgJycsICdmaWxlbmFtZScsICRmaWxlbmFtZSwgJGZpbGVuYW1lKSA6IGh0bWxzcGVjaWFs
Y2hhcnMoJGZpbGVuYW1lKTsKICAgICAgICAgICAgJGRlbGV0ZSA9ICgkZmlsZW5hbWUpID8g
ZExpbmsoJ3NwZl9leHQnLCAnc3BmX2V4dF9kZWxldGUnLCAnZmlsZW5hbWUnLCAkZmlsZW5h
bWUpIDogJyc7CiAgICAgICAgICAgICRvdXRbXSA9IHRyKHRkKCRlZGl0KS50ZCgkZGVsZXRl
KSk7CiAgICAgICAgfQoKICAgICAgICAkb3V0W10gPSAgZW5kVGFibGUoKTsKCiAgICAgICAg
cmV0dXJuIGpvaW4oJycsICRvdXQpOwoKICAgIH0KfQoKLyoqCiAqIEVkaXQgZnVuY3Rpb24K
ICovCgpmdW5jdGlvbiBzcGZfZXh0X2VkaXQoJG1lc3NhZ2U9JycpIHsKCiAgICBwYWdldG9w
KGdUeHQoJ3NwZl9leHRfZmlsZXMnKSwkbWVzc2FnZSk7CiAgICBnbG9iYWwgJHN0ZXAsICRw
cmVmczsKICAgIHNwZl9leHRfZWRpdF9yYXcoKTsKCn0KCi8qKgogKiBFZGl0IGZ1bmN0aW9u
IChyYXcpCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9lZGl0X3JhdygpIHsKCiAgICBnbG9iYWwg
JGV2ZW50LCAkc3RlcDsKCiAgICAkZmlyc3QgPSBzYWZlX3JvdygnZmlsZW5hbWUnLCAnc3Bm
X2V4dCcsICIxPTEiKTsKICAgICRmaXJzdF9maWxlID0gJGZpcnN0WydmaWxlbmFtZSddOwoK
ICAgIGV4dHJhY3QoZ3BzYShhcnJheSgnZmlsZW5hbWUnLCAnbmV3bmFtZScsICdjb3B5Jywg
J3NhdmVuZXcnKSkpOwoKICAgIGlmICgkc3RlcCA9PSAnc3BmX2V4dF9kZWxldGUnIHx8IGVt
cHR5KCRmaWxlbmFtZSkgJiYgJHN0ZXAgIT0gJ3BvdXInICYmICEkc2F2ZW5ldykgewoKICAg
ICAgICAkZmlsZW5hbWUgPSAkZmlyc3RfZmlsZTsKCiAgICB9CgogICAgZWxzZWlmICgoJGNv
cHkgfHwgJHNhdmVuZXcpICYmIHRyaW0ocHJlZ19yZXBsYWNlKCcvWzw+JiJcJ10vJywgJycs
ICRuZXduYW1lKSkpIHsKCiAgICAgICAgJGZpbGVuYW1lID0gJG5ld25hbWU7CgogICAgfQoK
ICAgIGlmIChlbXB0eSgkZmlsZW5hbWUpKSB7CgogICAgICAgICRidXR0b25zID0gJzxkaXYg
Y2xhc3M9ImVkaXQtdGl0bGUiPicuCiAgICAgICAgZ1R4dCgnc3BmX2ZpbGVfbmFtZScpLic6
ICcKICAgICAgICAuZklucHV0KCd0ZXh0JywnbmV3bmFtZScsJycsJ2VkaXQnLCcnLCcnLDIw
KS4KICAgICAgICBoSW5wdXQoJ3NhdmVuZXcnLCdzYXZlbmV3JykuCiAgICAgICAgJzwvZGl2
Pic7CiAgICAgICAgJGZpbGVjb250ZW50ID0gZ3BzKCdzcGZfZXh0Jyk7CgogICAgfSBlbHNl
IHsKCiAgICAgICAgJGJ1dHRvbnMgPSAnPGRpdiBjbGFzcz0iZWRpdC10aXRsZSI+Jy5nVHh0
KCdzcGZfZWRpdF9zY3JpcHQnKS5zcC5zdHJvbmcoaHRtbHNwZWNpYWxjaGFycygkZmlsZW5h
bWUpKS4nPC9kaXY+JzsKICAgICAgICAkZmlsZWNvbnRlbnQgPSBmZXRjaCgiY29udGVudCIs
J3NwZl9leHQnLCdmaWxlbmFtZScsJGZpbGVuYW1lKTsKCiAgICB9CgogICAgaWYgKCFlbXB0
eSgkZmlsZW5hbWUpKSB7CgogICAgICAgICRjb3B5ID0gJzxzcGFuIGNsYXNzPSJjb3B5LWFz
Ij48bGFiZWwgZm9yPSJjb3B5LWZpbGUiPicuZ1R4dCgnc3BmX2NvcHlfZmlsZScpLic8L2xh
YmVsPicuc3AuZklucHV0KCd0ZXh0JywgJ25ld25hbWUnLCAnJywgJ2VkaXQnLCAnJywgJycs
ICcnLCAnJywgJ2NvcHktZmlsZScpLnNwLgogICAgICAgICAgICBmSW5wdXQoJ3N1Ym1pdCcs
ICdjb3B5JywgZ1R4dCgnY29weScpLCAnc21hbGxlcmJveCcpLic8L3NwYW4+JzsKCiAgICB9
IGVsc2UgewoKICAgICAgICAkY29weSA9ICcnOwoKICAgIH0KCiAgICAkcmlnaHQgPQogICAg
JzxkaXYgaWQ9ImNvbnRlbnRfc3dpdGNoZXIiPicuCiAgICBoZWQoZ1R4dCgnc3BmX2FsbF9m
aWxlcycpLDIpLgogICAgZ3JhZihzTGluaygnc3BmX2V4dCcsICdwb3VyJywgZ1R4dCgnc3Bm
X2NyZWF0ZV9uZXdfZmlsZScpKSwgJyBjbGFzcz0iYWN0aW9uLWNyZWF0ZSBzbWFsbGVyYm94
IicpLgogICAgc3BmX2V4dF9saXN0KCRmaWxlbmFtZSkuCiAgICAnPC9kaXY+JzsKCiAgICBl
Y2hvCiAgICAnPGRpdiBpZD0iJy4kZXZlbnQuJ19jb250YWluZXIiIGNsYXNzPSJ0eHAtY29u
dGFpbmVyIHR4cC1lZGl0Ij4nLgogICAgc3RhcnRUYWJsZSgnZWRpdCcpLgogICAgdHIoCiAg
ICAgICAgdGQoCiAgICAgICAgICAgIGZvcm0oCiAgICAgICAgICAgICAgICAnPGRpdiBpZD0i
bWFpbl9jb250ZW50Ij4nLgogICAgICAgICAgICAgICAgJGJ1dHRvbnMuCiAgICAgICAgICAg
ICAgICAnPHRleHRhcmVhIGlkPSJzcGZfZXh0IiBjbGFzcz0iY29kZSIgbmFtZT0ic3BmX2V4
dCIgY29scz0iNzgiIHJvd3M9IjMyIiBzdHlsZT0ibWFyZ2luLXRvcDogNnB4OyB3aWR0aDog
NzAwcHg7IGhlaWdodDogNTE1cHg7Ij4nLmh0bWxzcGVjaWFsY2hhcnMoJGZpbGVjb250ZW50
KS4nPC90ZXh0YXJlYT4nLmJyLgogICAgICAgICAgICAgICAgZklucHV0KCdzdWJtaXQnLCcn
LGdUeHQoJ3NhdmUnKSwncHVibGlzaCcpLgogICAgICAgICAgICAgICAgZUlucHV0KCdzcGZf
ZXh0Jykuc0lucHV0KCdzcGZfZXh0X3NhdmUnKS4KICAgICAgICAgICAgICAgIGhJbnB1dCgn
ZmlsZW5hbWUnLCRmaWxlbmFtZSkKICAgICAgICAgICAgICAgIC4kY29weS4KICAgICAgICAg
ICAgICAgICc8L2Rpdj4nCiAgICAgICAgICAgICwgJycsICcnLCAncG9zdCcsICdlZGl0LWZv
cm0nLCAnJywgJ3N0eWxlX2Zvcm0nKQogICAgICAgICwgJycsICdjb2x1bW4nKS4KICAgICAg
ICB0ZHRsKAogICAgICAgICAgICAkcmlnaHQKICAgICAgICAsICcgY2xhc3M9ImNvbHVtbiIn
KQogICAgKS4KICAgIGVuZFRhYmxlKCkuCiAgICAnPC9kaXY+JzsKfQoKLyoqCiAqIENvcHkg
ZnVuY3Rpb24KICoKICovCgpmdW5jdGlvbiBzcGZfZXh0X2NvcHkoKSB7CgogICAgZXh0cmFj
dChncHNhKGFycmF5KCdvbGRuYW1lJywgJ25ld25hbWUnKSkpOwoKICAgICRjb250ZW50ID0g
ZG9TbGFzaChmZXRjaCgnY29udGVudCcsICdzcGZfZXh0JywgJ2ZpbGVuYW1lJywgJG9sZG5h
bWUpKTsKCiAgICAkcnMgPSBzYWZlX2luc2VydCgnc3BmX2V4dCcsICJjb250ZW50ID0gJyRj
b250ZW50JywgZmlsZW5hbWUgPSAnIi5kb1NsYXNoKCRuZXduYW1lKS4iJyIpOwoKICAgIHNw
Zl9leHRfZWRpdCgKICAgICAgICBnVHh0KCdzcGZfZmlsZV9jcmVhdGVkJywgYXJyYXkoJ3tu
YW1lfScgPT4gJG5ld25hbWUpKQogICAgKTsKfQoKLyoqCiAqIFNhdmUgZnVuY3Rpb24KICov
CgpmdW5jdGlvbiBzcGZfZXh0X3NhdmUoKSB7CgogICAgZXh0cmFjdChncHNhKGFycmF5KCdm
aWxlbmFtZScsJ3NwZl9leHQnLCdzYXZlbmV3JywnbmV3bmFtZScsJ2NvcHknKSkpOwogICAg
JGNvbnRlbnQgPSBkb1NsYXNoKCRzcGZfZXh0KTsKCiAgICBpZiAoJHNhdmVuZXcgb3IgJGNv
cHkpIHsKCiAgICAgICAgJG5ld25hbWUgPSBkb1NsYXNoKHRyaW0ocHJlZ19yZXBsYWNlKCcv
Wzw+JiJcJ10vJywgJycsIGdwcygnbmV3bmFtZScpKSkpOwoKICAgICAgICBpZiAoJG5ld25h
bWUgYW5kIHNhZmVfZmllbGQoJ2ZpbGVuYW1lJywgJ3NwZl9leHQnLCAiZmlsZW5hbWUgPSAn
JG5ld25hbWUnIikpIHsKCiAgICAgICAgICAgICRtZXNzYWdlID0gZ1R4dCgnc3BmX2ZpbGVf
ZXhpc3RzJywgYXJyYXkoJ3tuYW1lfScgPT4gJG5ld25hbWUpKTsKCiAgICAgICAgICAgIGlm
ICgkc2F2ZW5ldykgewoKICAgICAgICAgICAgICAgICRfUE9TVFsnbmV3bmFtZSddID0gJyc7
CgogICAgICAgICAgICB9CgogICAgICAgIH0gZWxzZWlmICgkbmV3bmFtZSkgewoKICAgICAg
ICAgICAgc2FmZV9pbnNlcnQoJ3NwZl9leHQnLCAiZmlsZW5hbWUgPSAnIi4kbmV3bmFtZS4i
JywgY29udGVudCA9ICckY29udGVudCciKTsKCiAgICAgICAgICAgICRtZXNzYWdlID0gZ1R4
dCgnc3BmX2ZpbGVfY3JlYXRlZCcsIGFycmF5KCd7bmFtZX0nID0+ICRuZXduYW1lKSk7Cgog
ICAgICAgICAgICBzcGZfZXh0X3dyaXRlKCk7CgogICAgICAgIH0gZWxzZSB7CgogICAgICAg
ICAgICAkbWVzc2FnZSA9IGFycmF5KGdUeHQoJ3NwZl9maWxlX25hbWVfcmVxdWlyZWQnKSwg
RV9FUlJPUik7CgogICAgICAgIH0KCiAgICAgICAgc3BmX2V4dF9lZGl0KCRtZXNzYWdlKTsK
CiAgICB9IGVsc2UgewoKICAgICAgICBzYWZlX3VwZGF0ZSgnc3BmX2V4dCcsICJjb250ZW50
ID0gJyRjb250ZW50JyIsICJmaWxlbmFtZSA9ICciLmRvU2xhc2goJGZpbGVuYW1lKS4iJyIp
OwoKICAgICAgICAkbWVzc2FnZSA9IGdUeHQoJ3NwZl9maWxlX3VwZGF0ZWQnLCBhcnJheSgn
e25hbWV9JyA9PiAkZmlsZW5hbWUpKTsKCiAgICAgICAgc3BmX2V4dF93cml0ZSgpOwoKICAg
ICAgICBzcGZfZXh0X2VkaXQoJG1lc3NhZ2UpOwoKICAgIH0KCn0KCi8qKgogKiBXcml0ZSBm
dW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNwZl9leHRfd3JpdGUoKSB7CgogICAgZ2xvYmFsICRw
cmVmczsKICAgIGV4dHJhY3QoZ3BzYShhcnJheSgnZmlsZW5hbWUnLCdzcGZfZXh0Jywnc2F2
ZW5ldycsJ25ld25hbWUnLCdjb3B5JykpKTsKCiAgICAkZmlsZW5hbWUgPSAocHMoJ2NvcHkn
KSBvciBwcygnc2F2ZW5ldycpKSA/IHBzKCduZXduYW1lJykgOiBwcygnZmlsZW5hbWUnKTsK
ICAgICRmaWxlID0gJHByZWZzWydwYXRoX3RvX3NpdGUnXS4nLycuJHByZWZzWydzcGZfZXh0
X2RpciddLicvJy4kZmlsZW5hbWU7CgogICAgaWYgKGVtcHR5KCRwcmVmc1snc3BmX2V4dF9k
aXInXSkgb3IgISRmaWxlbmFtZSkgewoKICAgICAgICByZXR1cm47CgogICAgfSBlbHNlIHsK
CiAgICAkY29udGVudF9yYXcgPSBmZXRjaCgiY29udGVudCIsICJzcGZfZXh0IiwgJ2ZpbGVu
YW1lJywgJGZpbGVuYW1lKTsgLy8gTW92ZWQgaGVyZSB0byBzYXZlIG5ld2x5LWNyZWF0ZWQg
ZmlsZXMKCiAgICAgICAgJGhhbmRsZSA9IGZvcGVuKCRmaWxlLCAnd2InKTsKICAgICAgICBm
d3JpdGUoJGhhbmRsZSwgJGNvbnRlbnRfcmF3KTsKICAgICAgICBmY2xvc2UoJGhhbmRsZSk7
CiAgICAgICAgY2htb2QoJGZpbGUsIDA2NDQpOwogICAgfQoKfQoKLyoqCiAqIERlbGV0ZSBm
dW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNwZl9leHRfZGVsZXRlKCkgewoKICAgIGdsb2JhbCAk
cHJlZnM7CgogICAgJGZpbGVuYW1lID0gcHMoJ2ZpbGVuYW1lJyk7CiAgICAkZmlsZSA9ICRw
cmVmc1sncGF0aF90b19zaXRlJ10uJy8nLiRwcmVmc1snc3BmX2V4dF9kaXInXS4nLycuJGZp
bGVuYW1lOwoKICAgICAgICBpZiAoIWVtcHR5KCRwcmVmc1snc3BmX2V4dF9kaXInXSkgYW5k
ICRmaWxlbmFtZSkgewoKICAgICAgICAgICAgc2FmZV9kZWxldGUoJ3NwZl9leHQnLCAiZmls
ZW5hbWUgPSAnIi5kb1NsYXNoKCRmaWxlbmFtZSkuIiciKTsKCiAgICAgICAgICAgIEB1bmxp
bmsoJGZpbGUpOwoKICAgICAgICBzcGZfZXh0X2VkaXQoCgogICAgICAgICAgICBnVHh0KCdz
cGZfZmlsZV9kZWxldGVkJywgYXJyYXkoJ3tuYW1lfScgPT4gJGZpbGVuYW1lKSkKICAgICAg
ICApOwoKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKfSI7czozOiJtZDUi
O3M6MzI6ImViNDUzNTEzMGNkMDJmZmE5Mjg2NGQ2NjUyN2ZmOGI0Ijt9
