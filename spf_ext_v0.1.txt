# spf_ext v0.1
# External file editor
# Simon Finch
# https://github.com/spiffin/spf_ext

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMjp7czo0OiJuYW1lIjtzOjc6InNwZl9leHQiO3M6NzoidmVyc2lvbiI7czozOiIwLjEi
O3M6NjoiYXV0aG9yIjtzOjExOiJTaW1vbiBGaW5jaCI7czoxMDoiYXV0aG9yX3VyaSI7czoz
NDoiaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dCI7czoxMToiZGVzY3JpcHRp
b24iO3M6MjA6IkV4dGVybmFsIGZpbGUgZWRpdG9yIjtzOjU6Im9yZGVyIjtzOjE6IjUiO3M6
NDoidHlwZSI7czoxOiIzIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6ODoidGV4dHBhY2siO3M6
NTg3OiIjQHNwZl9leHQKc3BmX2V4dF9maWxlcyA9PiBFeHRlcm5hbCBGaWxlcwpzcGZfZXh0
X2RpciA9PiBFeHRlcm5hbCBmaWxlcyBkaXJlY3RvcnkKc3BmX2ZpbGVuYW1lID0+IEZpbGVu
YW1lCnNwZl9lZGl0X2ZpbGUgPT4gWW91IGFyZSBlZGl0aW5nIGZpbGUKc3BmX2FsbF9maWxl
cyA9PiBBbGwgRmlsZXMKc3BmX2ZpbGVfdXBkYXRlZCA9PiBGaWxlIDxzdHJvbmc+e25hbWV9
PC9zdHJvbmc+IHVwZGF0ZWQuCnNwZl9maWxlX25hbWUgPT4gRXh0ZXJuYWwgZmlsZSBuYW1l
CnNwZl9jb3B5X2ZpbGUgPT4gJiM4MjMwO29yIGNvcHkgZmlsZSBhcwpzcGZfY3JlYXRlX25l
d19maWxlID0+IENyZWF0ZSBuZXcgZmlsZQpzcGZfZmlsZV9jcmVhdGVkID0+IEZpbGUgPHN0
cm9uZz57bmFtZX08L3N0cm9uZz4gY3JlYXRlZC4Kc3BmX2ZpbGVfbmFtZV9yZXF1aXJlZCA9
PiBQbGVhc2UgcHJvdmlkZSBhIG5hbWUgZm9yIHlvdXIgZmlsZS4Kc3BmX2ZpbGVfZXhpc3Rz
ID0+IEZpbGUgPHN0cm9uZz57bmFtZX08L3N0cm9uZz4gYWxyZWFkeSBleGlzdHMuCnNwZl9m
aWxlX2RlbGV0ZWQgPT4gRmlsZSA8c3Ryb25nPntuYW1lfTwvc3Ryb25nPiBkZWxldGVkLiI7
czo0OiJoZWxwIjtzOjI2ODA6ImgxLiBzcGZfZXh0CgpwLiBFeHRlcm5hbCBmaWxlIGVkaXRv
ciBwbHVnaW4uIENyZWF0ZSwgZWRpdCBhbmQgZGVsZXRlIGV4dGVybmFsICh0byBUZXh0cGF0
dGVybikgZmlsZXMgaW4gVGV4dHBhdHRlcm4gYWRtaW4uCgpwLiBSRVFVSVJFUzogVGV4cGF0
dGVybiA0LjQuMSBhbmQgUEhQIDUgYW5kIHNoZWxsIGFjY2VzcyAoZm9yIHN5bS1saW5raW5n
IGV4aXN0aW5nIGZpbGVzKS4KCnAuICpQbGVhc2UgcmVhZCB0aGUgaW5zdHJ1Y3Rpb25zIGFu
ZCBub3RlcyBiZWxvdyBiZWZvcmUgdXNlLioKCnAuIFRoaXMgcGx1Z2luIGNyZWF0ZXMgZXh0
ZXJuYWwgZmlsZXMgeW91IGNhbiBtYW5hZ2UgYW5kIGVkaXQgdmlhIHRoZSBhZG1pbiBpbnRl
cmZhY2UuIEFsbCBmaWxlcyBhcmUgc2F2ZWQgdG8gdGhlIGRpcmVjdG9yeSB5b3UgY3JlYXRl
IGluIHN0ZXAgMSBvZiB0aGUgaW5zdHJ1Y3Rpb25zIGJlbG93LiBTeW50YXggaGlnaGxpZ2h0
aW5nIGlzIGF2YWlsYWJsZSB2aWEgInNwZl9jb2RlbWlycm9yIjpodHRwczovL2dpdGh1Yi5j
b20vc3BpZmZpbi9zcGZfY29kZW1pcnJvciAoY3VycmVudGx5IEhUTUwsIFBIUCBhbmQgSmF2
YVNjcmlwdCAtIG1vcmUgdG8gY29tZSkuCgoKaDIuIFdoeT8KCiogVGhpcyBwbHVnaW4gYWxs
b3dzIHlvdSB0byBlZGl0IGFuZCBtYW5hZ2Ugc2l0ZSBmaWxlcyByZXNpZGluZyBvdXRzaWRl
IFRleHRwYXR0ZXJuIHdpdGhpbiB0aGUgVGV4dHBhdHRlcm4gYWRtaW4gYXJlYSAoc2VlICdQ
cm9jZWR1cmUgZm9yIG1hbmFnaW5nIGV4aXN0aW5nIGZpbGVzJyBiZWxvdykuCiogSXQgb2Zm
ZXJzIGFuIGVhc3kgd2F5IHRvIGNyZWF0ZSBzdGF0aWMgZmlsZXMgeW91IGNhbiBlZGl0IGFu
ZCBhY2Nlc3MgdmlhIHlvdXIgcGFnZSB0ZW1wbGF0ZXM6IEA8dHhwOnNpdGVfdXJsIC8+ZXh0
X2ZpbGVzL3lvdXJmaWxlLmh0bWxACgoKCmgyLiBJbnN0cnVjdGlvbnM6CgojIENyZWF0ZSBh
IGRpcmVjdG9yeSBmb3IgdGhlIHN0YXRpYyBleHRlcm5hbCBmaWxlcyBpbiB0aGUgcm9vdCBv
ZiB5b3VyIHRleHRwYXR0ZXJuIGluc3RhbGxhdGlvbiBjYWxsZWQgJ2V4dF9maWxlcycgKG9y
IHdoYXRldmVyIHlvdSBsaWtlKS4gWW91IHNob3VsZCBtYWtlIHN1cmUgdGhhdCBQSFAgaXMg
YWJsZSB0byB3cml0ZSB0byB0aGF0IGRpcmVjdG9yeS4KIyBWaXNpdCB0aGUgYWR2YW5jZWQg
cHJlZmVyZW5jZXMgYW5kIG1ha2Ugc3VyZSB0aGUgIkV4dGVybmFsIGZpbGVzIGRpcmVjdG9y
eSIgcHJlZmVyZW5jZSBjb250YWlucyB0aGUgZGlyZWN0b3J5IHlvdSBjcmVhdGVkIGluIHN0
ZXAgMSAoYnkgZGVmYXVsdCAnZXh0X2ZpbGVzJykuIFRoaXMgcGF0aCBpcyByZWxhdGl2ZSBw
YXRoIHRvIHRoZSBkaXJlY3Rvcnkgb2YgeW91ciByb290IFRleHRwYXR0ZXJuIGluc3RhbGxh
dGlvbi4KIyBBY3RpdmF0ZSB0aGlzIHBsdWdpbi4KIyBHbyB0byBFeHRlbnNpb25zICZndDsg
RXh0ZXJuYWwgRmlsZXMgYW5kIGNyZWF0ZSBmaWxlcyB5b3UnZCBsaWtlIHRvIG1hbmFnZS4K
IyBBbHdheXMgaW5jbHVkZSBhIGZpbGUgZXh0ZW5zaW9uIGluIHRoZSBmaWxlIG5hbWUgKC5o
dG1sLCAucGhwLCBldGMuKS4KCgoKaDIuIFByb2NlZHVyZSBmb3IgbWFuYWdpbmcgZXhpc3Rp
bmcgZmlsZXM6CgojIENvcHkgdGhlIGNvbnRlbnRzIG9mIHRoZSBmaWxlIChjYWxsZWQgZm9y
IGV4YW1wbGUgbXlmaWxlLnBocCkgaW50byBhIG5ldyBmaWxlIGluIEV4dGVuc2lvbnMgJmd0
OyBFeHRlcm5hbCBGaWxlcyAmZ3Q7IENyZWF0ZSBuZXcgZmlsZS4KIyBOYW1lIHRoZSBuZXcg
ZmlsZSAoRXh0ZXJuYWwgZmlsZSBuYW1lOikgJ215ZmlsZS5waHAnLgojIFJlbmFtZSB0aGUg
b3JpZ2luYWwgZmlsZSAodG8sIGZvciBleGFtcGxlLCAnbXlmaWxlX29yaWdpbmFsLnBocCcp
IC0gdGhlbiB5b3UnbGwgaGF2ZSBhIGJhY2t1cC4KIyBNYWtlIGEgc3ltYm9saWMgbGluaywg
aW4gdGhlIG9yaWdpbmFsIGZpbGUgbG9jYXRpb24sIHRvIHRoZSBuZXcgZmlsZSAoZS5nLiBj
ZCB0byB0aGUgJ2V4dF9maWxlcycgZGlyZWN0b3J5IGFuZCB0aGVuICdsbiAtcyAvb3JpZ2lu
YWxfZGlyZWN0b3J5X3BhdGgvbXlmaWxlLnBocCAuL215ZmlsZS5waHAnKS4KCgpoMi4gTm90
ZXM6CgojIFlvdSBjYW4gb25seSBtYW5hZ2UgZmlsZXMgd2hpY2ggYXJlIHJlYWQvd3JpdGUg
dG8geW91ciB3ZWIgc2VydmVyIChpLmUuIHdpdGhpbiB5b3VyIHdlYiByb290KSAtIGUuZy4g
TWluaWZ5IGNvbmZpZyBmaWxlcywgZXh0ZXJuYWwgc2NyaXB0cywgZXRjLgojIERlbGV0aW5n
IGEgZmlsZSB2aWEgdGhlIEV4dGVybmFsIEZpbGVzIHRhYiBkZWxldGVzIHRoZSBhY3R1YWwg
ZmlsZSBpbiB0aGUgJ2V4dF9maWxlcycgZGlyZWN0b3J5IChhcyB3ZWxsIGFzIHRoZSBkYXRh
YmFzZSBlbnRyeSkgLSB1c2Ugd2l0aCBjYXJlIS4KCgpoMi4gTGFuZ3VhZ2VzIChUZXh0cGFj
aykKCnAuIFRoaXMgcGx1Z2luIGluc3RhbGxzIGFuIEVuZ2xpc2ggVGV4dHBhY2sgYnkgZGVm
YXVsdC4KCnAuIFRvIGluc3RhbGwgYSBUZXh0cGFjayBmb3IgeW91ciBvd24gbGFuZ3VhZ2Ug
c2VlIHRoZSAiaW5zdHJ1Y3Rpb25zIG9uIEdpdEh1YiI6aHR0cHM6Ly9naXRodWIuY29tL3Nw
aWZmaW4vc3BmX2V4dC9ibG9iL21hc3Rlci9zcGZfZXh0X3RleHRwYWNrLnR4dC4KCgoKaDIu
IFZlcnNpb24gaGlzdG9yeQoKKiAwLjEgLSBBcHJpbCAyMDEyIC0gZmlyc3QgcmVsZWFzZS4i
O3M6NDoiY29kZSI7czo4NTc0OiIvKioKICogc3BmX2V4dCAtIEV4dGVybmFsIGZpbGUgZWRp
dG9yIGZvciBUZXh0cGF0dGVybgogKgogKiDCqSAyMDEyIFNpbW9uIEZpbmNoIC0gaHR0cHM6
Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dAogKgogKiBMaWNlbnNlZCB1bmRlciBHTlUg
R2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2ZXJzaW9uIDIKICogaHR0cDovL3d3dy5nbnUub3Jn
L2xpY2Vuc2VzL2dwbC0yLjAuaHRtbAogKgogKiBWZXJzaW9uIDAuMSAtLSAyOCBBcHJpbCAy
MDEyCiAqLwoKLyoqCiAqIFNldHVwIHRhYnMgYW5kIGNhbGxiYWNrCiAqLwoKaWYgKEB0eHBp
bnRlcmZhY2UgPT0gJ2FkbWluJykgewoKICAgIGFkZF9wcml2cygnc3BmX2V4dCcsICcxJyk7
CiAgICByZWdpc3Rlcl90YWIoJ2V4dGVuc2lvbnMnLCAnc3BmX2V4dCcsIGdUeHQoJ3NwZl9l
eHRfZmlsZXMnKSk7CiAgICByZWdpc3Rlcl9jYWxsYmFjaygnc3BmX2V4dF9ndWknLCAnc3Bm
X2V4dCcpOwogICAgcmVnaXN0ZXJfY2FsbGJhY2soJ3NwZl9leHRfaW5zdGFsbCcsICdwbHVn
aW5fbGlmZWN5Y2xlLnNwZl9leHQnKTsKCn0KCi8qKgogKiBHVUkgZnVuY3Rpb25zIC8gc3Rl
cCBkaXNwYXRjaGVyCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9ndWkoKSB7CgogICAgZ2xvYmFs
ICRldmVudCwgJHN0ZXA7CgogICAgaWYgKCRldmVudCA9PSAnc3BmX2V4dCcpIHsKICAgICAg
ICByZXF1aXJlX3ByaXZzKCdzcGZfZXh0Jyk7CgogICAgICAgIGJvdW5jZXIoJHN0ZXAsCiAg
ICAgICAgICAgIGFycmF5KAogICAgICAgICAgICAgICAgJ3NwZl9leHRfZWRpdF9yYXcnICAg
PT4gZmFsc2UsCiAgICAgICAgICAgICAgICAncG91cicgICAgICAgICAgICAgID0+IGZhbHNl
LAogICAgICAgICAgICAgICAgJ3NwZl9leHRfc2F2ZScgICAgICAgPT4gdHJ1ZSwKICAgICAg
ICAgICAgICAgICdzcGZfZXh0X2NvcHknICAgICAgID0+IHRydWUsCiAgICAgICAgICAgICAg
ICAnc3BmX2V4dF9kZWxldGUnICAgICA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3NwZl9l
eHRfZWRpdCcgICAgICAgPT4gZmFsc2UsCiAgICAgICAgICAgICkKICAgICAgICApOwoKICAg
ICAgICBzd2l0Y2ggKCRzdGVwKSB7CiAgICAgICAgICAgIGNhc2UgJyc6IHNwZl9leHRfZWRp
dCgpOyAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAn
c3BmX2V4dF9lZGl0X3Jhdyc6IHNwZl9leHRfZWRpdCgpOyAgICAgICAgICBicmVhazsKICAg
ICAgICAgICAgY2FzZSAncG91cic6IHNwZl9leHRfZWRpdCgpOyAgICAgICAgICAgICAgICAg
ICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdzcGZfZXh0X3NhdmUnOiBzcGZfZXh0X3Nh
dmUoKTsgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdzcGZfZXh0X2Nv
cHknOiBzcGZfZXh0X2NvcHkoKTsgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj
YXNlICdzcGZfZXh0X2RlbGV0ZSc6IHNwZl9leHRfZGVsZXRlKCk7ICAgICAgICAgIGJyZWFr
OwogICAgICAgICAgICBjYXNlICdzcGZfZXh0X2VkaXQnOiBzcGZfZXh0X2VkaXQoKTsKICAg
ICAgICB9CiAgICB9Cn0KCi8qKgogKiBJbnN0YWxsZXIgZnVuY3Rpb24KICovCgpmdW5jdGlv
biBzcGZfZXh0X2luc3RhbGwoJGV2ZW50PScnLCAkc3RlcD0nJykgewoKICAgIGdsb2JhbCAk
cHJlZnM7CgogICAgaWYoJHN0ZXAgPT0gJ2RlbGV0ZWQnKSB7CgogICAgICAgIHNhZmVfZGVs
ZXRlKAogICAgICAgICAgICAndHhwX3ByZWZzJywKICAgICAgICAgICAgIm5hbWU9J3NwZl9l
eHRfZGlyJyIKICAgICAgICApOwoKICAgICAgICAvLyBEb24ndCBkcm9wIHRoZSB0YWJsZSAt
IGp1c3QgaW4gY2FzZS4uCiAgICAgICAgLy9Ac2FmZV9xdWVyeSgKICAgICAgICAvLyAgICAn
RFJPUCBUQUJMRSBJRiBFWElTVFMgJy5zYWZlX3BmeCgnc3BmX2V4dCcpCiAgICAgICAgLy8p
OwoKICAgICAgICAvLyBkZWxldGUgdGhlIFRleHRwYWNrCgogICAgICAgIHNhZmVfZGVsZXRl
KAogICAgICAgICAgICAndHhwX2xhbmcnLAogICAgICAgICAgICAiZXZlbnQgPSAnc3BmX2V4
dCciCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuOwoKICAgIH0KCiAgICBpZighaXNzZXQo
JHByZWZzWydzcGZfZXh0X2RpciddKSkgewoKICAgICAgICBzYWZlX3F1ZXJ5KAogICAgICAg
ICAgICAiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgIi5zYWZlX3BmeCgnc3BmX2V4dCcp
LiIgKAogICAgICAgICAgICAgICAgZmlsZW5hbWUgdmFyY2hhcigyNTUpIE5PVCBOVUxMIGRl
ZmF1bHQgJycsCiAgICAgICAgICAgICAgICBjb250ZW50IGxvbmd0ZXh0IE5PVCBOVUxMLAog
ICAgICAgICAgICAgICAgUFJJTUFSWSBLRVkoZmlsZW5hbWUpCiAgICAgICAgICAgICkgQ0hB
UlNFVD11dGY4IgogICAgICAgICk7CgogICAgICAgIGlmKCFzYWZlX2NvdW50KCJzcGZfZXh0
IiwgImZpbGVuYW1lPSdob2xkZXIudHh0JyIpKSB7CgogICAgICAgICAgICBzYWZlX2luc2Vy
dCgic3BmX2V4dCIsICJmaWxlbmFtZT0naG9sZGVyLnR4dCcsIGNvbnRlbnQ9J0hvbGRlciB0
ZXh0IGZpbGUuLi55b3UgbmVlZCBhdCBsZWFzdCBvbmUgZmlsZSBoZXJlLiciKTsKCiAgICAg
ICAgfQoKICAgICAgICBzYWZlX2luc2VydCgKICAgICAgICAgICAgJ3R4cF9wcmVmcycsCiAg
ICAgICAgICAgICJwcmVmc19pZD0xLAogICAgICAgICAgICBuYW1lPSdzcGZfZXh0X2Rpcics
CiAgICAgICAgICAgIHZhbD0nZXh0X2ZpbGVzJywKICAgICAgICAgICAgdHlwZT0xLAogICAg
ICAgICAgICBldmVudD0nYWRtaW4nLAogICAgICAgICAgICBodG1sPSd0ZXh0X2lucHV0JywK
ICAgICAgICAgICAgcG9zaXRpb249MjIiCiAgICAgICAgKTsKICAgIH0KfQoKLyoqCiAqIExp
c3QgZnVuY3Rpb24KICovCgpmdW5jdGlvbiBzcGZfZXh0X2xpc3QoJGN1cnJlbnQpIHsKCiAg
ICAkb3V0W10gPSBzdGFydFRhYmxlKCdsaXN0JywgJ2xlZnQnKTsKCiAgICAkcnMgPSBzYWZl
X3Jvd3Nfc3RhcnQoJ2ZpbGVuYW1lJywgJ3NwZl9leHQnLCAiMT0xIik7CgogICAgaWYgKCRy
cykgewoKICAgICAgICB3aGlsZSAoJGEgPSBuZXh0Um93KCRycykpIHsKICAgICAgICAgICAg
ZXh0cmFjdCgkYSk7CiAgICAgICAgICAgICRlZGl0ID0gKCRjdXJyZW50ICE9ICRmaWxlbmFt
ZSkgPyBlTGluaygnc3BmX2V4dCcsICcnLCAnZmlsZW5hbWUnLCAkZmlsZW5hbWUsICRmaWxl
bmFtZSkgOiBodG1sc3BlY2lhbGNoYXJzKCRmaWxlbmFtZSk7CiAgICAgICAgICAgICRkZWxl
dGUgPSAoJGZpbGVuYW1lKSA/IGRMaW5rKCdzcGZfZXh0JywgJ3NwZl9leHRfZGVsZXRlJywg
J2ZpbGVuYW1lJywgJGZpbGVuYW1lKSA6ICcnOwogICAgICAgICAgICAkb3V0W10gPSB0cih0
ZCgkZWRpdCkudGQoJGRlbGV0ZSkpOwogICAgICAgIH0KCiAgICAgICAgJG91dFtdID0gIGVu
ZFRhYmxlKCk7CgogICAgICAgIHJldHVybiBqb2luKCcnLCAkb3V0KTsKCiAgICB9Cn0KCi8q
KgogKiBFZGl0IGZ1bmN0aW9uCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9lZGl0KCRtZXNzYWdl
PScnKSB7CgogICAgcGFnZXRvcChnVHh0KCdzcGZfZXh0X2ZpbGVzJyksJG1lc3NhZ2UpOwog
ICAgZ2xvYmFsICRzdGVwLCAkcHJlZnM7CiAgICBzcGZfZXh0X2VkaXRfcmF3KCk7Cgp9Cgov
KioKICogRWRpdCBmdW5jdGlvbiAocmF3KQogKi8KCmZ1bmN0aW9uIHNwZl9leHRfZWRpdF9y
YXcoKSB7CgogICAgZ2xvYmFsICRldmVudCwgJHN0ZXA7CgogICAgJGZpcnN0ID0gc2FmZV9y
b3coJ2ZpbGVuYW1lJywgJ3NwZl9leHQnLCAiMT0xIik7CiAgICAkZmlyc3RfZmlsZSA9ICRm
aXJzdFsnZmlsZW5hbWUnXTsKCiAgICBleHRyYWN0KGdwc2EoYXJyYXkoJ2ZpbGVuYW1lJywg
J25ld25hbWUnLCAnY29weScsICdzYXZlbmV3JykpKTsKCiAgICBpZiAoJHN0ZXAgPT0gJ3Nw
Zl9leHRfZGVsZXRlJyB8fCBlbXB0eSgkZmlsZW5hbWUpICYmICRzdGVwICE9ICdwb3VyJyAm
JiAhJHNhdmVuZXcpIHsKCiAgICAgICAgJGZpbGVuYW1lID0gJGZpcnN0X2ZpbGU7CgogICAg
fQoKICAgIGVsc2VpZiAoKCRjb3B5IHx8ICRzYXZlbmV3KSAmJiB0cmltKHByZWdfcmVwbGFj
ZSgnL1s8PiYiXCddLycsICcnLCAkbmV3bmFtZSkpKSB7CgogICAgICAgICRmaWxlbmFtZSA9
ICRuZXduYW1lOwoKICAgIH0KCiAgICBpZiAoZW1wdHkoJGZpbGVuYW1lKSkgewoKICAgICAg
ICAkYnV0dG9ucyA9ICc8ZGl2IGNsYXNzPSJlZGl0LXRpdGxlIj4nLgogICAgICAgIGdUeHQo
J3NwZl9maWxlX25hbWUnKS4nOiAnCiAgICAgICAgLmZJbnB1dCgndGV4dCcsJ25ld25hbWUn
LCcnLCdlZGl0JywnJywnJywyMCkuCiAgICAgICAgaElucHV0KCdzYXZlbmV3Jywnc2F2ZW5l
dycpLgogICAgICAgICc8L2Rpdj4nOwogICAgICAgICRmaWxlY29udGVudCA9IGdwcygnc3Bm
X2V4dCcpOwoKICAgIH0gZWxzZSB7CgogICAgICAgICRidXR0b25zID0gJzxkaXYgY2xhc3M9
ImVkaXQtdGl0bGUiPicuZ1R4dCgnc3BmX2VkaXRfc2NyaXB0Jykuc3Auc3Ryb25nKGh0bWxz
cGVjaWFsY2hhcnMoJGZpbGVuYW1lKSkuJzwvZGl2Pic7CiAgICAgICAgJGZpbGVjb250ZW50
ID0gZmV0Y2goImNvbnRlbnQiLCdzcGZfZXh0JywnZmlsZW5hbWUnLCRmaWxlbmFtZSk7Cgog
ICAgfQoKICAgIGlmICghZW1wdHkoJGZpbGVuYW1lKSkgewoKICAgICAgICAkY29weSA9ICc8
c3BhbiBjbGFzcz0iY29weS1hcyI+PGxhYmVsIGZvcj0iY29weS1maWxlIj4nLmdUeHQoJ3Nw
Zl9jb3B5X2ZpbGUnKS4nPC9sYWJlbD4nLnNwLmZJbnB1dCgndGV4dCcsICduZXduYW1lJywg
JycsICdlZGl0JywgJycsICcnLCAnJywgJycsICdjb3B5LWZpbGUnKS5zcC4KICAgICAgICAg
ICAgZklucHV0KCdzdWJtaXQnLCAnY29weScsIGdUeHQoJ2NvcHknKSwgJ3NtYWxsZXJib3gn
KS4nPC9zcGFuPic7CgogICAgfSBlbHNlIHsKCiAgICAgICAgJGNvcHkgPSAnJzsKCiAgICB9
CgogICAgJHJpZ2h0ID0KICAgICc8ZGl2IGlkPSJjb250ZW50X3N3aXRjaGVyIj4nLgogICAg
aGVkKGdUeHQoJ3NwZl9hbGxfZmlsZXMnKSwyKS4KICAgIGdyYWYoc0xpbmsoJ3NwZl9leHQn
LCAncG91cicsIGdUeHQoJ3NwZl9jcmVhdGVfbmV3X2ZpbGUnKSksICcgY2xhc3M9ImFjdGlv
bi1jcmVhdGUgc21hbGxlcmJveCInKS4KICAgIHNwZl9leHRfbGlzdCgkZmlsZW5hbWUpLgog
ICAgJzwvZGl2Pic7CgogICAgZWNobwogICAgJzxkaXYgaWQ9IicuJGV2ZW50LidfY29udGFp
bmVyIiBjbGFzcz0idHhwLWNvbnRhaW5lciB0eHAtZWRpdCI+Jy4KICAgIHN0YXJ0VGFibGUo
J2VkaXQnKS4KICAgIHRyKAogICAgICAgIHRkKAogICAgICAgICAgICBmb3JtKAogICAgICAg
ICAgICAgICAgJzxkaXYgaWQ9Im1haW5fY29udGVudCI+Jy4KICAgICAgICAgICAgICAgICRi
dXR0b25zLgogICAgICAgICAgICAgICAgJzx0ZXh0YXJlYSBpZD0ic3BmX2V4dCIgY2xhc3M9
ImNvZGUiIG5hbWU9InNwZl9leHQiIGNvbHM9Ijc4IiByb3dzPSIzMiIgc3R5bGU9Im1hcmdp
bi10b3A6IDZweDsgd2lkdGg6IDcwMHB4OyBoZWlnaHQ6IDUxNXB4OyI+Jy5odG1sc3BlY2lh
bGNoYXJzKCRmaWxlY29udGVudCkuJzwvdGV4dGFyZWE+Jy5ici4KICAgICAgICAgICAgICAg
IGZJbnB1dCgnc3VibWl0JywnJyxnVHh0KCdzYXZlJyksJ3B1Ymxpc2gnKS4KICAgICAgICAg
ICAgICAgIGVJbnB1dCgnc3BmX2V4dCcpLnNJbnB1dCgnc3BmX2V4dF9zYXZlJykuCiAgICAg
ICAgICAgICAgICBoSW5wdXQoJ2ZpbGVuYW1lJywkZmlsZW5hbWUpCiAgICAgICAgICAgICAg
ICAuJGNvcHkuCiAgICAgICAgICAgICAgICAnPC9kaXY+JwogICAgICAgICAgICAsICcnLCAn
JywgJ3Bvc3QnLCAnZWRpdC1mb3JtJywgJycsICdzdHlsZV9mb3JtJykKICAgICAgICAsICcn
LCAnY29sdW1uJykuCiAgICAgICAgdGR0bCgKICAgICAgICAgICAgJHJpZ2h0CiAgICAgICAg
LCAnIGNsYXNzPSJjb2x1bW4iJykKICAgICkuCiAgICBlbmRUYWJsZSgpLgogICAgJzwvZGl2
Pic7Cn0KCi8qKgogKiBDb3B5IGZ1bmN0aW9uCiAqCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9j
b3B5KCkgewoKICAgIGV4dHJhY3QoZ3BzYShhcnJheSgnb2xkbmFtZScsICduZXduYW1lJykp
KTsKCiAgICAkY29udGVudCA9IGRvU2xhc2goZmV0Y2goJ2NvbnRlbnQnLCAnc3BmX2V4dCcs
ICdmaWxlbmFtZScsICRvbGRuYW1lKSk7CgogICAgJHJzID0gc2FmZV9pbnNlcnQoJ3NwZl9l
eHQnLCAiY29udGVudCA9ICckY29udGVudCcsIGZpbGVuYW1lID0gJyIuZG9TbGFzaCgkbmV3
bmFtZSkuIiciKTsKCiAgICBzcGZfZXh0X2VkaXQoCiAgICAgICAgZ1R4dCgnc3BmX2ZpbGVf
Y3JlYXRlZCcsIGFycmF5KCd7bmFtZX0nID0+ICRuZXduYW1lKSkKICAgICk7Cn0KCi8qKgog
KiBTYXZlIGZ1bmN0aW9uCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9zYXZlKCkgewoKICAgIGV4
dHJhY3QoZ3BzYShhcnJheSgnZmlsZW5hbWUnLCdzcGZfZXh0Jywnc2F2ZW5ldycsJ25ld25h
bWUnLCdjb3B5JykpKTsKICAgICRjb250ZW50ID0gZG9TbGFzaCgkc3BmX2V4dCk7CgogICAg
aWYgKCRzYXZlbmV3IG9yICRjb3B5KSB7CgogICAgICAgICRuZXduYW1lID0gZG9TbGFzaCh0
cmltKHByZWdfcmVwbGFjZSgnL1s8PiYiXCddLycsICcnLCBncHMoJ25ld25hbWUnKSkpKTsK
CiAgICAgICAgaWYgKCRuZXduYW1lIGFuZCBzYWZlX2ZpZWxkKCdmaWxlbmFtZScsICdzcGZf
ZXh0JywgImZpbGVuYW1lID0gJyRuZXduYW1lJyIpKSB7CgogICAgICAgICAgICAkbWVzc2Fn
ZSA9IGdUeHQoJ3NwZl9maWxlX2V4aXN0cycsIGFycmF5KCd7bmFtZX0nID0+ICRuZXduYW1l
KSk7CgogICAgICAgICAgICBpZiAoJHNhdmVuZXcpIHsKCiAgICAgICAgICAgICAgICAkX1BP
U1RbJ25ld25hbWUnXSA9ICcnOwoKICAgICAgICAgICAgfQoKICAgICAgICB9IGVsc2VpZiAo
JG5ld25hbWUpIHsKCiAgICAgICAgICAgIHNhZmVfaW5zZXJ0KCdzcGZfZXh0JywgImZpbGVu
YW1lID0gJyIuJG5ld25hbWUuIicsIGNvbnRlbnQgPSAnJGNvbnRlbnQnIik7CgogICAgICAg
ICAgICAkbWVzc2FnZSA9IGdUeHQoJ3NwZl9maWxlX2NyZWF0ZWQnLCBhcnJheSgne25hbWV9
JyA9PiAkbmV3bmFtZSkpOwoKICAgICAgICAgICAgc3BmX2V4dF93cml0ZSgpOwoKICAgICAg
ICB9IGVsc2UgewoKICAgICAgICAgICAgJG1lc3NhZ2UgPSBhcnJheShnVHh0KCdzcGZfZmls
ZV9uYW1lX3JlcXVpcmVkJyksIEVfRVJST1IpOwoKICAgICAgICB9CgogICAgICAgIHNwZl9l
eHRfZWRpdCgkbWVzc2FnZSk7CgogICAgfSBlbHNlIHsKCiAgICAgICAgc2FmZV91cGRhdGUo
J3NwZl9leHQnLCAiY29udGVudCA9ICckY29udGVudCciLCAiZmlsZW5hbWUgPSAnIi5kb1Ns
YXNoKCRmaWxlbmFtZSkuIiciKTsKCiAgICAgICAgJG1lc3NhZ2UgPSBnVHh0KCdzcGZfZmls
ZV91cGRhdGVkJywgYXJyYXkoJ3tuYW1lfScgPT4gJGZpbGVuYW1lKSk7CgogICAgICAgIHNw
Zl9leHRfd3JpdGUoKTsKCiAgICAgICAgc3BmX2V4dF9lZGl0KCRtZXNzYWdlKTsKCiAgICB9
Cgp9CgovKioKICogV3JpdGUgZnVuY3Rpb24KICovCgpmdW5jdGlvbiBzcGZfZXh0X3dyaXRl
KCkgewoKICAgIGdsb2JhbCAkcHJlZnM7CiAgICBleHRyYWN0KGdwc2EoYXJyYXkoJ2ZpbGVu
YW1lJywnc3BmX2V4dCcsJ3NhdmVuZXcnLCduZXduYW1lJywnY29weScpKSk7CgogICAgJGZp
bGVuYW1lID0gKHBzKCdjb3B5Jykgb3IgcHMoJ3NhdmVuZXcnKSkgPyBwcygnbmV3bmFtZScp
IDogcHMoJ2ZpbGVuYW1lJyk7CiAgICAkZmlsZSA9ICRwcmVmc1sncGF0aF90b19zaXRlJ10u
Jy8nLiRwcmVmc1snc3BmX2V4dF9kaXInXS4nLycuJGZpbGVuYW1lOwoKICAgIGlmIChlbXB0
eSgkcHJlZnNbJ3NwZl9leHRfZGlyJ10pIG9yICEkZmlsZW5hbWUpIHsKCiAgICAgICAgcmV0
dXJuOwoKICAgIH0gZWxzZSB7CgogICAgJGNvbnRlbnRfcmF3ID0gZmV0Y2goImNvbnRlbnQi
LCAic3BmX2V4dCIsICdmaWxlbmFtZScsICRmaWxlbmFtZSk7IC8vIE1vdmVkIGhlcmUgdG8g
c2F2ZSBuZXdseS1jcmVhdGVkIGZpbGVzCgogICAgICAgICRoYW5kbGUgPSBmb3BlbigkZmls
ZSwgJ3diJyk7CiAgICAgICAgZndyaXRlKCRoYW5kbGUsICRjb250ZW50X3Jhdyk7CiAgICAg
ICAgZmNsb3NlKCRoYW5kbGUpOwogICAgICAgIGNobW9kKCRmaWxlLCAwNjQ0KTsKICAgIH0K
Cn0KCi8qKgogKiBEZWxldGUgZnVuY3Rpb24KICovCgpmdW5jdGlvbiBzcGZfZXh0X2RlbGV0
ZSgpIHsKCiAgICBnbG9iYWwgJHByZWZzOwoKICAgICRmaWxlbmFtZSA9IHBzKCdmaWxlbmFt
ZScpOwogICAgJGZpbGUgPSAkcHJlZnNbJ3BhdGhfdG9fc2l0ZSddLicvJy4kcHJlZnNbJ3Nw
Zl9leHRfZGlyJ10uJy8nLiRmaWxlbmFtZTsKCiAgICAgICAgaWYgKCFlbXB0eSgkcHJlZnNb
J3NwZl9leHRfZGlyJ10pIGFuZCAkZmlsZW5hbWUpIHsKCiAgICAgICAgICAgIHNhZmVfZGVs
ZXRlKCdzcGZfZXh0JywgImZpbGVuYW1lID0gJyIuZG9TbGFzaCgkZmlsZW5hbWUpLiInIik7
CgogICAgICAgICAgICBAdW5saW5rKCRmaWxlKTsKCiAgICAgICAgc3BmX2V4dF9lZGl0KAoK
ICAgICAgICAgICAgZ1R4dCgnc3BmX2ZpbGVfZGVsZXRlZCcsIGFycmF5KCd7bmFtZX0nID0+
ICRmaWxlbmFtZSkpCiAgICAgICAgKTsKCiAgICB9IGVsc2UgewogICAgICAgIHJldHVybjsK
ICAgIH0KCn0iO3M6MzoibWQ1IjtzOjMyOiI5ZDVkNmEwMWI1NjMyMjI1ODNkNGM3MDkxOTJh
MTM1NiI7fQ==
