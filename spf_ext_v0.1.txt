# spf_ext v0.1
# External file editor
# Simon Finch
# https://github.com/spiffin/spf_ext

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMjp7czo0OiJuYW1lIjtzOjc6InNwZl9leHQiO3M6NzoidmVyc2lvbiI7czozOiIwLjEi
O3M6NjoiYXV0aG9yIjtzOjExOiJTaW1vbiBGaW5jaCI7czoxMDoiYXV0aG9yX3VyaSI7czoz
NDoiaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dCI7czoxMToiZGVzY3JpcHRp
b24iO3M6MjA6IkV4dGVybmFsIGZpbGUgZWRpdG9yIjtzOjU6Im9yZGVyIjtzOjE6IjUiO3M6
NDoidHlwZSI7czoxOiIzIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6ODoidGV4dHBhY2siO3M6
NTg3OiIjQHNwZl9leHQKc3BmX2V4dF9maWxlcyA9PiBFeHRlcm5hbCBGaWxlcwpzcGZfZXh0
X2RpciA9PiBFeHRlcm5hbCBmaWxlcyBkaXJlY3RvcnkKc3BmX2ZpbGVuYW1lID0+IEZpbGVu
YW1lCnNwZl9lZGl0X2ZpbGUgPT4gWW91IGFyZSBlZGl0aW5nIGZpbGUKc3BmX2FsbF9maWxl
cyA9PiBBbGwgRmlsZXMKc3BmX2ZpbGVfdXBkYXRlZCA9PiBGaWxlIDxzdHJvbmc+e25hbWV9
PC9zdHJvbmc+IHVwZGF0ZWQuCnNwZl9maWxlX25hbWUgPT4gRXh0ZXJuYWwgZmlsZSBuYW1l
CnNwZl9jb3B5X2ZpbGUgPT4gJiM4MjMwO29yIGNvcHkgZmlsZSBhcwpzcGZfY3JlYXRlX25l
d19maWxlID0+IENyZWF0ZSBuZXcgZmlsZQpzcGZfZmlsZV9jcmVhdGVkID0+IEZpbGUgPHN0
cm9uZz57bmFtZX08L3N0cm9uZz4gY3JlYXRlZC4Kc3BmX2ZpbGVfbmFtZV9yZXF1aXJlZCA9
PiBQbGVhc2UgcHJvdmlkZSBhIG5hbWUgZm9yIHlvdXIgZmlsZS4Kc3BmX2ZpbGVfZXhpc3Rz
ID0+IEZpbGUgPHN0cm9uZz57bmFtZX08L3N0cm9uZz4gYWxyZWFkeSBleGlzdHMuCnNwZl9m
aWxlX2RlbGV0ZWQgPT4gRmlsZSA8c3Ryb25nPntuYW1lfTwvc3Ryb25nPiBkZWxldGVkLiI7
czo0OiJoZWxwIjtzOjMyNzA6IjxoMT5FeHRlcm5hbCBmaWxlIGVkaXRvcjwvaDE+Cgo8cD5D
cmVhdGUsIGVkaXQgYW5kIGRlbGV0ZSBleHRlcm5hbCAodG8gVGV4dHBhdHRlcm4pIGZpbGVz
IGluIFRleHRwYXR0ZXJuIGFkbWluLjwvcD4KCjxwPlJFUVVJUkVTOiBUZXhwYXR0ZXJuIDQu
NC4xIGFuZCBQSFAgNSBhbmQgc2hlbGwgYWNjZXNzIChmb3Igc3ltLWxpbmtpbmcgZXhpc3Rp
bmcgZmlsZXMpLjwvcD4KCjxwPjxzdHJvbmc+UGxlYXNlIHJlYWQgdGhlIGluc3RydWN0aW9u
cyBhbmQgbm90ZXMgYmVsb3cgYmVmb3JlIHVzZS48L3N0cm9uZz48L3A+Cgo8cD5MYXRlc3Qg
dmVyc2lvbjogPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dCI+
c3BmX2V4dCBHaXRIdWIgcmVwb3NpdG9yeTwvYT4uPC9wPgoKPHA+VGhpcyBwbHVnaW4gY3Jl
YXRlcyBleHRlcm5hbCBmaWxlcyB5b3UgY2FuIG1hbmFnZSBhbmQgZWRpdCB2aWEgdGhlIGFk
bWluIGludGVyZmFjZS4gQWxsIGZpbGVzIGFyZSBzYXZlZCB0byB0aGUgZGlyZWN0b3J5IHlv
dSBjcmVhdGUgaW4gc3RlcCAxIG9mIHRoZSBpbnN0cnVjdGlvbnMgYmVsb3cuIFN5bnRheCBo
aWdobGlnaHRpbmcgaXMgYXZhaWxhYmxlIHZpYSB0aGUgPGEgaHJlZj0iaHR0cHM6Ly9naXRo
dWIuY29tL3NwaWZmaW4vQ29kZU1pcnJvclRleHRwYXR0ZXJuIj5Db2RlbWlycm9yIGFkbWlu
IHRoZW1lPC9hPiAoY3VycmVudGx5IEhUTUwsIFBIUCBhbmQgSmF2YVNjcmlwdCAtIG1vcmUg
dG8gY29tZSkuPC9wPgoKPGJyIC8+CjxociAvPgo8YnIgLz4KCjxoMz5XaHk/PC9oMz4KCjx1
bD4KCjxsaT5UaGlzIHBsdWdpbiBhbGxvd3MgeW91IHRvIGVkaXQgYW5kIG1hbmFnZSBzaXRl
IGZpbGVzIHJlc2lkaW5nIG91dHNpZGUgVGV4dHBhdHRlcm4gd2l0aGluIHRoZSBUZXh0cGF0
dGVybiBhZG1pbiBhcmVhIChzZWUgJ1Byb2NlZHVyZSBmb3IgbWFuYWdpbmcgZXhpc3Rpbmcg
ZmlsZXMnIGJlbG93KS48L2xpPgoKPGxpPkl0IG9mZmVycyBhbiBlYXN5IHdheSB0byBjcmVh
dGUgc3RhdGljIGZpbGVzIHlvdSBjYW4gZWRpdCBhbmQgYWNjZXNzIHZpYSB5b3VyIHBhZ2Ug
dGVtcGxhdGVzOiA8Y29kZT4mbHQ7dHhwOnNpdGVfdXJsIC8mZ3Q7ZXh0X2ZpbGVzL3lvdXJm
aWxlLmh0bWw8L2NvZGU+PC9saT4KCjwvdWw+Cgo8YnIgLz4KPGhyIC8+CjxiciAvPgoKCTxo
Mz5JbnN0cnVjdGlvbnM6PC9oMz4KCTxvbD4KCQk8bGk+Q3JlYXRlIGEgZGlyZWN0b3J5IGZv
ciB0aGUgc3RhdGljIGV4dGVybmFsIGZpbGVzIGluIHRoZSByb290IG9mIHlvdXIgdGV4dHBh
dHRlcm4gaW5zdGFsbGF0aW9uIGNhbGxlZCAnZXh0X2ZpbGVzJyAob3Igd2hhdGV2ZXIgeW91
IGxpa2UpLiBZb3Ugc2hvdWxkIG1ha2Ugc3VyZSB0aGF0IFBIUCBpcyBhYmxlIHRvIHdyaXRl
IHRvIHRoYXQgZGlyZWN0b3J5LjwvbGk+CgkJPGxpPlZpc2l0IHRoZSA8YSBocmVmPSJpbmRl
eC5waHA/ZXZlbnQ9cHJlZnMmYW1wO3N0ZXA9YWR2YW5jZWRfcHJlZnMiPmFkdmFuY2VkIHBy
ZWZlcmVuY2VzPC9hPiBhbmQgbWFrZSBzdXJlIHRoZSAmIzgyMjA7RXh0ZXJuYWwgZmlsZXMg
ZGlyZWN0b3J5JiM4MjIxOyBwcmVmZXJlbmNlIGNvbnRhaW5zIHRoZSBkaXJlY3RvcnkgeW91
IGNyZWF0ZWQgaW4gc3RlcCAxIChieSBkZWZhdWx0ICdleHRfZmlsZXMnKS4gVGhpcyBwYXRo
IGlzIHJlbGF0aXZlIHBhdGggdG8gdGhlIGRpcmVjdG9yeSBvZiB5b3VyIHJvb3QgVGV4dHBh
dHRlcm4gaW5zdGFsbGF0aW9uLjwvbGk+CgkJPGxpPkFjdGl2YXRlIHRoaXMgcGx1Z2luLjwv
bGk+CgkJPGxpPkdvIHRvIEV4dGVuc2lvbnMgPiBFeHRlcm5hbCBGaWxlcyBhbmQgY3JlYXRl
IGZpbGVzIHlvdSdkIGxpa2UgdG8gbWFuYWdlLjwvbGk+CgkJPGxpPkFsd2F5cyBpbmNsdWRl
IGEgZmlsZSBleHRlbnNpb24gaW4gdGhlIGZpbGUgbmFtZSAoLmh0bWwsIC5waHAsIGV0Yy4p
LjwvbGk+Cgk8L29sPgoKPGJyIC8+CjxociAvPgo8YnIgLz4KCgk8aDM+UHJvY2VkdXJlIGZv
ciBtYW5hZ2luZyBleGlzdGluZyBmaWxlczo8L2gzPgoJPG9sPgoJCTxsaT5Db3B5IHRoZSBj
b250ZW50cyBvZiB0aGUgZmlsZSAoY2FsbGVkIGZvciBleGFtcGxlIG15ZmlsZS5waHApIGlu
dG8gYSBuZXcgZmlsZSBpbiBFeHRlbnNpb25zID4gRXh0ZXJuYWwgRmlsZXMgPiBDcmVhdGUg
bmV3IGZpbGUuPC9saT4KCQk8bGk+TmFtZSB0aGUgbmV3IGZpbGUgKEV4dGVybmFsIGZpbGUg
bmFtZTopICdteWZpbGUucGhwJy48L2xpPgoJCTxsaT5SZW5hbWUgdGhlIG9yaWdpbmFsIGZp
bGUgKHRvLCBmb3IgZXhhbXBsZSwgJ215ZmlsZV9vcmlnaW5hbC5waHAnKSAtIHRoZW4geW91
J2xsIGhhdmUgYSBiYWNrdXAuPC9saT4KCQk8bGk+TWFrZSBhIHN5bWJvbGljIGxpbmssIGlu
IHRoZSBvcmlnaW5hbCBmaWxlIGxvY2F0aW9uLCB0byB0aGUgbmV3IGZpbGUgKGUuZy4gY2Qg
dG8gdGhlICdleHRfZmlsZXMnIGRpcmVjdG9yeSBhbmQgdGhlbiAnbG4gLXMgL29yaWdpbmFs
X2RpcmVjdG9yeV9wYXRoL215ZmlsZS5waHAgLi9teWZpbGUucGhwJykuPC9saT4KCTwvb2w+
Cgo8YnIgLz4KPGhyIC8+CjxiciAvPgoKCTxoMz5Ob3Rlczo8L2gzPgogICAgICAgIDxvbD4K
ICAgICAgICA8bGk+WW91IGNhbiBvbmx5IG1hbmFnZSBmaWxlcyB3aGljaCBhcmUgcmVhZC93
cml0ZSB0byB5b3VyIHdlYiBzZXJ2ZXIgKGkuZS4gd2l0aGluIHlvdXIgd2ViIHJvb3QpIC0g
ZS5nLiBNaW5pZnkgY29uZmlnIGZpbGVzLCBleHRlcm5hbCBzY3JpcHRzPC9saT4KCiAgICAg
ICAgPGxpPkRlbGV0aW5nIGEgZmlsZSB2aWEgdGhlIEV4dGVybmFsIEZpbGVzIHRhYiBkZWxl
dGVzIHRoZSBhY3R1YWwgZmlsZSAoYXMgd2VsbCBhcyB0aGUgZGF0YWJhc2UgZW50cnkpIC0g
dXNlIHdpdGggY2FyZSEuPC9wPgogICAgICAgIDwvb2w+Cgo8YnIgLz4KPGhyIC8+CjxiciAv
PgoKICAgICAgICA8aDM+TGFuZ3VhZ2VzIChUZXh0cGFjayk8L2gzPgoKICAgICAgICA8cD5U
aGlzIHBsdWdpbiBpbnN0YWxscyBhbiBFbmdsaXNoIFRleHRwYWNrIGJ5IGRlZmF1bHQuPC9w
PgogICAgICAgIDxwPlRvIGluc3RhbGwgYSBUZXh0cGFjayBmb3IgeW91ciBvd24gbGFuZ3Vh
Z2Ugc2VlIHRoZSA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vc3BpZmZpbi9zcGZfZXh0
L2Jsb2IvbWFzdGVyL3NwZl9leHRfdGV4dHBhY2sudHh0Ij5pbnN0cnVjdGlvbnMgb24gR2l0
SHViPC9hPi48L3A+Cgo8YnIgLz4KPGhyIC8+CjxiciAvPgoKICAgICAgICA8aDM+VmVyc2lv
biBoaXN0b3J5PC9oMz4KCjAuMSAtIEFwcmlsIDIwMTIgLSBmaXJzdCByZWxlYXNlLiI7czo0
OiJjb2RlIjtzOjg1NDQ6Ii8qKgogKiBzcGZfZXh0IC0gRXh0ZXJuYWwgZmlsZSBlZGl0b3Ig
Zm9yIFRleHRwYXR0ZXJuCiAqCiAqIMKpIDIwMTIgU2ltb24gRmluY2ggLSBodHRwczovL2dp
dGh1Yi5jb20vc3BpZmZpbi9zcGZfZXh0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIEdOVSBHZW5l
cmFsIFB1YmxpYyBMaWNlbnNlIHZlcnNpb24gMgogKiBodHRwOi8vd3d3LmdudS5vcmcvbGlj
ZW5zZXMvZ3BsLTIuMC5odG1sCiAqCiAqIFZlcnNpb24gMC4xIC0tIDI4IEFwcmlsIDIwMTIK
ICovCgovKioKICogU2V0dXAgdGFicyBhbmQgY2FsbGJhY2sKICovCgppZiAoQHR4cGludGVy
ZmFjZSA9PSAnYWRtaW4nKSB7CgogICAgYWRkX3ByaXZzKCdzcGZfZXh0JywgJzEnKTsKICAg
IHJlZ2lzdGVyX3RhYignZXh0ZW5zaW9ucycsICdzcGZfZXh0JywgZ1R4dCgnc3BmX2V4dF9m
aWxlcycpKTsKICAgIHJlZ2lzdGVyX2NhbGxiYWNrKCdzcGZfZXh0X2d1aScsICdzcGZfZXh0
Jyk7CiAgICByZWdpc3Rlcl9jYWxsYmFjaygnc3BmX2V4dF9pbnN0YWxsJywgJ3BsdWdpbl9s
aWZlY3ljbGUuc3BmX2V4dCcpOwoKfQoKLyoqCiAqIEdVSSBmdW5jdGlvbnMgLyBzdGVwIGRp
c3BhdGNoZXIKICovCgpmdW5jdGlvbiBzcGZfZXh0X2d1aSgpIHsKCiAgICBnbG9iYWwgJGV2
ZW50LCAkc3RlcDsKCiAgICBpZiAoJGV2ZW50ID09ICdzcGZfZXh0JykgewogICAgICAgIHJl
cXVpcmVfcHJpdnMoJ3NwZl9leHQnKTsKCiAgICAgICAgYm91bmNlcigkc3RlcCwKICAgICAg
ICAgICAgYXJyYXkoCiAgICAgICAgICAgICAgICAnc3BmX2V4dF9lZGl0X3JhdycgICA9PiBm
YWxzZSwKICAgICAgICAgICAgICAgICdwb3VyJyAgICAgICAgICAgICAgPT4gZmFsc2UsCiAg
ICAgICAgICAgICAgICAnc3BmX2V4dF9zYXZlJyAgICAgICA9PiB0cnVlLAogICAgICAgICAg
ICAgICAgJ3NwZl9leHRfY29weScgICAgICAgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdz
cGZfZXh0X2RlbGV0ZScgICAgID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3BmX2V4dF9l
ZGl0JyAgICAgICA9PiBmYWxzZSwKICAgICAgICAgICAgKQogICAgICAgICk7CgogICAgICAg
IHN3aXRjaCAoJHN0ZXApIHsKICAgICAgICAgICAgY2FzZSAnJzogc3BmX2V4dF9lZGl0KCk7
ICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdzcGZf
ZXh0X2VkaXRfcmF3Jzogc3BmX2V4dF9lZGl0KCk7ICAgICAgICAgIGJyZWFrOwogICAgICAg
ICAgICBjYXNlICdwb3VyJzogc3BmX2V4dF9lZGl0KCk7ICAgICAgICAgICAgICAgICAgICAg
YnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3NwZl9leHRfc2F2ZSc6IHNwZl9leHRfc2F2ZSgp
OyAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3NwZl9leHRfY29weSc6
IHNwZl9leHRfY29weSgpOyAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug
J3NwZl9leHRfZGVsZXRlJzogc3BmX2V4dF9kZWxldGUoKTsgICAgICAgICAgYnJlYWs7CiAg
ICAgICAgICAgIGNhc2UgJ3NwZl9leHRfZWRpdCc6IHNwZl9leHRfZWRpdCgpOwogICAgICAg
IH0KICAgIH0KfQoKLyoqCiAqIEluc3RhbGxlciBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNw
Zl9leHRfaW5zdGFsbCgkZXZlbnQ9JycsICRzdGVwPScnKSB7CgogICAgZ2xvYmFsICRwcmVm
czsKCiAgICBpZigkc3RlcCA9PSAnZGVsZXRlZCcpIHsKCiAgICAgICAgc2FmZV9kZWxldGUo
CiAgICAgICAgICAgICd0eHBfcHJlZnMnLAogICAgICAgICAgICAibmFtZT0nc3BmX2pzX2Rp
ciciCiAgICAgICAgKTsKCiAgICAgICAgLy8gRG9uJ3QgZHJvcCB0aGUgdGFibGUgLSBqdXN0
IGluIGNhc2UuLgogICAgICAgIC8vQHNhZmVfcXVlcnkoCiAgICAgICAgLy8gICAgJ0RST1Ag
VEFCTEUgSUYgRVhJU1RTICcuc2FmZV9wZngoJ3NwZl9qcycpCiAgICAgICAgLy8pOwoKICAg
ICAgICAvLyBkZWxldGUgdGhlIFRleHRwYWNrCgogICAgICAgIHNhZmVfZGVsZXRlKAogICAg
ICAgICAgICAndHhwX2xhbmcnLAogICAgICAgICAgICAiZXZlbnQgPSAnc3BmX2pzJyIKICAg
ICAgICApOwoKICAgICAgICByZXR1cm47CgogICAgfQoKICAgIGlmKCFpc3NldCgkcHJlZnNb
J3NwZl9leHRfZGlyJ10pKSB7CgogICAgICAgIHNhZmVfcXVlcnkoCiAgICAgICAgICAgICJD
UkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyAiLnNhZmVfcGZ4KCdzcGZfZXh0JykuIiAoCiAg
ICAgICAgICAgICAgICBmaWxlbmFtZSB2YXJjaGFyKDI1NSkgTk9UIE5VTEwgZGVmYXVsdCAn
JywKICAgICAgICAgICAgICAgIGNvbnRlbnQgbG9uZ3RleHQgTk9UIE5VTEwsCiAgICAgICAg
ICAgICAgICBQUklNQVJZIEtFWShmaWxlbmFtZSkKICAgICAgICAgICAgKSBDSEFSU0VUPXV0
ZjgiCiAgICAgICAgKTsKCiAgICAgICAgaWYoIXNhZmVfY291bnQoInNwZl9leHQiLCAiZmls
ZW5hbWU9J2hlbGxvLnBocCciKSkgewoKICAgICAgICAgICAgc2FmZV9pbnNlcnQoInNwZl9q
cyIsICJmaWxlbmFtZT0nZGVmYXVsdCcsIGNvbnRlbnQ9Jzw/cGhwIHByaW50ICdIZWxsbyBX
b3JsZCc7ID8+JyIpOwoKICAgICAgICB9CgogICAgICAgIHNhZmVfaW5zZXJ0KAogICAgICAg
ICAgICAndHhwX3ByZWZzJywKICAgICAgICAgICAgInByZWZzX2lkPTEsCiAgICAgICAgICAg
IG5hbWU9J3NwZl9leHRfZGlyJywKICAgICAgICAgICAgdmFsPSdleHRfZmlsZXMnLAogICAg
ICAgICAgICB0eXBlPTEsCiAgICAgICAgICAgIGV2ZW50PSdhZG1pbicsCiAgICAgICAgICAg
IGh0bWw9J3RleHRfaW5wdXQnLAogICAgICAgICAgICBwb3NpdGlvbj0yMiIKICAgICAgICAp
OwogICAgfQp9CgovKioKICogTGlzdCBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNwZl9leHRf
bGlzdCgkY3VycmVudCkgewoKICAgICRvdXRbXSA9IHN0YXJ0VGFibGUoJ2xpc3QnLCAnbGVm
dCcpOwoKICAgICRycyA9IHNhZmVfcm93c19zdGFydCgnZmlsZW5hbWUnLCAnc3BmX2V4dCcs
ICIxPTEiKTsKCiAgICBpZiAoJHJzKSB7CgogICAgICAgIHdoaWxlICgkYSA9IG5leHRSb3co
JHJzKSkgewogICAgICAgICAgICBleHRyYWN0KCRhKTsKICAgICAgICAgICAgJGVkaXQgPSAo
JGN1cnJlbnQgIT0gJGZpbGVuYW1lKSA/IGVMaW5rKCdzcGZfZXh0JywgJycsICdmaWxlbmFt
ZScsICRmaWxlbmFtZSwgJGZpbGVuYW1lKSA6IGh0bWxzcGVjaWFsY2hhcnMoJGZpbGVuYW1l
KTsKICAgICAgICAgICAgJGRlbGV0ZSA9ICgkZmlsZW5hbWUpID8gZExpbmsoJ3NwZl9leHQn
LCAnc3BmX2V4dF9kZWxldGUnLCAnZmlsZW5hbWUnLCAkZmlsZW5hbWUpIDogJyc7CiAgICAg
ICAgICAgICRvdXRbXSA9IHRyKHRkKCRlZGl0KS50ZCgkZGVsZXRlKSk7CiAgICAgICAgfQoK
ICAgICAgICAkb3V0W10gPSAgZW5kVGFibGUoKTsKCiAgICAgICAgcmV0dXJuIGpvaW4oJycs
ICRvdXQpOwoKICAgIH0KfQoKLyoqCiAqIEVkaXQgZnVuY3Rpb24KICovCgpmdW5jdGlvbiBz
cGZfZXh0X2VkaXQoJG1lc3NhZ2U9JycpIHsKCiAgICBwYWdldG9wKGdUeHQoJ3NwZl9leHRf
ZmlsZXMnKSwkbWVzc2FnZSk7CiAgICBnbG9iYWwgJHN0ZXAsICRwcmVmczsKICAgIHNwZl9l
eHRfZWRpdF9yYXcoKTsKCn0KCi8qKgogKiBFZGl0IGZ1bmN0aW9uIChyYXcpCiAqLwoKZnVu
Y3Rpb24gc3BmX2V4dF9lZGl0X3JhdygpIHsKCiAgICBnbG9iYWwgJGV2ZW50LCAkc3RlcDsK
CiAgICAkZmlyc3QgPSBzYWZlX3JvdygnZmlsZW5hbWUnLCAnc3BmX2V4dCcsICIxPTEiKTsK
ICAgICRmaXJzdF9maWxlID0gJGZpcnN0WydmaWxlbmFtZSddOwoKICAgIGV4dHJhY3QoZ3Bz
YShhcnJheSgnZmlsZW5hbWUnLCAnbmV3bmFtZScsICdjb3B5JywgJ3NhdmVuZXcnKSkpOwoK
ICAgIGlmICgkc3RlcCA9PSAnc3BmX2V4dF9kZWxldGUnIHx8IGVtcHR5KCRmaWxlbmFtZSkg
JiYgJHN0ZXAgIT0gJ3BvdXInICYmICEkc2F2ZW5ldykgewoKICAgICAgICAkZmlsZW5hbWUg
PSAkZmlyc3RfZmlsZTsKCiAgICB9CgogICAgZWxzZWlmICgoJGNvcHkgfHwgJHNhdmVuZXcp
ICYmIHRyaW0ocHJlZ19yZXBsYWNlKCcvWzw+JiJcJ10vJywgJycsICRuZXduYW1lKSkpIHsK
CiAgICAgICAgJGZpbGVuYW1lID0gJG5ld25hbWU7CgogICAgfQoKICAgIGlmIChlbXB0eSgk
ZmlsZW5hbWUpKSB7CgogICAgICAgICRidXR0b25zID0gJzxkaXYgY2xhc3M9ImVkaXQtdGl0
bGUiPicuCiAgICAgICAgZ1R4dCgnc3BmX2ZpbGVfbmFtZScpLic6ICcKICAgICAgICAuZklu
cHV0KCd0ZXh0JywnbmV3bmFtZScsJycsJ2VkaXQnLCcnLCcnLDIwKS4KICAgICAgICBoSW5w
dXQoJ3NhdmVuZXcnLCdzYXZlbmV3JykuCiAgICAgICAgJzwvZGl2Pic7CiAgICAgICAgJGZp
bGVjb250ZW50ID0gZ3BzKCdzcGZfZXh0Jyk7CgogICAgfSBlbHNlIHsKCiAgICAgICAgJGJ1
dHRvbnMgPSAnPGRpdiBjbGFzcz0iZWRpdC10aXRsZSI+Jy5nVHh0KCdzcGZfZWRpdF9zY3Jp
cHQnKS5zcC5zdHJvbmcoaHRtbHNwZWNpYWxjaGFycygkZmlsZW5hbWUpKS4nPC9kaXY+JzsK
ICAgICAgICAkZmlsZWNvbnRlbnQgPSBmZXRjaCgiY29udGVudCIsJ3NwZl9leHQnLCdmaWxl
bmFtZScsJGZpbGVuYW1lKTsKCiAgICB9CgogICAgaWYgKCFlbXB0eSgkZmlsZW5hbWUpKSB7
CgogICAgICAgICRjb3B5ID0gJzxzcGFuIGNsYXNzPSJjb3B5LWFzIj48bGFiZWwgZm9yPSJj
b3B5LWZpbGUiPicuZ1R4dCgnc3BmX2NvcHlfZmlsZScpLic8L2xhYmVsPicuc3AuZklucHV0
KCd0ZXh0JywgJ25ld25hbWUnLCAnJywgJ2VkaXQnLCAnJywgJycsICcnLCAnJywgJ2NvcHkt
ZmlsZScpLnNwLgogICAgICAgICAgICBmSW5wdXQoJ3N1Ym1pdCcsICdjb3B5JywgZ1R4dCgn
Y29weScpLCAnc21hbGxlcmJveCcpLic8L3NwYW4+JzsKCiAgICB9IGVsc2UgewoKICAgICAg
ICAkY29weSA9ICcnOwoKICAgIH0KCiAgICAkcmlnaHQgPQogICAgJzxkaXYgaWQ9ImNvbnRl
bnRfc3dpdGNoZXIiPicuCiAgICBoZWQoZ1R4dCgnc3BmX2FsbF9maWxlcycpLDIpLgogICAg
Z3JhZihzTGluaygnc3BmX2V4dCcsICdwb3VyJywgZ1R4dCgnc3BmX2NyZWF0ZV9uZXdfZmls
ZScpKSwgJyBjbGFzcz0iYWN0aW9uLWNyZWF0ZSBzbWFsbGVyYm94IicpLgogICAgc3BmX2V4
dF9saXN0KCRmaWxlbmFtZSkuCiAgICAnPC9kaXY+JzsKCiAgICBlY2hvCiAgICAnPGRpdiBp
ZD0iJy4kZXZlbnQuJ19jb250YWluZXIiIGNsYXNzPSJ0eHAtY29udGFpbmVyIHR4cC1lZGl0
Ij4nLgogICAgc3RhcnRUYWJsZSgnZWRpdCcpLgogICAgdHIoCiAgICAgICAgdGQoCiAgICAg
ICAgICAgIGZvcm0oCiAgICAgICAgICAgICAgICAnPGRpdiBpZD0ibWFpbl9jb250ZW50Ij4n
LgogICAgICAgICAgICAgICAgJGJ1dHRvbnMuCiAgICAgICAgICAgICAgICAnPHRleHRhcmVh
IGlkPSJzcGZfZXh0IiBjbGFzcz0iY29kZSIgbmFtZT0ic3BmX2V4dCIgY29scz0iNzgiIHJv
d3M9IjMyIiBzdHlsZT0ibWFyZ2luLXRvcDogNnB4OyB3aWR0aDogNzAwcHg7IGhlaWdodDog
NTE1cHg7Ij4nLmh0bWxzcGVjaWFsY2hhcnMoJGZpbGVjb250ZW50KS4nPC90ZXh0YXJlYT4n
LmJyLgogICAgICAgICAgICAgICAgZklucHV0KCdzdWJtaXQnLCcnLGdUeHQoJ3NhdmUnKSwn
cHVibGlzaCcpLgogICAgICAgICAgICAgICAgZUlucHV0KCdzcGZfZXh0Jykuc0lucHV0KCdz
cGZfZXh0X3NhdmUnKS4KICAgICAgICAgICAgICAgIGhJbnB1dCgnZmlsZW5hbWUnLCRmaWxl
bmFtZSkKICAgICAgICAgICAgICAgIC4kY29weS4KICAgICAgICAgICAgICAgICc8L2Rpdj4n
CiAgICAgICAgICAgICwgJycsICcnLCAncG9zdCcsICdlZGl0LWZvcm0nLCAnJywgJ3N0eWxl
X2Zvcm0nKQogICAgICAgICwgJycsICdjb2x1bW4nKS4KICAgICAgICB0ZHRsKAogICAgICAg
ICAgICAkcmlnaHQKICAgICAgICAsICcgY2xhc3M9ImNvbHVtbiInKQogICAgKS4KICAgIGVu
ZFRhYmxlKCkuCiAgICAnPC9kaXY+JzsKfQoKLyoqCiAqIENvcHkgZnVuY3Rpb24KICoKICov
CgpmdW5jdGlvbiBzcGZfZXh0X2NvcHkoKSB7CgogICAgZXh0cmFjdChncHNhKGFycmF5KCdv
bGRuYW1lJywgJ25ld25hbWUnKSkpOwoKICAgICRjb250ZW50ID0gZG9TbGFzaChmZXRjaCgn
Y29udGVudCcsICdzcGZfZXh0JywgJ2ZpbGVuYW1lJywgJG9sZG5hbWUpKTsKCiAgICAkcnMg
PSBzYWZlX2luc2VydCgnc3BmX2V4dCcsICJjb250ZW50ID0gJyRjb250ZW50JywgZmlsZW5h
bWUgPSAnIi5kb1NsYXNoKCRuZXduYW1lKS4iJyIpOwoKICAgIHNwZl9leHRfZWRpdCgKICAg
ICAgICBnVHh0KCdzcGZfZmlsZV9jcmVhdGVkJywgYXJyYXkoJ3tuYW1lfScgPT4gJG5ld25h
bWUpKQogICAgKTsKfQoKLyoqCiAqIFNhdmUgZnVuY3Rpb24KICovCgpmdW5jdGlvbiBzcGZf
ZXh0X3NhdmUoKSB7CgogICAgZXh0cmFjdChncHNhKGFycmF5KCdmaWxlbmFtZScsJ3NwZl9l
eHQnLCdzYXZlbmV3JywnbmV3bmFtZScsJ2NvcHknKSkpOwogICAgJGNvbnRlbnQgPSBkb1Ns
YXNoKCRzcGZfZXh0KTsKCiAgICBpZiAoJHNhdmVuZXcgb3IgJGNvcHkpIHsKCiAgICAgICAg
JG5ld25hbWUgPSBkb1NsYXNoKHRyaW0ocHJlZ19yZXBsYWNlKCcvWzw+JiJcJ10vJywgJycs
IGdwcygnbmV3bmFtZScpKSkpOwoKICAgICAgICBpZiAoJG5ld25hbWUgYW5kIHNhZmVfZmll
bGQoJ2ZpbGVuYW1lJywgJ3NwZl9leHQnLCAiZmlsZW5hbWUgPSAnJG5ld25hbWUnIikpIHsK
CiAgICAgICAgICAgICRtZXNzYWdlID0gZ1R4dCgnc3BmX2ZpbGVfZXhpc3RzJywgYXJyYXko
J3tuYW1lfScgPT4gJG5ld25hbWUpKTsKCiAgICAgICAgICAgIGlmICgkc2F2ZW5ldykgewoK
ICAgICAgICAgICAgICAgICRfUE9TVFsnbmV3bmFtZSddID0gJyc7CgogICAgICAgICAgICB9
CgogICAgICAgIH0gZWxzZWlmICgkbmV3bmFtZSkgewoKICAgICAgICAgICAgc2FmZV9pbnNl
cnQoJ3NwZl9leHQnLCAiZmlsZW5hbWUgPSAnIi4kbmV3bmFtZS4iJywgY29udGVudCA9ICck
Y29udGVudCciKTsKCiAgICAgICAgICAgICRtZXNzYWdlID0gZ1R4dCgnc3BmX2ZpbGVfY3Jl
YXRlZCcsIGFycmF5KCd7bmFtZX0nID0+ICRuZXduYW1lKSk7CgogICAgICAgICAgICBzcGZf
ZXh0X3dyaXRlKCk7CgogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICAkbWVzc2FnZSA9
IGFycmF5KGdUeHQoJ3NwZl9maWxlX25hbWVfcmVxdWlyZWQnKSwgRV9FUlJPUik7CgogICAg
ICAgIH0KCiAgICAgICAgc3BmX2V4dF9lZGl0KCRtZXNzYWdlKTsKCiAgICB9IGVsc2UgewoK
ICAgICAgICBzYWZlX3VwZGF0ZSgnc3BmX2V4dCcsICJjb250ZW50ID0gJyRjb250ZW50JyIs
ICJmaWxlbmFtZSA9ICciLmRvU2xhc2goJGZpbGVuYW1lKS4iJyIpOwoKICAgICAgICAkbWVz
c2FnZSA9IGdUeHQoJ3NwZl9maWxlX3VwZGF0ZWQnLCBhcnJheSgne25hbWV9JyA9PiAkZmls
ZW5hbWUpKTsKCiAgICAgICAgc3BmX2V4dF93cml0ZSgpOwoKICAgICAgICBzcGZfZXh0X2Vk
aXQoJG1lc3NhZ2UpOwoKICAgIH0KCn0KCi8qKgogKiBXcml0ZSBmdW5jdGlvbgogKi8KCmZ1
bmN0aW9uIHNwZl9leHRfd3JpdGUoKSB7CgogICAgZ2xvYmFsICRwcmVmczsKICAgIGV4dHJh
Y3QoZ3BzYShhcnJheSgnZmlsZW5hbWUnLCdzcGZfZXh0Jywnc2F2ZW5ldycsJ25ld25hbWUn
LCdjb3B5JykpKTsKCiAgICAkZmlsZW5hbWUgPSAocHMoJ2NvcHknKSBvciBwcygnc2F2ZW5l
dycpKSA/IHBzKCduZXduYW1lJykgOiBwcygnZmlsZW5hbWUnKTsKICAgICRmaWxlID0gJHBy
ZWZzWydwYXRoX3RvX3NpdGUnXS4nLycuJHByZWZzWydzcGZfZXh0X2RpciddLicvJy4kZmls
ZW5hbWU7CgogICAgaWYgKGVtcHR5KCRwcmVmc1snc3BmX2V4dF9kaXInXSkgb3IgISRmaWxl
bmFtZSkgewoKICAgICAgICByZXR1cm47CgogICAgfSBlbHNlIHsKCiAgICAkY29udGVudF9y
YXcgPSBmZXRjaCgiY29udGVudCIsICJzcGZfZXh0IiwgJ2ZpbGVuYW1lJywgJGZpbGVuYW1l
KTsgLy8gTW92ZWQgaGVyZSB0byBzYXZlIG5ld2x5LWNyZWF0ZWQgZmlsZXMKCiAgICAgICAg
JGhhbmRsZSA9IGZvcGVuKCRmaWxlLCAnd2InKTsKICAgICAgICBmd3JpdGUoJGhhbmRsZSwg
JGNvbnRlbnRfcmF3KTsKICAgICAgICBmY2xvc2UoJGhhbmRsZSk7CiAgICAgICAgY2htb2Qo
JGZpbGUsIDA2NDQpOwogICAgfQoKfQoKLyoqCiAqIERlbGV0ZSBmdW5jdGlvbgogKi8KCmZ1
bmN0aW9uIHNwZl9leHRfZGVsZXRlKCkgewoKICAgIGdsb2JhbCAkcHJlZnM7CgogICAgJGZp
bGVuYW1lID0gcHMoJ2ZpbGVuYW1lJyk7CiAgICAkZmlsZSA9ICRwcmVmc1sncGF0aF90b19z
aXRlJ10uJy8nLiRwcmVmc1snc3BmX2V4dF9kaXInXS4nLycuJGZpbGVuYW1lOwoKICAgICAg
ICBpZiAoIWVtcHR5KCRwcmVmc1snc3BmX2V4dF9kaXInXSkgYW5kICRmaWxlbmFtZSkgewoK
ICAgICAgICAgICAgc2FmZV9kZWxldGUoJ3NwZl9leHQnLCAiZmlsZW5hbWUgPSAnIi5kb1Ns
YXNoKCRmaWxlbmFtZSkuIiciKTsKCiAgICAgICAgICAgIEB1bmxpbmsoJGZpbGUpOwoKICAg
ICAgICBzcGZfZXh0X2VkaXQoCgogICAgICAgICAgICBnVHh0KCdzcGZfZmlsZV9kZWxldGVk
JywgYXJyYXkoJ3tuYW1lfScgPT4gJGZpbGVuYW1lKSkKICAgICAgICApOwoKICAgIH0gZWxz
ZSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKfSI7czozOiJtZDUiO3M6MzI6IjMwZGZmNjQx
ZGMwMDBlYTRhNDNmMGM1YjAwZmUwNTRkIjt9
