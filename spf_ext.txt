# spf_ext v0.1
# External file editor
# Simon Finch
# https://github.com/spiffin/spf_ext

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMjp7czo0OiJuYW1lIjtzOjc6InNwZl9leHQiO3M6NzoidmVyc2lvbiI7czozOiIwLjEi
O3M6NjoiYXV0aG9yIjtzOjExOiJTaW1vbiBGaW5jaCI7czoxMDoiYXV0aG9yX3VyaSI7czoz
NDoiaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dCI7czoxMToiZGVzY3JpcHRp
b24iO3M6MjA6IkV4dGVybmFsIGZpbGUgZWRpdG9yIjtzOjU6Im9yZGVyIjtzOjE6IjUiO3M6
NDoidHlwZSI7czoxOiIzIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6ODoidGV4dHBhY2siO3M6
NTg3OiIjQHNwZl9leHQKc3BmX2V4dF9maWxlcyA9PiBFeHRlcm5hbCBGaWxlcwpzcGZfZXh0
X2RpciA9PiBFeHRlcm5hbCBmaWxlcyBkaXJlY3RvcnkKc3BmX2ZpbGVuYW1lID0+IEZpbGVu
YW1lCnNwZl9lZGl0X2ZpbGUgPT4gWW91IGFyZSBlZGl0aW5nIGZpbGUKc3BmX2FsbF9maWxl
cyA9PiBBbGwgRmlsZXMKc3BmX2ZpbGVfdXBkYXRlZCA9PiBGaWxlIDxzdHJvbmc+e25hbWV9
PC9zdHJvbmc+IHVwZGF0ZWQuCnNwZl9maWxlX25hbWUgPT4gRXh0ZXJuYWwgZmlsZSBuYW1l
CnNwZl9jb3B5X2ZpbGUgPT4gJiM4MjMwO29yIGNvcHkgZmlsZSBhcwpzcGZfY3JlYXRlX25l
d19maWxlID0+IENyZWF0ZSBuZXcgZmlsZQpzcGZfZmlsZV9jcmVhdGVkID0+IEZpbGUgPHN0
cm9uZz57bmFtZX08L3N0cm9uZz4gY3JlYXRlZC4Kc3BmX2ZpbGVfbmFtZV9yZXF1aXJlZCA9
PiBQbGVhc2UgcHJvdmlkZSBhIG5hbWUgZm9yIHlvdXIgZmlsZS4Kc3BmX2ZpbGVfZXhpc3Rz
ID0+IEZpbGUgPHN0cm9uZz57bmFtZX08L3N0cm9uZz4gYWxyZWFkeSBleGlzdHMuCnNwZl9m
aWxlX2RlbGV0ZWQgPT4gRmlsZSA8c3Ryb25nPntuYW1lfTwvc3Ryb25nPiBkZWxldGVkLiI7
czo0OiJoZWxwIjtzOjMxMTE6IjxoMSBpZD0ic3BmX2V4dCI+c3BmX2V4dDwvaDE+Cgo8cD5F
eHRlcm5hbCBmaWxlIGVkaXRvciBwbHVnaW4uIENyZWF0ZSwgZWRpdCBhbmQgZGVsZXRlIGV4
dGVybmFsICh0byBUZXh0cGF0dGVybikgZmlsZXMgaW4gVGV4dHBhdHRlcm4gYWRtaW4uPC9w
Pgo8cD5SRVFVSVJFUzogVGV4cGF0dGVybiA0LjQuMSBhbmQgUEhQIDUgYW5kIHNoZWxsIGFj
Y2VzcyAoZm9yIHN5bS1saW5raW5nIGV4aXN0aW5nIGZpbGVzKS48L3A+CjxwPjxzdHJvbmc+
UGxlYXNlIHJlYWQgdGhlIGluc3RydWN0aW9ucyBhbmQgbm90ZXMgYmVsb3cgYmVmb3JlIHVz
ZS48L3N0cm9uZz48L3A+CjxwPlRoaXMgcGx1Z2luIGNyZWF0ZXMgZXh0ZXJuYWwgZmlsZXMg
eW91IGNhbiBtYW5hZ2UgYW5kIGVkaXQgdmlhIHRoZSBhZG1pbiBpbnRlcmZhY2UuIEFsbCBm
aWxlcyBhcmUgc2F2ZWQgdG8gdGhlIGRpcmVjdG9yeSB5b3UgY3JlYXRlIGluIHN0ZXAgMSBv
ZiB0aGUgaW5zdHJ1Y3Rpb25zIGJlbG93LiBTeW50YXggaGlnaGxpZ2h0aW5nIGlzIGF2YWls
YWJsZSB2aWEgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2NvZGVt
aXJyb3IiPnNwZl9jb2RlbWlycm9yPC9hPiAoY3VycmVudGx5IEhUTUwsIFBIUCBhbmQgSmF2
YVNjcmlwdCAtIG1vcmUgdG8gY29tZSkuPC9wPgoKPGgyIGlkPSJ3aHkiPldoeT88L2gyPgo8
dWw+CjxsaT5UaGlzIHBsdWdpbiBhbGxvd3MgeW91IHRvIGVkaXQgYW5kIG1hbmFnZSBzaXRl
IGZpbGVzIHJlc2lkaW5nIG91dHNpZGUgVGV4dHBhdHRlcm4gd2l0aGluIHRoZSBUZXh0cGF0
dGVybiBhZG1pbiBhcmVhIChzZWUg4oCYUHJvY2VkdXJlIGZvciBtYW5hZ2luZyBleGlzdGlu
ZyBmaWxlc+KAmSBiZWxvdykuPC9saT4KPGxpPkl0IG9mZmVycyBhbiBlYXN5IHdheSB0byBj
cmVhdGUgc3RhdGljIGZpbGVzIHlvdSBjYW4gZWRpdCBhbmQgYWNjZXNzIHZpYSB5b3VyIHBh
Z2UgdGVtcGxhdGVzOiA8Y29kZT4mbHQ7dHhwOnNpdGVfdXJsIC8mZ3Q7ZXh0X2ZpbGVzL3lv
dXJmaWxlLmh0bWw8L2NvZGU+PC9saT4KPC91bD4KCjxociAvPgoKPGgyIGlkPSJpbnN0cnVj
dGlvbnMiPkluc3RydWN0aW9uczo8L2gyPgoKPG9sPgo8bGk+Q3JlYXRlIGEgZGlyZWN0b3J5
IGZvciB0aGUgc3RhdGljIGV4dGVybmFsIGZpbGVzIGluIHRoZSByb290IG9mIHlvdXIgdGV4
dHBhdHRlcm4gaW5zdGFsbGF0aW9uIGNhbGxlZCDigJhleHRfZmlsZXPigJkgKG9yIHdoYXRl
dmVyIHlvdSBsaWtlKS4gWW91IHNob3VsZCBtYWtlIHN1cmUgdGhhdCBQSFAgaXMgYWJsZSB0
byB3cml0ZSB0byB0aGF0IGRpcmVjdG9yeS48L2xpPgo8bGk+VmlzaXQgdGhlIGFkdmFuY2Vk
IHByZWZlcmVuY2VzIGFuZCBtYWtlIHN1cmUgdGhlIOKAnEV4dGVybmFsIGZpbGVzIGRpcmVj
dG9yeeKAnSBwcmVmZXJlbmNlIGNvbnRhaW5zIHRoZSBkaXJlY3RvcnkgeW91IGNyZWF0ZWQg
aW4gc3RlcCAxIChieSBkZWZhdWx0IOKAmGV4dF9maWxlc+KAmSkuIFRoaXMgcGF0aCBpcyBy
ZWxhdGl2ZSBwYXRoIHRvIHRoZSBkaXJlY3Rvcnkgb2YgeW91ciByb290IFRleHRwYXR0ZXJu
IGluc3RhbGxhdGlvbi48L2xpPgo8bGk+QWN0aXZhdGUgdGhpcyBwbHVnaW4uPC9saT4KPGxp
PkdvIHRvIEV4dGVuc2lvbnMgJmd0OyBFeHRlcm5hbCBGaWxlcyBhbmQgY3JlYXRlIGZpbGVz
IHlvdeKAmWQgbGlrZSB0byBtYW5hZ2UuPC9saT4KPGxpPkFsd2F5cyBpbmNsdWRlIGEgZmls
ZSBleHRlbnNpb24gaW4gdGhlIGZpbGUgbmFtZSAoLmh0bWwsIC5waHAsIGV0Yy4pLjwvbGk+
Cjwvb2w+Cgo8aDIgaWQ9InByb2NlZHVyZS1mb3ItbWFuYWdpbmctZXhpc3RpbmctZmlsZXMi
PlByb2NlZHVyZSBmb3IgbWFuYWdpbmcgZXhpc3RpbmcgZmlsZXM6PC9oMj4KPG9sPgo8bGk+
Q29weSB0aGUgY29udGVudHMgb2YgdGhlIGZpbGUgKGNhbGxlZCBmb3IgZXhhbXBsZSBteWZp
bGUucGhwKSBpbnRvIGEgbmV3IGZpbGUgaW4gRXh0ZW5zaW9ucyAmZ3Q7IEV4dGVybmFsIEZp
bGVzICZndDsgQ3JlYXRlIG5ldyBmaWxlLjwvbGk+CjxsaT5OYW1lIHRoZSBuZXcgZmlsZSAo
RXh0ZXJuYWwgZmlsZSBuYW1lOikg4oCYbXlmaWxlLnBocOKAmS48L2xpPgo8bGk+UmVuYW1l
IHRoZSBvcmlnaW5hbCBmaWxlICh0bywgZm9yIGV4YW1wbGUsIOKAmG15ZmlsZV9vcmlnaW5h
bC5waHDigJkpIC0gdGhlbiB5b3XigJlsbCBoYXZlIGEgYmFja3VwLjwvbGk+CjxsaT5NYWtl
IGEgc3ltYm9saWMgbGluaywgaW4gdGhlIG9yaWdpbmFsIGZpbGUgbG9jYXRpb24sIHRvIHRo
ZSBuZXcgZmlsZSAoZS5nLiBjZCB0byB0aGUg4oCYZXh0X2ZpbGVz4oCZIGRpcmVjdG9yeSBh
bmQgdGhlbiDigJhsbiAtcyAvb3JpZ2luYWxfZGlyZWN0b3J5X3BhdGgvbXlmaWxlLnBocCAu
L215ZmlsZS5waHDigJkpLjwvbGk+Cjwvb2w+Cgo8aHIgLz4KCjxoMiBpZD0ibm90ZXMiPk5v
dGVzOjwvaDI+CjxvbD4KPGxpPllvdSBjYW4gb25seSBtYW5hZ2UgZmlsZXMgd2hpY2ggYXJl
IHJlYWQvd3JpdGUgdG8geW91ciB3ZWIgc2VydmVyIGUuZy4gTWluaWZ5IGNvbmZpZyBmaWxl
cywgZXh0ZXJuYWwgc2NyaXB0cywgZXRjLjwvbGk+CjxsaT5EZWxldGluZyBhIGZpbGUgdmlh
IHRoZSBFeHRlcm5hbCBGaWxlcyB0YWIgZGVsZXRlcyB0aGUgYWN0dWFsIGZpbGUgaW4gdGhl
IOKAmWV4dF9maWxlc+KAmSBkaXJlY3RvcnkgKGFzIHdlbGwgYXMgdGhlIGRhdGFiYXNlIGVu
dHJ5KSAtIHVzZSB3aXRoIGNhcmUhLjwvbGk+Cjwvb2w+CgoKPGgyIGlkPSJsYW5ndWFnZXMt
dGV4dHBhY2siPkxhbmd1YWdlcyAoVGV4dHBhY2spPC9oMj4KPHVsPgo8bGk+VGhpcyBwbHVn
aW4gaW5zdGFsbHMgYW4gRW5nbGlzaCBUZXh0cGFjayBieSBkZWZhdWx0LjwvbGk+CjxsaT5U
byBpbnN0YWxsIGEgVGV4dHBhY2sgZm9yIHlvdXIgb3duIGxhbmd1YWdlIHNlZSB0aGUgPGEg
aHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dC9ibG9iL21hc3Rlci9z
cGZfZXh0X3RleHRwYWNrLnR4dCI+aW5zdHJ1Y3Rpb25zIG9uIEdpdEh1YjwvYT4uPC9saT4K
PC91bD4KCjxoMiBpZD0idmVyc2lvbi1oaXN0b3J5Ij5WZXJzaW9uIGhpc3Rvcnk8L2gyPgo8
dWw+CjxsaT4wLjEgLSBBcHJpbCAyMDEyIC0gZmlyc3QgcmVsZWFzZS48L2xpPgo8L3VsPiI7
czo0OiJjb2RlIjtzOjg1NzQ6Ii8qKgogKiBzcGZfZXh0IC0gRXh0ZXJuYWwgZmlsZSBlZGl0
b3IgZm9yIFRleHRwYXR0ZXJuCiAqCiAqIMKpIDIwMTIgU2ltb24gRmluY2ggLSBodHRwczov
L2dpdGh1Yi5jb20vc3BpZmZpbi9zcGZfZXh0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIEdOVSBH
ZW5lcmFsIFB1YmxpYyBMaWNlbnNlIHZlcnNpb24gMgogKiBodHRwOi8vd3d3LmdudS5vcmcv
bGljZW5zZXMvZ3BsLTIuMC5odG1sCiAqCiAqIFZlcnNpb24gMC4xIC0tIDI4IEFwcmlsIDIw
MTIKICovCgovKioKICogU2V0dXAgdGFicyBhbmQgY2FsbGJhY2sKICovCgppZiAoQHR4cGlu
dGVyZmFjZSA9PSAnYWRtaW4nKSB7CgogICAgYWRkX3ByaXZzKCdzcGZfZXh0JywgJzEnKTsK
ICAgIHJlZ2lzdGVyX3RhYignZXh0ZW5zaW9ucycsICdzcGZfZXh0JywgZ1R4dCgnc3BmX2V4
dF9maWxlcycpKTsKICAgIHJlZ2lzdGVyX2NhbGxiYWNrKCdzcGZfZXh0X2d1aScsICdzcGZf
ZXh0Jyk7CiAgICByZWdpc3Rlcl9jYWxsYmFjaygnc3BmX2V4dF9pbnN0YWxsJywgJ3BsdWdp
bl9saWZlY3ljbGUuc3BmX2V4dCcpOwoKfQoKLyoqCiAqIEdVSSBmdW5jdGlvbnMgLyBzdGVw
IGRpc3BhdGNoZXIKICovCgpmdW5jdGlvbiBzcGZfZXh0X2d1aSgpIHsKCiAgICBnbG9iYWwg
JGV2ZW50LCAkc3RlcDsKCiAgICBpZiAoJGV2ZW50ID09ICdzcGZfZXh0JykgewogICAgICAg
IHJlcXVpcmVfcHJpdnMoJ3NwZl9leHQnKTsKCiAgICAgICAgYm91bmNlcigkc3RlcCwKICAg
ICAgICAgICAgYXJyYXkoCiAgICAgICAgICAgICAgICAnc3BmX2V4dF9lZGl0X3JhdycgICA9
PiBmYWxzZSwKICAgICAgICAgICAgICAgICdwb3VyJyAgICAgICAgICAgICAgPT4gZmFsc2Us
CiAgICAgICAgICAgICAgICAnc3BmX2V4dF9zYXZlJyAgICAgICA9PiB0cnVlLAogICAgICAg
ICAgICAgICAgJ3NwZl9leHRfY29weScgICAgICAgPT4gdHJ1ZSwKICAgICAgICAgICAgICAg
ICdzcGZfZXh0X2RlbGV0ZScgICAgID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3BmX2V4
dF9lZGl0JyAgICAgICA9PiBmYWxzZSwKICAgICAgICAgICAgKQogICAgICAgICk7CgogICAg
ICAgIHN3aXRjaCAoJHN0ZXApIHsKICAgICAgICAgICAgY2FzZSAnJzogc3BmX2V4dF9lZGl0
KCk7ICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdz
cGZfZXh0X2VkaXRfcmF3Jzogc3BmX2V4dF9lZGl0KCk7ICAgICAgICAgIGJyZWFrOwogICAg
ICAgICAgICBjYXNlICdwb3VyJzogc3BmX2V4dF9lZGl0KCk7ICAgICAgICAgICAgICAgICAg
ICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3NwZl9leHRfc2F2ZSc6IHNwZl9leHRfc2F2
ZSgpOyAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3NwZl9leHRfY29w
eSc6IHNwZl9leHRfY29weSgpOyAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh
c2UgJ3NwZl9leHRfZGVsZXRlJzogc3BmX2V4dF9kZWxldGUoKTsgICAgICAgICAgYnJlYWs7
CiAgICAgICAgICAgIGNhc2UgJ3NwZl9leHRfZWRpdCc6IHNwZl9leHRfZWRpdCgpOwogICAg
ICAgIH0KICAgIH0KfQoKLyoqCiAqIEluc3RhbGxlciBmdW5jdGlvbgogKi8KCmZ1bmN0aW9u
IHNwZl9leHRfaW5zdGFsbCgkZXZlbnQ9JycsICRzdGVwPScnKSB7CgogICAgZ2xvYmFsICRw
cmVmczsKCiAgICBpZigkc3RlcCA9PSAnZGVsZXRlZCcpIHsKCiAgICAgICAgc2FmZV9kZWxl
dGUoCiAgICAgICAgICAgICd0eHBfcHJlZnMnLAogICAgICAgICAgICAibmFtZT0nc3BmX2V4
dF9kaXInIgogICAgICAgICk7CgogICAgICAgIC8vIERvbid0IGRyb3AgdGhlIHRhYmxlIC0g
anVzdCBpbiBjYXNlLi4KICAgICAgICAvL0BzYWZlX3F1ZXJ5KAogICAgICAgIC8vICAgICdE
Uk9QIFRBQkxFIElGIEVYSVNUUyAnLnNhZmVfcGZ4KCdzcGZfZXh0JykKICAgICAgICAvLyk7
CgogICAgICAgIC8vIGRlbGV0ZSB0aGUgVGV4dHBhY2sKCiAgICAgICAgc2FmZV9kZWxldGUo
CiAgICAgICAgICAgICd0eHBfbGFuZycsCiAgICAgICAgICAgICJldmVudCA9ICdzcGZfZXh0
JyIKICAgICAgICApOwoKICAgICAgICByZXR1cm47CgogICAgfQoKICAgIGlmKCFpc3NldCgk
cHJlZnNbJ3NwZl9leHRfZGlyJ10pKSB7CgogICAgICAgIHNhZmVfcXVlcnkoCiAgICAgICAg
ICAgICJDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyAiLnNhZmVfcGZ4KCdzcGZfZXh0Jyku
IiAoCiAgICAgICAgICAgICAgICBmaWxlbmFtZSB2YXJjaGFyKDI1NSkgTk9UIE5VTEwgZGVm
YXVsdCAnJywKICAgICAgICAgICAgICAgIGNvbnRlbnQgbG9uZ3RleHQgTk9UIE5VTEwsCiAg
ICAgICAgICAgICAgICBQUklNQVJZIEtFWShmaWxlbmFtZSkKICAgICAgICAgICAgKSBDSEFS
U0VUPXV0ZjgiCiAgICAgICAgKTsKCiAgICAgICAgaWYoIXNhZmVfY291bnQoInNwZl9leHQi
LCAiZmlsZW5hbWU9J2hvbGRlci50eHQnIikpIHsKCiAgICAgICAgICAgIHNhZmVfaW5zZXJ0
KCJzcGZfZXh0IiwgImZpbGVuYW1lPSdob2xkZXIudHh0JywgY29udGVudD0nSG9sZGVyIHRl
eHQgZmlsZS4uLnlvdSBuZWVkIGF0IGxlYXN0IG9uZSBmaWxlIGhlcmUuJyIpOwoKICAgICAg
ICB9CgogICAgICAgIHNhZmVfaW5zZXJ0KAogICAgICAgICAgICAndHhwX3ByZWZzJywKICAg
ICAgICAgICAgInByZWZzX2lkPTEsCiAgICAgICAgICAgIG5hbWU9J3NwZl9leHRfZGlyJywK
ICAgICAgICAgICAgdmFsPSdleHRfZmlsZXMnLAogICAgICAgICAgICB0eXBlPTEsCiAgICAg
ICAgICAgIGV2ZW50PSdhZG1pbicsCiAgICAgICAgICAgIGh0bWw9J3RleHRfaW5wdXQnLAog
ICAgICAgICAgICBwb3NpdGlvbj0yMiIKICAgICAgICApOwogICAgfQp9CgovKioKICogTGlz
dCBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNwZl9leHRfbGlzdCgkY3VycmVudCkgewoKICAg
ICRvdXRbXSA9IHN0YXJ0VGFibGUoJ2xpc3QnLCAnbGVmdCcpOwoKICAgICRycyA9IHNhZmVf
cm93c19zdGFydCgnZmlsZW5hbWUnLCAnc3BmX2V4dCcsICIxPTEiKTsKCiAgICBpZiAoJHJz
KSB7CgogICAgICAgIHdoaWxlICgkYSA9IG5leHRSb3coJHJzKSkgewogICAgICAgICAgICBl
eHRyYWN0KCRhKTsKICAgICAgICAgICAgJGVkaXQgPSAoJGN1cnJlbnQgIT0gJGZpbGVuYW1l
KSA/IGVMaW5rKCdzcGZfZXh0JywgJycsICdmaWxlbmFtZScsICRmaWxlbmFtZSwgJGZpbGVu
YW1lKSA6IGh0bWxzcGVjaWFsY2hhcnMoJGZpbGVuYW1lKTsKICAgICAgICAgICAgJGRlbGV0
ZSA9ICgkZmlsZW5hbWUpID8gZExpbmsoJ3NwZl9leHQnLCAnc3BmX2V4dF9kZWxldGUnLCAn
ZmlsZW5hbWUnLCAkZmlsZW5hbWUpIDogJyc7CiAgICAgICAgICAgICRvdXRbXSA9IHRyKHRk
KCRlZGl0KS50ZCgkZGVsZXRlKSk7CiAgICAgICAgfQoKICAgICAgICAkb3V0W10gPSAgZW5k
VGFibGUoKTsKCiAgICAgICAgcmV0dXJuIGpvaW4oJycsICRvdXQpOwoKICAgIH0KfQoKLyoq
CiAqIEVkaXQgZnVuY3Rpb24KICovCgpmdW5jdGlvbiBzcGZfZXh0X2VkaXQoJG1lc3NhZ2U9
JycpIHsKCiAgICBwYWdldG9wKGdUeHQoJ3NwZl9leHRfZmlsZXMnKSwkbWVzc2FnZSk7CiAg
ICBnbG9iYWwgJHN0ZXAsICRwcmVmczsKICAgIHNwZl9leHRfZWRpdF9yYXcoKTsKCn0KCi8q
KgogKiBFZGl0IGZ1bmN0aW9uIChyYXcpCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9lZGl0X3Jh
dygpIHsKCiAgICBnbG9iYWwgJGV2ZW50LCAkc3RlcDsKCiAgICAkZmlyc3QgPSBzYWZlX3Jv
dygnZmlsZW5hbWUnLCAnc3BmX2V4dCcsICIxPTEiKTsKICAgICRmaXJzdF9maWxlID0gJGZp
cnN0WydmaWxlbmFtZSddOwoKICAgIGV4dHJhY3QoZ3BzYShhcnJheSgnZmlsZW5hbWUnLCAn
bmV3bmFtZScsICdjb3B5JywgJ3NhdmVuZXcnKSkpOwoKICAgIGlmICgkc3RlcCA9PSAnc3Bm
X2V4dF9kZWxldGUnIHx8IGVtcHR5KCRmaWxlbmFtZSkgJiYgJHN0ZXAgIT0gJ3BvdXInICYm
ICEkc2F2ZW5ldykgewoKICAgICAgICAkZmlsZW5hbWUgPSAkZmlyc3RfZmlsZTsKCiAgICB9
CgogICAgZWxzZWlmICgoJGNvcHkgfHwgJHNhdmVuZXcpICYmIHRyaW0ocHJlZ19yZXBsYWNl
KCcvWzw+JiJcJ10vJywgJycsICRuZXduYW1lKSkpIHsKCiAgICAgICAgJGZpbGVuYW1lID0g
JG5ld25hbWU7CgogICAgfQoKICAgIGlmIChlbXB0eSgkZmlsZW5hbWUpKSB7CgogICAgICAg
ICRidXR0b25zID0gJzxkaXYgY2xhc3M9ImVkaXQtdGl0bGUiPicuCiAgICAgICAgZ1R4dCgn
c3BmX2ZpbGVfbmFtZScpLic6ICcKICAgICAgICAuZklucHV0KCd0ZXh0JywnbmV3bmFtZScs
JycsJ2VkaXQnLCcnLCcnLDIwKS4KICAgICAgICBoSW5wdXQoJ3NhdmVuZXcnLCdzYXZlbmV3
JykuCiAgICAgICAgJzwvZGl2Pic7CiAgICAgICAgJGZpbGVjb250ZW50ID0gZ3BzKCdzcGZf
ZXh0Jyk7CgogICAgfSBlbHNlIHsKCiAgICAgICAgJGJ1dHRvbnMgPSAnPGRpdiBjbGFzcz0i
ZWRpdC10aXRsZSI+Jy5nVHh0KCdzcGZfZWRpdF9zY3JpcHQnKS5zcC5zdHJvbmcoaHRtbHNw
ZWNpYWxjaGFycygkZmlsZW5hbWUpKS4nPC9kaXY+JzsKICAgICAgICAkZmlsZWNvbnRlbnQg
PSBmZXRjaCgiY29udGVudCIsJ3NwZl9leHQnLCdmaWxlbmFtZScsJGZpbGVuYW1lKTsKCiAg
ICB9CgogICAgaWYgKCFlbXB0eSgkZmlsZW5hbWUpKSB7CgogICAgICAgICRjb3B5ID0gJzxz
cGFuIGNsYXNzPSJjb3B5LWFzIj48bGFiZWwgZm9yPSJjb3B5LWZpbGUiPicuZ1R4dCgnc3Bm
X2NvcHlfZmlsZScpLic8L2xhYmVsPicuc3AuZklucHV0KCd0ZXh0JywgJ25ld25hbWUnLCAn
JywgJ2VkaXQnLCAnJywgJycsICcnLCAnJywgJ2NvcHktZmlsZScpLnNwLgogICAgICAgICAg
ICBmSW5wdXQoJ3N1Ym1pdCcsICdjb3B5JywgZ1R4dCgnY29weScpLCAnc21hbGxlcmJveCcp
Lic8L3NwYW4+JzsKCiAgICB9IGVsc2UgewoKICAgICAgICAkY29weSA9ICcnOwoKICAgIH0K
CiAgICAkcmlnaHQgPQogICAgJzxkaXYgaWQ9ImNvbnRlbnRfc3dpdGNoZXIiPicuCiAgICBo
ZWQoZ1R4dCgnc3BmX2FsbF9maWxlcycpLDIpLgogICAgZ3JhZihzTGluaygnc3BmX2V4dCcs
ICdwb3VyJywgZ1R4dCgnc3BmX2NyZWF0ZV9uZXdfZmlsZScpKSwgJyBjbGFzcz0iYWN0aW9u
LWNyZWF0ZSBzbWFsbGVyYm94IicpLgogICAgc3BmX2V4dF9saXN0KCRmaWxlbmFtZSkuCiAg
ICAnPC9kaXY+JzsKCiAgICBlY2hvCiAgICAnPGRpdiBpZD0iJy4kZXZlbnQuJ19jb250YWlu
ZXIiIGNsYXNzPSJ0eHAtY29udGFpbmVyIHR4cC1lZGl0Ij4nLgogICAgc3RhcnRUYWJsZSgn
ZWRpdCcpLgogICAgdHIoCiAgICAgICAgdGQoCiAgICAgICAgICAgIGZvcm0oCiAgICAgICAg
ICAgICAgICAnPGRpdiBpZD0ibWFpbl9jb250ZW50Ij4nLgogICAgICAgICAgICAgICAgJGJ1
dHRvbnMuCiAgICAgICAgICAgICAgICAnPHRleHRhcmVhIGlkPSJzcGZfZXh0IiBjbGFzcz0i
Y29kZSIgbmFtZT0ic3BmX2V4dCIgY29scz0iNzgiIHJvd3M9IjMyIiBzdHlsZT0ibWFyZ2lu
LXRvcDogNnB4OyB3aWR0aDogNzAwcHg7IGhlaWdodDogNTE1cHg7Ij4nLmh0bWxzcGVjaWFs
Y2hhcnMoJGZpbGVjb250ZW50KS4nPC90ZXh0YXJlYT4nLmJyLgogICAgICAgICAgICAgICAg
ZklucHV0KCdzdWJtaXQnLCcnLGdUeHQoJ3NhdmUnKSwncHVibGlzaCcpLgogICAgICAgICAg
ICAgICAgZUlucHV0KCdzcGZfZXh0Jykuc0lucHV0KCdzcGZfZXh0X3NhdmUnKS4KICAgICAg
ICAgICAgICAgIGhJbnB1dCgnZmlsZW5hbWUnLCRmaWxlbmFtZSkKICAgICAgICAgICAgICAg
IC4kY29weS4KICAgICAgICAgICAgICAgICc8L2Rpdj4nCiAgICAgICAgICAgICwgJycsICcn
LCAncG9zdCcsICdlZGl0LWZvcm0nLCAnJywgJ3N0eWxlX2Zvcm0nKQogICAgICAgICwgJycs
ICdjb2x1bW4nKS4KICAgICAgICB0ZHRsKAogICAgICAgICAgICAkcmlnaHQKICAgICAgICAs
ICcgY2xhc3M9ImNvbHVtbiInKQogICAgKS4KICAgIGVuZFRhYmxlKCkuCiAgICAnPC9kaXY+
JzsKfQoKLyoqCiAqIENvcHkgZnVuY3Rpb24KICoKICovCgpmdW5jdGlvbiBzcGZfZXh0X2Nv
cHkoKSB7CgogICAgZXh0cmFjdChncHNhKGFycmF5KCdvbGRuYW1lJywgJ25ld25hbWUnKSkp
OwoKICAgICRjb250ZW50ID0gZG9TbGFzaChmZXRjaCgnY29udGVudCcsICdzcGZfZXh0Jywg
J2ZpbGVuYW1lJywgJG9sZG5hbWUpKTsKCiAgICAkcnMgPSBzYWZlX2luc2VydCgnc3BmX2V4
dCcsICJjb250ZW50ID0gJyRjb250ZW50JywgZmlsZW5hbWUgPSAnIi5kb1NsYXNoKCRuZXdu
YW1lKS4iJyIpOwoKICAgIHNwZl9leHRfZWRpdCgKICAgICAgICBnVHh0KCdzcGZfZmlsZV9j
cmVhdGVkJywgYXJyYXkoJ3tuYW1lfScgPT4gJG5ld25hbWUpKQogICAgKTsKfQoKLyoqCiAq
IFNhdmUgZnVuY3Rpb24KICovCgpmdW5jdGlvbiBzcGZfZXh0X3NhdmUoKSB7CgogICAgZXh0
cmFjdChncHNhKGFycmF5KCdmaWxlbmFtZScsJ3NwZl9leHQnLCdzYXZlbmV3JywnbmV3bmFt
ZScsJ2NvcHknKSkpOwogICAgJGNvbnRlbnQgPSBkb1NsYXNoKCRzcGZfZXh0KTsKCiAgICBp
ZiAoJHNhdmVuZXcgb3IgJGNvcHkpIHsKCiAgICAgICAgJG5ld25hbWUgPSBkb1NsYXNoKHRy
aW0ocHJlZ19yZXBsYWNlKCcvWzw+JiJcJ10vJywgJycsIGdwcygnbmV3bmFtZScpKSkpOwoK
ICAgICAgICBpZiAoJG5ld25hbWUgYW5kIHNhZmVfZmllbGQoJ2ZpbGVuYW1lJywgJ3NwZl9l
eHQnLCAiZmlsZW5hbWUgPSAnJG5ld25hbWUnIikpIHsKCiAgICAgICAgICAgICRtZXNzYWdl
ID0gZ1R4dCgnc3BmX2ZpbGVfZXhpc3RzJywgYXJyYXkoJ3tuYW1lfScgPT4gJG5ld25hbWUp
KTsKCiAgICAgICAgICAgIGlmICgkc2F2ZW5ldykgewoKICAgICAgICAgICAgICAgICRfUE9T
VFsnbmV3bmFtZSddID0gJyc7CgogICAgICAgICAgICB9CgogICAgICAgIH0gZWxzZWlmICgk
bmV3bmFtZSkgewoKICAgICAgICAgICAgc2FmZV9pbnNlcnQoJ3NwZl9leHQnLCAiZmlsZW5h
bWUgPSAnIi4kbmV3bmFtZS4iJywgY29udGVudCA9ICckY29udGVudCciKTsKCiAgICAgICAg
ICAgICRtZXNzYWdlID0gZ1R4dCgnc3BmX2ZpbGVfY3JlYXRlZCcsIGFycmF5KCd7bmFtZX0n
ID0+ICRuZXduYW1lKSk7CgogICAgICAgICAgICBzcGZfZXh0X3dyaXRlKCk7CgogICAgICAg
IH0gZWxzZSB7CgogICAgICAgICAgICAkbWVzc2FnZSA9IGFycmF5KGdUeHQoJ3NwZl9maWxl
X25hbWVfcmVxdWlyZWQnKSwgRV9FUlJPUik7CgogICAgICAgIH0KCiAgICAgICAgc3BmX2V4
dF9lZGl0KCRtZXNzYWdlKTsKCiAgICB9IGVsc2UgewoKICAgICAgICBzYWZlX3VwZGF0ZSgn
c3BmX2V4dCcsICJjb250ZW50ID0gJyRjb250ZW50JyIsICJmaWxlbmFtZSA9ICciLmRvU2xh
c2goJGZpbGVuYW1lKS4iJyIpOwoKICAgICAgICAkbWVzc2FnZSA9IGdUeHQoJ3NwZl9maWxl
X3VwZGF0ZWQnLCBhcnJheSgne25hbWV9JyA9PiAkZmlsZW5hbWUpKTsKCiAgICAgICAgc3Bm
X2V4dF93cml0ZSgpOwoKICAgICAgICBzcGZfZXh0X2VkaXQoJG1lc3NhZ2UpOwoKICAgIH0K
Cn0KCi8qKgogKiBXcml0ZSBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNwZl9leHRfd3JpdGUo
KSB7CgogICAgZ2xvYmFsICRwcmVmczsKICAgIGV4dHJhY3QoZ3BzYShhcnJheSgnZmlsZW5h
bWUnLCdzcGZfZXh0Jywnc2F2ZW5ldycsJ25ld25hbWUnLCdjb3B5JykpKTsKCiAgICAkZmls
ZW5hbWUgPSAocHMoJ2NvcHknKSBvciBwcygnc2F2ZW5ldycpKSA/IHBzKCduZXduYW1lJykg
OiBwcygnZmlsZW5hbWUnKTsKICAgICRmaWxlID0gJHByZWZzWydwYXRoX3RvX3NpdGUnXS4n
LycuJHByZWZzWydzcGZfZXh0X2RpciddLicvJy4kZmlsZW5hbWU7CgogICAgaWYgKGVtcHR5
KCRwcmVmc1snc3BmX2V4dF9kaXInXSkgb3IgISRmaWxlbmFtZSkgewoKICAgICAgICByZXR1
cm47CgogICAgfSBlbHNlIHsKCiAgICAkY29udGVudF9yYXcgPSBmZXRjaCgiY29udGVudCIs
ICJzcGZfZXh0IiwgJ2ZpbGVuYW1lJywgJGZpbGVuYW1lKTsgLy8gTW92ZWQgaGVyZSB0byBz
YXZlIG5ld2x5LWNyZWF0ZWQgZmlsZXMKCiAgICAgICAgJGhhbmRsZSA9IGZvcGVuKCRmaWxl
LCAnd2InKTsKICAgICAgICBmd3JpdGUoJGhhbmRsZSwgJGNvbnRlbnRfcmF3KTsKICAgICAg
ICBmY2xvc2UoJGhhbmRsZSk7CiAgICAgICAgY2htb2QoJGZpbGUsIDA2NDQpOwogICAgfQoK
fQoKLyoqCiAqIERlbGV0ZSBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNwZl9leHRfZGVsZXRl
KCkgewoKICAgIGdsb2JhbCAkcHJlZnM7CgogICAgJGZpbGVuYW1lID0gcHMoJ2ZpbGVuYW1l
Jyk7CiAgICAkZmlsZSA9ICRwcmVmc1sncGF0aF90b19zaXRlJ10uJy8nLiRwcmVmc1snc3Bm
X2V4dF9kaXInXS4nLycuJGZpbGVuYW1lOwoKICAgICAgICBpZiAoIWVtcHR5KCRwcmVmc1sn
c3BmX2V4dF9kaXInXSkgYW5kICRmaWxlbmFtZSkgewoKICAgICAgICAgICAgc2FmZV9kZWxl
dGUoJ3NwZl9leHQnLCAiZmlsZW5hbWUgPSAnIi5kb1NsYXNoKCRmaWxlbmFtZSkuIiciKTsK
CiAgICAgICAgICAgIEB1bmxpbmsoJGZpbGUpOwoKICAgICAgICBzcGZfZXh0X2VkaXQoCgog
ICAgICAgICAgICBnVHh0KCdzcGZfZmlsZV9kZWxldGVkJywgYXJyYXkoJ3tuYW1lfScgPT4g
JGZpbGVuYW1lKSkKICAgICAgICApOwoKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuOwog
ICAgfQoKfSI7czozOiJtZDUiO3M6MzI6IjlkNWQ2YTAxYjU2MzIyMjU4M2Q0YzcwOTE5MmEx
MzU2Ijt9