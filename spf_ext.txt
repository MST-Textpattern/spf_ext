# spf_ext v0.3
# External file editor
# Simon Finch
# https://github.com/spiffin/spf_ext

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMjp7czo0OiJuYW1lIjtzOjc6InNwZl9leHQiO3M6NzoidmVyc2lvbiI7czozOiIwLjMi
O3M6NjoiYXV0aG9yIjtzOjExOiJTaW1vbiBGaW5jaCI7czoxMDoiYXV0aG9yX3VyaSI7czoz
NDoiaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dCI7czoxMToiZGVzY3JpcHRp
b24iO3M6MjA6IkV4dGVybmFsIGZpbGUgZWRpdG9yIjtzOjU6Im9yZGVyIjtzOjE6IjUiO3M6
NDoidHlwZSI7czoxOiIzIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6ODoidGV4dHBhY2siO3M6
NTg3OiIjQHNwZl9leHQKc3BmX2V4dF9maWxlcyA9PiBFeHRlcm5hbCBGaWxlcwpzcGZfZXh0
X2RpciA9PiBFeHRlcm5hbCBmaWxlcyBkaXJlY3RvcnkKc3BmX2ZpbGVuYW1lID0+IEZpbGVu
YW1lCnNwZl9lZGl0X2ZpbGUgPT4gWW91IGFyZSBlZGl0aW5nIGZpbGUKc3BmX2FsbF9maWxl
cyA9PiBBbGwgRmlsZXMKc3BmX2ZpbGVfdXBkYXRlZCA9PiBGaWxlIDxzdHJvbmc+e25hbWV9
PC9zdHJvbmc+IHVwZGF0ZWQuCnNwZl9maWxlX25hbWUgPT4gRXh0ZXJuYWwgZmlsZSBuYW1l
CnNwZl9jb3B5X2ZpbGUgPT4gJiM4MjMwO29yIGNvcHkgZmlsZSBhcwpzcGZfY3JlYXRlX25l
d19maWxlID0+IENyZWF0ZSBuZXcgZmlsZQpzcGZfZmlsZV9jcmVhdGVkID0+IEZpbGUgPHN0
cm9uZz57bmFtZX08L3N0cm9uZz4gY3JlYXRlZC4Kc3BmX2ZpbGVfbmFtZV9yZXF1aXJlZCA9
PiBQbGVhc2UgcHJvdmlkZSBhIG5hbWUgZm9yIHlvdXIgZmlsZS4Kc3BmX2ZpbGVfZXhpc3Rz
ID0+IEZpbGUgPHN0cm9uZz57bmFtZX08L3N0cm9uZz4gYWxyZWFkeSBleGlzdHMuCnNwZl9m
aWxlX2RlbGV0ZWQgPT4gRmlsZSA8c3Ryb25nPntuYW1lfTwvc3Ryb25nPiBkZWxldGVkLiI7
czo0OiJoZWxwIjtzOjMxOTQ6IjxoMT5zcGZfZXh0PC9oMT4KCjxwPkV4dGVybmFsIGZpbGUg
ZWRpdG9yIHBsdWdpbi4gQ3JlYXRlLCBlZGl0IGFuZCBkZWxldGUgZXh0ZXJuYWwgKHRvIFRl
eHRwYXR0ZXJuKSBmaWxlcyBpbiBUZXh0cGF0dGVybiBhZG1pbi48L3A+CjxwPjxzdHJvbmc+
UkVRVUlSRVM6IFRleHBhdHRlcm4gNC41LjEgYW5kIFBIUCA1IGFuZCBzaGVsbCBhY2Nlc3Mg
KGZvciBzeW0tbGlua2luZyBleGlzdGluZyBmaWxlcykuPC9zdHJvbmc+PC9wPgo8cD48YSBo
cmVmPSJodHRwczovL2dpdGh1Yi5jb20vc3BpZmZpbi9zcGZfZXh0L2Jsb2IvbWFzdGVyL3Nw
Zl9leHRfdjAuMi50eHQiPlVzZSB0aGlzIHZlcnNpb24gZm9yIFRleHRwYXR0ZXJuIDQuNC4x
IGFuZCBiZWxvdzwvYT4uPC9wPgo8cD48c3Ryb25nPlBsZWFzZSByZWFkIHRoZSBpbnN0cnVj
dGlvbnMgYW5kIG5vdGVzIGJlbG93IGJlZm9yZSB1c2UuPC9zdHJvbmc+PC9wPgo8cD5UaGlz
IHBsdWdpbiBjcmVhdGVzIGV4dGVybmFsIGZpbGVzIHlvdSBjYW4gbWFuYWdlIGFuZCBlZGl0
IHZpYSB0aGUgYWRtaW4gaW50ZXJmYWNlLiBBbGwgZmlsZXMgYXJlIHNhdmVkIHRvIHRoZSBk
aXJlY3RvcnkgeW91IGNyZWF0ZSBpbiBzdGVwIDEgb2YgdGhlIGluc3RydWN0aW9ucyBiZWxv
dy4gU3ludGF4IGhpZ2hsaWdodGluZyBpcyBhdmFpbGFibGUgdmlhIDxhIGhyZWY9Imh0dHBz
Oi8vZ2l0aHViLmNvbS9zcGlmZmluL3NwZl9jb2RlbWlycm9yIj5zcGZfY29kZW1pcnJvcjwv
YT4gKGN1cnJlbnRseSBIVE1MLCBQSFAgYW5kIEphdmFTY3JpcHQgLSBtb3JlIHRvIGNvbWUp
LjwvcD4KCjxoMj5XaHk/PC9oMj4KPHVsPgo8bGk+VGhpcyBwbHVnaW4gYWxsb3dzIHlvdSB0
byBlZGl0IGFuZCBtYW5hZ2Ugc2l0ZSBmaWxlcyByZXNpZGluZyBvdXRzaWRlIFRleHRwYXR0
ZXJuIHdpdGhpbiB0aGUgVGV4dHBhdHRlcm4gYWRtaW4gYXJlYSAoc2VlIOKAmFByb2NlZHVy
ZSBmb3IgbWFuYWdpbmcgZXhpc3RpbmcgZmlsZXPigJkgYmVsb3cpLjwvbGk+CjxsaT5JdCBv
ZmZlcnMgYW4gZWFzeSB3YXkgdG8gY3JlYXRlIHN0YXRpYyBmaWxlcyB5b3UgY2FuIGVkaXQg
YW5kIGFjY2VzcyB2aWEgeW91ciBwYWdlIHRlbXBsYXRlczogPGNvZGU+Jmx0O3R4cDpzaXRl
X3VybCAvJmd0O2V4dF9maWxlcy95b3VyZmlsZS5odG1sPC9jb2RlPjwvbGk+CjwvdWw+Cgo8
aHIgLz4KCjxoMj5JbnN0cnVjdGlvbnM6PC9oMj4KCjxvbD4KPGxpPkNyZWF0ZSBhIGRpcmVj
dG9yeSBmb3IgdGhlIHN0YXRpYyBleHRlcm5hbCBmaWxlcyBpbiB0aGUgcm9vdCBvZiB5b3Vy
IHRleHRwYXR0ZXJuIGluc3RhbGxhdGlvbiBjYWxsZWQg4oCYZXh0X2ZpbGVz4oCZIChvciB3
aGF0ZXZlciB5b3UgbGlrZSkuIFlvdSBzaG91bGQgbWFrZSBzdXJlIHRoYXQgUEhQIGlzIGFi
bGUgdG8gd3JpdGUgdG8gdGhhdCBkaXJlY3RvcnkuPC9saT4KPGxpPlZpc2l0IHRoZSBhZHZh
bmNlZCBwcmVmZXJlbmNlcyBhbmQgbWFrZSBzdXJlIHRoZSDigJxFeHRlcm5hbCBmaWxlcyBk
aXJlY3RvcnnigJ0gcHJlZmVyZW5jZSBjb250YWlucyB0aGUgZGlyZWN0b3J5IHlvdSBjcmVh
dGVkIGluIHN0ZXAgMSAoYnkgZGVmYXVsdCDigJhleHRfZmlsZXPigJkpLiBUaGlzIHBhdGgg
aXMgcmVsYXRpdmUgcGF0aCB0byB0aGUgZGlyZWN0b3J5IG9mIHlvdXIgcm9vdCBUZXh0cGF0
dGVybiBpbnN0YWxsYXRpb24uPC9saT4KPGxpPkFjdGl2YXRlIHRoaXMgcGx1Z2luLjwvbGk+
CjxsaT5HbyB0byBFeHRlbnNpb25zICZndDsgRXh0ZXJuYWwgRmlsZXMgYW5kIGNyZWF0ZSBm
aWxlcyB5b3XigJlkIGxpa2UgdG8gbWFuYWdlLjwvbGk+CjxsaT5BbHdheXMgaW5jbHVkZSBh
IGZpbGUgZXh0ZW5zaW9uIGluIHRoZSBmaWxlIG5hbWUgKC5odG1sLCAucGhwLCBldGMuKS48
L2xpPgo8L29sPgoKPGgyPlByb2NlZHVyZSBmb3IgbWFuYWdpbmcgZXhpc3RpbmcgZmlsZXM6
PC9oMj4KPG9sPgo8bGk+Q29weSB0aGUgY29udGVudHMgb2YgdGhlIGZpbGUgKGNhbGxlZCBm
b3IgZXhhbXBsZSBteWZpbGUucGhwKSBpbnRvIGEgbmV3IGZpbGUgaW4gRXh0ZW5zaW9ucyAm
Z3Q7IEV4dGVybmFsIEZpbGVzICZndDsgQ3JlYXRlIG5ldyBmaWxlLjwvbGk+CjxsaT5OYW1l
IHRoZSBuZXcgZmlsZSAoRXh0ZXJuYWwgZmlsZSBuYW1lOikg4oCYbXlmaWxlLnBocOKAmS48
L2xpPgo8bGk+UmVuYW1lIHRoZSBvcmlnaW5hbCBmaWxlICh0bywgZm9yIGV4YW1wbGUsIOKA
mG15ZmlsZV9vcmlnaW5hbC5waHDigJkpIC0gdGhlbiB5b3XigJlsbCBoYXZlIGEgYmFja3Vw
LjwvbGk+CjxsaT5NYWtlIGEgc3ltYm9saWMgbGluaywgaW4gdGhlIG9yaWdpbmFsIGZpbGUg
bG9jYXRpb24sIHRvIHRoZSBuZXcgZmlsZSAoZS5nLiBjZCB0byB0aGUg4oCYZXh0X2ZpbGVz
4oCZIGRpcmVjdG9yeSBhbmQgdGhlbiDigJhsbiAtcyAvb3JpZ2luYWxfZGlyZWN0b3J5X3Bh
dGgvbXlmaWxlLnBocCAuL215ZmlsZS5waHDigJkpLjwvbGk+Cjwvb2w+Cgo8aHIgLz4KCjxo
Mj5Ob3Rlczo8L2gyPgo8b2w+CjxsaT5Zb3UgY2FuIG9ubHkgbWFuYWdlIGZpbGVzIHdoaWNo
IGFyZSByZWFkL3dyaXRlIHRvIHlvdXIgd2ViIHNlcnZlciBlLmcuIE1pbmlmeSBjb25maWcg
ZmlsZXMsIGV4dGVybmFsIHNjcmlwdHMsIGV0Yy48L2xpPgo8bGk+RGVsZXRpbmcgYSBmaWxl
IHZpYSB0aGUgRXh0ZXJuYWwgRmlsZXMgdGFiIGRlbGV0ZXMgdGhlIGFjdHVhbCBmaWxlIGlu
IHRoZSDigJlleHRfZmlsZXPigJkgZGlyZWN0b3J5IChhcyB3ZWxsIGFzIHRoZSBkYXRhYmFz
ZSBlbnRyeSkgLSB1c2Ugd2l0aCBjYXJlIS48L2xpPgo8L29sPgoKCjxoMj5MYW5ndWFnZXMg
KFRleHRwYWNrKTwvaDI+Cjx1bD4KPGxpPlRoaXMgcGx1Z2luIGluc3RhbGxzIGFuIEVuZ2xp
c2ggVGV4dHBhY2sgYnkgZGVmYXVsdC48L2xpPgo8bGk+VG8gaW5zdGFsbCBhIFRleHRwYWNr
IGZvciB5b3VyIG93biBsYW5ndWFnZSBzZWUgdGhlIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHVi
LmNvbS9zcGlmZmluL3NwZl9leHQvYmxvYi9tYXN0ZXIvc3BmX2V4dF90ZXh0cGFjay50eHQi
Pmluc3RydWN0aW9ucyBvbiBHaXRIdWI8L2E+LjwvbGk+CjwvdWw+Cgo8aDI+VmVyc2lvbiBo
aXN0b3J5PC9oMj4KPHVsPgo8bGk+MC4yIC0gMjYgQXVndXN0IDIwMTIgLSBzZWN1cml0eSBl
bmhhbmNlbWVudHMgKHRoYW5rcyBKdWtrYSkuPC9saT4KPGxpPjAuMSAtIEFwcmlsIDIwMTIg
LSBmaXJzdCByZWxlYXNlLjwvbGk+CjwvdWw+IjtzOjQ6ImNvZGUiO3M6ODk0NzoiLyoqCiAq
IHNwZl9leHQgLSBFeHRlcm5hbCBmaWxlIGVkaXRvciBmb3IgVGV4dHBhdHRlcm4KICoKICog
wqkgMjAxMiBTaW1vbiBGaW5jaCAtIGh0dHBzOi8vZ2l0aHViLmNvbS9zcGlmZmluL3NwZl9l
eHQKICoKICogTGljZW5zZWQgdW5kZXIgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgdmVy
c2lvbiAyCiAqIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwtMi4wLmh0bWwKICoK
ICogVmVyc2lvbiAwLjMgLS0gMyBOb3ZlbWJlciAyMDEyCiAqLwoKLyoqCiAqIFNldHVwIHRh
YnMgYW5kIGNhbGxiYWNrCiAqLwoKaWYgKEB0eHBpbnRlcmZhY2UgPT0gJ2FkbWluJykgewoK
ICAgIGFkZF9wcml2cygnc3BmX2V4dCcsICcxJyk7CiAgICByZWdpc3Rlcl90YWIoJ2V4dGVu
c2lvbnMnLCAnc3BmX2V4dCcsIGdUeHQoJ3NwZl9leHRfZmlsZXMnKSk7CiAgICByZWdpc3Rl
cl9jYWxsYmFjaygnc3BmX2V4dF9ndWknLCAnc3BmX2V4dCcpOwogICAgcmVnaXN0ZXJfY2Fs
bGJhY2soJ3NwZl9leHRfaW5zdGFsbCcsICdwbHVnaW5fbGlmZWN5Y2xlLnNwZl9leHQnKTsK
Cn0KCi8qKgogKiBHVUkgZnVuY3Rpb25zIC8gc3RlcCBkaXNwYXRjaGVyCiAqLwoKZnVuY3Rp
b24gc3BmX2V4dF9ndWkoKSB7CgogICAgZ2xvYmFsICRldmVudCwgJHN0ZXA7CgogICAgaWYg
KCRldmVudCA9PSAnc3BmX2V4dCcpIHsKICAgICAgICByZXF1aXJlX3ByaXZzKCdzcGZfZXh0
Jyk7CgogICAgICAgIGJvdW5jZXIoJHN0ZXAsCiAgICAgICAgICAgIGFycmF5KAogICAgICAg
ICAgICAgICAgJ3NwZl9leHRfZWRpdF9yYXcnICAgPT4gZmFsc2UsCiAgICAgICAgICAgICAg
ICAncG91cicgICAgICAgICAgICAgID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ3NwZl9l
eHRfc2F2ZScgICAgICAgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdzcGZfZXh0X2NvcHkn
ICAgICAgID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3BmX2V4dF9kZWxldGUnICAgICA9
PiB0cnVlLAogICAgICAgICAgICAgICAgJ3NwZl9leHRfZWRpdCcgICAgICAgPT4gZmFsc2Us
CiAgICAgICAgICAgICkKICAgICAgICApOwoKICAgICAgICBzd2l0Y2ggKCRzdGVwKSB7CiAg
ICAgICAgICAgIGNhc2UgJyc6IHNwZl9leHRfZWRpdCgpOyAgICAgICAgICAgICAgICAgICAg
ICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnc3BmX2V4dF9lZGl0X3Jhdyc6IHNwZl9l
eHRfZWRpdCgpOyAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAncG91cic6IHNw
Zl9leHRfZWRpdCgpOyAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj
YXNlICdzcGZfZXh0X3NhdmUnOiBzcGZfZXh0X3NhdmUoKTsgICAgICAgICAgICAgIGJyZWFr
OwogICAgICAgICAgICBjYXNlICdzcGZfZXh0X2NvcHknOiBzcGZfZXh0X2NvcHkoKTsgICAg
ICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdzcGZfZXh0X2RlbGV0ZSc6IHNw
Zl9leHRfZGVsZXRlKCk7ICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdzcGZf
ZXh0X2VkaXQnOiBzcGZfZXh0X2VkaXQoKTsKICAgICAgICB9CiAgICB9Cn0KCi8qKgogKiBJ
bnN0YWxsZXIgZnVuY3Rpb24KICovCgpmdW5jdGlvbiBzcGZfZXh0X2luc3RhbGwoJGV2ZW50
PScnLCAkc3RlcD0nJykgewoKICAgIGdsb2JhbCAkcHJlZnM7CgogICAgaWYoJHN0ZXAgPT0g
J2RlbGV0ZWQnKSB7CgogICAgICAgIHNhZmVfZGVsZXRlKAogICAgICAgICAgICAndHhwX3By
ZWZzJywKICAgICAgICAgICAgIm5hbWU9J3NwZl9leHRfZGlyJyIKICAgICAgICApOwoKICAg
ICAgICAvLyBEb24ndCBkcm9wIHRoZSB0YWJsZSAtIGp1c3QgaW4gY2FzZS4uCiAgICAgICAg
Ly9Ac2FmZV9xdWVyeSgKICAgICAgICAvLyAgICAnRFJPUCBUQUJMRSBJRiBFWElTVFMgJy5z
YWZlX3BmeCgnc3BmX2V4dCcpCiAgICAgICAgLy8pOwoKICAgICAgICAvLyBkZWxldGUgdGhl
IFRleHRwYWNrCgogICAgICAgIHNhZmVfZGVsZXRlKAogICAgICAgICAgICAndHhwX2xhbmcn
LAogICAgICAgICAgICAiZXZlbnQgPSAnc3BmX2V4dCciCiAgICAgICAgKTsKCiAgICAgICAg
cmV0dXJuOwoKICAgIH0KCiAgICAvKiBWZXJzaW9uIGNoZWNrICovCiAgICBpZiAodHhwX3Zl
cnNpb24gPj0gJzQuNS4wJykgewogICAgICAgIHJldHVybjsKICAgIH0gZWxzZSB7CiAgICAg
ICAgcmV0dXJuICdUaGUgcGx1Z2luIHNwZl9leHQgdmVyc2lvbiAwLjMgcmVxdWlyZXMgVGV4
dHBhdHRlcm4gNC41LjEgLSB5b3UgYXJlIHJ1bm5pbmcgVGV4dHBhdHRlcm4gJyAuIHR4cF92
ZXJzaW9uIC4gJyAtIHBsZWFzZSBkZWxldGUgc3BmX2V4dC4nOwogICAgfQoKICAgIGlmKCFp
c3NldCgkcHJlZnNbJ3NwZl9leHRfZGlyJ10pKSB7CgogICAgICAgIHNhZmVfcXVlcnkoCiAg
ICAgICAgICAgICJDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyAiLnNhZmVfcGZ4KCdzcGZf
ZXh0JykuIiAoCiAgICAgICAgICAgICAgICBmaWxlbmFtZSB2YXJjaGFyKDI1NSkgTk9UIE5V
TEwgZGVmYXVsdCAnJywKICAgICAgICAgICAgICAgIGNvbnRlbnQgbG9uZ3RleHQgTk9UIE5V
TEwsCiAgICAgICAgICAgICAgICBQUklNQVJZIEtFWShmaWxlbmFtZSkKICAgICAgICAgICAg
KSBDSEFSU0VUPXV0ZjgiCiAgICAgICAgKTsKCiAgICAgICAgaWYoIXNhZmVfY291bnQoInNw
Zl9leHQiLCAiZmlsZW5hbWU9J2hvbGRlci50eHQnIikpIHsKCiAgICAgICAgICAgIHNhZmVf
aW5zZXJ0KCJzcGZfZXh0IiwgImZpbGVuYW1lPSdob2xkZXIudHh0JywgY29udGVudD0nSG9s
ZGVyIHRleHQgZmlsZS4uLnlvdSBuZWVkIGF0IGxlYXN0IG9uZSBmaWxlIGhlcmUuJyIpOwoK
ICAgICAgICB9CgogICAgICAgIHNhZmVfaW5zZXJ0KAogICAgICAgICAgICAndHhwX3ByZWZz
JywKICAgICAgICAgICAgInByZWZzX2lkPTEsCiAgICAgICAgICAgIG5hbWU9J3NwZl9leHRf
ZGlyJywKICAgICAgICAgICAgdmFsPSdleHRfZmlsZXMnLAogICAgICAgICAgICB0eXBlPTEs
CiAgICAgICAgICAgIGV2ZW50PSdhZG1pbicsCiAgICAgICAgICAgIGh0bWw9J3RleHRfaW5w
dXQnLAogICAgICAgICAgICBwb3NpdGlvbj0yMiIKICAgICAgICApOwogICAgfQp9CgovKioK
ICogTGlzdCBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNwZl9leHRfbGlzdCgkY3VycmVudCkg
ewoKICAgIC8vJG91dFtdID0gc3RhcnRUYWJsZSgnbGlzdCcsICdsZWZ0Jyk7Cgokb3V0W10g
PSBzdGFydFRhYmxlKCcnLCAnJywgJ3R4cC1saXN0Jyk7CgogICAgJHJzID0gc2FmZV9yb3dz
X3N0YXJ0KCdmaWxlbmFtZScsICdzcGZfZXh0JywgIjE9MSIpOwoKICAgIGlmICgkcnMpIHsK
CiAgICAgICAgd2hpbGUgKCRhID0gbmV4dFJvdygkcnMpKSB7CiAgICAgICAgICAgIGV4dHJh
Y3QoJGEpOwogICAgICAgICAgICAkZWRpdCA9ICgkY3VycmVudCAhPSAkZmlsZW5hbWUpID8g
ZUxpbmsoJ3NwZl9leHQnLCAnJywgJ2ZpbGVuYW1lJywgJGZpbGVuYW1lLCAkZmlsZW5hbWUp
IDogdHhwc3BlY2lhbGNoYXJzKCRmaWxlbmFtZSk7CiAgICAgICAgICAgICRkZWxldGUgPSAo
JGZpbGVuYW1lKSA/IGRMaW5rKCdzcGZfZXh0JywgJ3NwZl9leHRfZGVsZXRlJywgJ2ZpbGVu
YW1lJywgJGZpbGVuYW1lKSA6ICcnOwogICAgICAgICAgICAkb3V0W10gPSB0cih0ZCgkZWRp
dCkudGQoJGRlbGV0ZSkpOwogICAgICAgIH0KCiAgICAgICAgJG91dFtdID0gIGVuZFRhYmxl
KCk7CgogICAgICAgIHJldHVybiBqb2luKCcnLCAkb3V0KTsKCiAgICB9Cn0KCi8qKgogKiBF
ZGl0IGZ1bmN0aW9uCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9lZGl0KCRtZXNzYWdlPScnKSB7
CgogICAgcGFnZXRvcChnVHh0KCdzcGZfZXh0X2ZpbGVzJyksJG1lc3NhZ2UpOwogICAgZ2xv
YmFsICRzdGVwLCAkcHJlZnM7CiAgICBzcGZfZXh0X2VkaXRfcmF3KCk7Cgp9CgovKioKICog
RWRpdCBmdW5jdGlvbiAocmF3KQogKi8KCmZ1bmN0aW9uIHNwZl9leHRfZWRpdF9yYXcoKSB7
CgogICAgZ2xvYmFsICRldmVudCwgJHN0ZXA7CgogICAgJGZpcnN0ID0gc2FmZV9yb3coJ2Zp
bGVuYW1lJywgJ3NwZl9leHQnLCAiMT0xIik7CiAgICAkZmlyc3RfZmlsZSA9ICRmaXJzdFsn
ZmlsZW5hbWUnXTsKCiAgICBleHRyYWN0KGdwc2EoYXJyYXkoJ2ZpbGVuYW1lJywgJ25ld25h
bWUnLCAnY29weScsICdzYXZlbmV3JykpKTsKCiAgICBpZiAoJHN0ZXAgPT0gJ3NwZl9leHRf
ZGVsZXRlJyB8fCBlbXB0eSgkZmlsZW5hbWUpICYmICRzdGVwICE9ICdwb3VyJyAmJiAhJHNh
dmVuZXcpIHsKCiAgICAgICAgJGZpbGVuYW1lID0gJGZpcnN0X2ZpbGU7CgogICAgfQoKICAg
IGVsc2VpZiAoKCRjb3B5IHx8ICRzYXZlbmV3KSAmJiB0cmltKHByZWdfcmVwbGFjZSgnL1s8
PiYiXCddLycsICcnLCAkbmV3bmFtZSkpKSB7CgogICAgICAgICRmaWxlbmFtZSA9ICRuZXdu
YW1lOwoKICAgIH0KCiAgICBpZiAoZW1wdHkoJGZpbGVuYW1lKSkgewoKICAgICAgICAkYnV0
dG9ucyA9ICc8ZGl2IGNsYXNzPSJlZGl0LXRpdGxlIj4nLgogICAgICAgIGdUeHQoJ3NwZl9m
aWxlX25hbWUnKS4nOiAnCiAgICAgICAgLmZJbnB1dCgndGV4dCcsJ25ld25hbWUnLCcnLCdl
ZGl0JywnJywnJywyMCkuCiAgICAgICAgaElucHV0KCdzYXZlbmV3Jywnc2F2ZW5ldycpLgog
ICAgICAgICc8L2Rpdj4nOwogICAgICAgICRmaWxlY29udGVudCA9IGdwcygnc3BmX2V4dCcp
OwoKICAgIH0gZWxzZSB7CgogICAgICAgICRidXR0b25zID0gJzxkaXYgY2xhc3M9ImVkaXQt
dGl0bGUiPicuZ1R4dCgnc3BmX2VkaXRfc2NyaXB0Jykuc3Auc3Ryb25nKHR4cHNwZWNpYWxj
aGFycygkZmlsZW5hbWUpKS4nPC9kaXY+JzsKICAgICAgICAkZmlsZWNvbnRlbnQgPSBmZXRj
aCgiY29udGVudCIsJ3NwZl9leHQnLCdmaWxlbmFtZScsJGZpbGVuYW1lKTsKCiAgICB9Cgog
ICAgaWYgKCFlbXB0eSgkZmlsZW5hbWUpKSB7CgogICAgICAgICRjb3B5ID0gJzxzcGFuIGNs
YXNzPSJjb3B5LWFzIj48bGFiZWwgZm9yPSJjb3B5LWZpbGUiPicuZ1R4dCgnc3BmX2NvcHlf
ZmlsZScpLic8L2xhYmVsPicuc3AuZklucHV0KCd0ZXh0JywgJ25ld25hbWUnLCAnJywgJ2Vk
aXQnLCAnJywgJycsICcnLCAnJywgJ2NvcHktZmlsZScpLnNwLgogICAgICAgICAgICBmSW5w
dXQoJ3N1Ym1pdCcsICdjb3B5JywgZ1R4dCgnY29weScpLCAnc21hbGxlcmJveCcpLic8L3Nw
YW4+JzsKCiAgICB9IGVsc2UgewoKICAgICAgICAkY29weSA9ICcnOwoKICAgIH0KCiAgICAk
cmlnaHQgPQogICAgJzxkaXYgaWQ9ImNvbnRlbnRfc3dpdGNoZXIiPicuCiAgICBoZWQoZ1R4
dCgnc3BmX2FsbF9maWxlcycpLDIpLgogICAgZ3JhZihzTGluaygnc3BmX2V4dCcsICdwb3Vy
JywgZ1R4dCgnc3BmX2NyZWF0ZV9uZXdfZmlsZScpKSwgJyBjbGFzcz0iYWN0aW9uLWNyZWF0
ZSInKS4KICAgIHNwZl9leHRfbGlzdCgkZmlsZW5hbWUpLgogICAgJzwvZGl2Pic7CgogICAg
ZWNobwogICAgJzxoMSBjbGFzcz0idHhwLWhlYWRpbmciPicuZ1R4dCgnc3BmX2V4dF9maWxl
cycpLic8L2gxPicuCiAgICAnPGRpdiBpZD0iJy4kZXZlbnQuJ19jb250YWluZXIiIGNsYXNz
PSJ0eHAtY29udGFpbmVyIj4nLgogICAgc3RhcnRUYWJsZSgnJywgJycsICd0eHAtY29sdW1u
dGFibGUnKS4KICAgIHRyKAogICAgICAgIHRkKAogICAgICAgICAgICBmb3JtKAogICAgICAg
ICAgICAgICAgJzxkaXYgaWQ9Im1haW5fY29udGVudCI+Jy4KICAgICAgICAgICAgICAgICRi
dXR0b25zLgogICAgICAgICAgICAgICAgJzx0ZXh0YXJlYSBpZD0ic3BmX2V4dCIgY2xhc3M9
ImNvZGUiIG5hbWU9InNwZl9leHQiIGNvbHM9IicuSU5QVVRfTEFSR0UuJyIgcm93cz0iJy5J
TlBVVF9SRUdVTEFSLiciIHN0eWxlPSJoZWlnaHQ6IDM5LjI1ZW07Ij4nLnR4cHNwZWNpYWxj
aGFycygkZmlsZWNvbnRlbnQpLic8L3RleHRhcmVhPicuCiAgICAgICAgICAgICAgICAnPHA+
Jy5mSW5wdXQoJ3N1Ym1pdCcsJycsZ1R4dCgnc2F2ZScpLCdwdWJsaXNoJykuCiAgICAgICAg
ICAgICAgICBlSW5wdXQoJ3NwZl9qcycpLnNJbnB1dCgnc3BmX2pzX3NhdmUnKS4KICAgICAg
ICAgICAgICAgIGhJbnB1dCgnZmlsZW5hbWUnLCRmaWxlbmFtZSkuJzwvcD4nCiAgICAgICAg
ICAgICAgICAuJGNvcHkuCiAgICAgICAgICAgICAgICAnPC9kaXY+JwogICAgICAgICAgICAs
ICcnLCAnJywgJ3Bvc3QnLCAnZWRpdC1mb3JtJywgJycsICdzdHlsZV9mb3JtJykKICAgICAg
ICAsICcnLCAnY29sdW1uJykuCiAgICAgICAgdGR0bCgKICAgICAgICAgICAgJHJpZ2h0CiAg
ICAgICAgLCAnIGNsYXNzPSJjb2x1bW4iJykKICAgICkuCiAgICBlbmRUYWJsZSgpLgogICAg
JzwvZGl2Pic7Cn0KCi8qKgogKiBDb3B5IGZ1bmN0aW9uCiAqCiAqLwoKZnVuY3Rpb24gc3Bm
X2V4dF9jb3B5KCkgewoKICAgIGV4dHJhY3QoZ3BzYShhcnJheSgnb2xkbmFtZScsICduZXdu
YW1lJykpKTsKCiAgICAkY29udGVudCA9IGRvU2xhc2goZmV0Y2goJ2NvbnRlbnQnLCAnc3Bm
X2V4dCcsICdmaWxlbmFtZScsICRvbGRuYW1lKSk7CgogICAgJHJzID0gc2FmZV9pbnNlcnQo
J3NwZl9leHQnLCAiY29udGVudCA9ICckY29udGVudCcsIGZpbGVuYW1lID0gJyIuZG9TbGFz
aCgkbmV3bmFtZSkuIiciKTsKCiAgICBzcGZfZXh0X2VkaXQoCiAgICAgICAgZ1R4dCgnc3Bm
X2ZpbGVfY3JlYXRlZCcsIGFycmF5KCd7bmFtZX0nID0+ICRuZXduYW1lKSkKICAgICk7Cn0K
Ci8qKgogKiBTYXZlIGZ1bmN0aW9uCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9zYXZlKCkgewoK
ICAgIGV4dHJhY3QoZ3BzYShhcnJheSgnZmlsZW5hbWUnLCdzcGZfZXh0Jywnc2F2ZW5ldycs
J25ld25hbWUnLCdjb3B5JykpKTsKICAgICRjb250ZW50ID0gZG9TbGFzaCgkc3BmX2V4dCk7
CgogICAgaWYgKCRzYXZlbmV3IG9yICRjb3B5KSB7CgogICAgICAgICRuZXduYW1lID0gZG9T
bGFzaCh0cmltKHByZWdfcmVwbGFjZSgnL1s8PiYiXCddLycsICcnLCBncHMoJ25ld25hbWUn
KSkpKTsKCiAgICAgICAgaWYgKCRuZXduYW1lIGFuZCBzYWZlX2ZpZWxkKCdmaWxlbmFtZScs
ICdzcGZfZXh0JywgImZpbGVuYW1lID0gJyRuZXduYW1lJyIpKSB7CgogICAgICAgICAgICAk
bWVzc2FnZSA9IGdUeHQoJ3NwZl9maWxlX2V4aXN0cycsIGFycmF5KCd7bmFtZX0nID0+ICRu
ZXduYW1lKSk7CgogICAgICAgICAgICBpZiAoJHNhdmVuZXcpIHsKCiAgICAgICAgICAgICAg
ICAkX1BPU1RbJ25ld25hbWUnXSA9ICcnOwoKICAgICAgICAgICAgfQoKICAgICAgICB9IGVs
c2VpZiAoJG5ld25hbWUpIHsKCiAgICAgICAgICAgIHNhZmVfaW5zZXJ0KCdzcGZfZXh0Jywg
ImZpbGVuYW1lID0gJyIuJG5ld25hbWUuIicsIGNvbnRlbnQgPSAnJGNvbnRlbnQnIik7Cgog
ICAgICAgICAgICAkbWVzc2FnZSA9IGdUeHQoJ3NwZl9maWxlX2NyZWF0ZWQnLCBhcnJheSgn
e25hbWV9JyA9PiAkbmV3bmFtZSkpOwoKICAgICAgICAgICAgc3BmX2V4dF93cml0ZSgpOwoK
ICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgJG1lc3NhZ2UgPSBhcnJheShnVHh0KCdz
cGZfZmlsZV9uYW1lX3JlcXVpcmVkJyksIEVfRVJST1IpOwoKICAgICAgICB9CgogICAgICAg
IHNwZl9leHRfZWRpdCgkbWVzc2FnZSk7CgogICAgfSBlbHNlIHsKCiAgICAgICAgc2FmZV91
cGRhdGUoJ3NwZl9leHQnLCAiY29udGVudCA9ICckY29udGVudCciLCAiZmlsZW5hbWUgPSAn
Ii5kb1NsYXNoKCRmaWxlbmFtZSkuIiciKTsKCiAgICAgICAgJG1lc3NhZ2UgPSBnVHh0KCdz
cGZfZmlsZV91cGRhdGVkJywgYXJyYXkoJ3tuYW1lfScgPT4gJGZpbGVuYW1lKSk7CgogICAg
ICAgIHNwZl9leHRfd3JpdGUoKTsKCiAgICAgICAgc3BmX2V4dF9lZGl0KCRtZXNzYWdlKTsK
CiAgICB9Cgp9CgovKioKICogV3JpdGUgZnVuY3Rpb24KICovCgpmdW5jdGlvbiBzcGZfZXh0
X3dyaXRlKCkgewoKICAgIGdsb2JhbCAkcHJlZnM7CiAgICBleHRyYWN0KGdwc2EoYXJyYXko
J2ZpbGVuYW1lJywnc3BmX2V4dCcsJ3NhdmVuZXcnLCduZXduYW1lJywnY29weScpKSk7Cgog
ICAgJGZpbGVuYW1lID0gKHBzKCdjb3B5Jykgb3IgcHMoJ3NhdmVuZXcnKSkgPyBwcygnbmV3
bmFtZScpIDogcHMoJ2ZpbGVuYW1lJyk7CiAgICAkZmlsZSA9ICRwcmVmc1sncGF0aF90b19z
aXRlJ10uJy8nLiRwcmVmc1snc3BmX2V4dF9kaXInXS4nLycuc2FuaXRpemVGb3JGaWxlKCRm
aWxlbmFtZSk7CgogICAgaWYgKGVtcHR5KCRwcmVmc1snc3BmX2V4dF9kaXInXSkgb3IgISRm
aWxlbmFtZSkgewoKICAgICAgICByZXR1cm47CgogICAgfSBlbHNlIHsKCiAgICAkY29udGVu
dF9yYXcgPSBmZXRjaCgiY29udGVudCIsICJzcGZfZXh0IiwgJ2ZpbGVuYW1lJywgJGZpbGVu
YW1lKTsgLy8gTW92ZWQgaGVyZSB0byBzYXZlIG5ld2x5LWNyZWF0ZWQgZmlsZXMKCiAgICAg
ICAgJGhhbmRsZSA9IGZvcGVuKCRmaWxlLCAnd2InKTsKICAgICAgICBmd3JpdGUoJGhhbmRs
ZSwgJGNvbnRlbnRfcmF3KTsKICAgICAgICBmY2xvc2UoJGhhbmRsZSk7CiAgICAgICAgY2ht
b2QoJGZpbGUsIDA2NDQpOwogICAgfQoKfQoKLyoqCiAqIERlbGV0ZSBmdW5jdGlvbgogKi8K
CmZ1bmN0aW9uIHNwZl9leHRfZGVsZXRlKCkgewoKICAgIGdsb2JhbCAkcHJlZnM7CgogICAg
JGZpbGVuYW1lID0gcHMoJ2ZpbGVuYW1lJyk7CiAgICAkZmlsZSA9ICRwcmVmc1sncGF0aF90
b19zaXRlJ10uJy8nLiRwcmVmc1snc3BmX2V4dF9kaXInXS4nLycuJGZpbGVuYW1lOwoKICAg
ICAgICBpZiAoIWVtcHR5KCRwcmVmc1snc3BmX2V4dF9kaXInXSkgYW5kICRmaWxlbmFtZSkg
ewoKICAgICAgICAgICAgc2FmZV9kZWxldGUoJ3NwZl9leHQnLCAiZmlsZW5hbWUgPSAnIi5k
b1NsYXNoKCRmaWxlbmFtZSkuIiciKTsKCiAgICAgICAgICAgIEB1bmxpbmsoJGZpbGUpOwoK
ICAgICAgICBzcGZfZXh0X2VkaXQoCgogICAgICAgICAgICBnVHh0KCdzcGZfZmlsZV9kZWxl
dGVkJywgYXJyYXkoJ3tuYW1lfScgPT4gJGZpbGVuYW1lKSkKICAgICAgICApOwoKICAgIH0g
ZWxzZSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKfSI7czozOiJtZDUiO3M6MzI6ImYxMWFh
YjIyZGIwNDMwM2MzYWFmNzliZTBjYmQ2MTk3Ijt9