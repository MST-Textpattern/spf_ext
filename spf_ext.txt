# spf_ext v0.4
# External file editor
# Simon Finch
# https://github.com/spiffin/spf_ext

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMjp7czo0OiJuYW1lIjtzOjc6InNwZl9leHQiO3M6NzoidmVyc2lvbiI7czozOiIwLjQi
O3M6NjoiYXV0aG9yIjtzOjExOiJTaW1vbiBGaW5jaCI7czoxMDoiYXV0aG9yX3VyaSI7czoz
NDoiaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dCI7czoxMToiZGVzY3JpcHRp
b24iO3M6MjA6IkV4dGVybmFsIGZpbGUgZWRpdG9yIjtzOjU6Im9yZGVyIjtzOjE6IjUiO3M6
NDoidHlwZSI7czoxOiIzIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6ODoidGV4dHBhY2siO3M6
NTg3OiIjQHNwZl9leHQKc3BmX2V4dF9maWxlcyA9PiBFeHRlcm5hbCBGaWxlcwpzcGZfZXh0
X2RpciA9PiBFeHRlcm5hbCBmaWxlcyBkaXJlY3RvcnkKc3BmX2ZpbGVuYW1lID0+IEZpbGVu
YW1lCnNwZl9lZGl0X2ZpbGUgPT4gWW91IGFyZSBlZGl0aW5nIGZpbGUKc3BmX2FsbF9maWxl
cyA9PiBBbGwgRmlsZXMKc3BmX2ZpbGVfdXBkYXRlZCA9PiBGaWxlIDxzdHJvbmc+e25hbWV9
PC9zdHJvbmc+IHVwZGF0ZWQuCnNwZl9maWxlX25hbWUgPT4gRXh0ZXJuYWwgZmlsZSBuYW1l
CnNwZl9jb3B5X2ZpbGUgPT4gJiM4MjMwO29yIGNvcHkgZmlsZSBhcwpzcGZfY3JlYXRlX25l
d19maWxlID0+IENyZWF0ZSBuZXcgZmlsZQpzcGZfZmlsZV9jcmVhdGVkID0+IEZpbGUgPHN0
cm9uZz57bmFtZX08L3N0cm9uZz4gY3JlYXRlZC4Kc3BmX2ZpbGVfbmFtZV9yZXF1aXJlZCA9
PiBQbGVhc2UgcHJvdmlkZSBhIG5hbWUgZm9yIHlvdXIgZmlsZS4Kc3BmX2ZpbGVfZXhpc3Rz
ID0+IEZpbGUgPHN0cm9uZz57bmFtZX08L3N0cm9uZz4gYWxyZWFkeSBleGlzdHMuCnNwZl9m
aWxlX2RlbGV0ZWQgPT4gRmlsZSA8c3Ryb25nPntuYW1lfTwvc3Ryb25nPiBkZWxldGVkLiI7
czo0OiJoZWxwIjtzOjMzMTQ6IjxoMT5zcGZfZXh0PC9oMT4KCjxwPkV4dGVybmFsIGZpbGUg
ZWRpdG9yIHBsdWdpbi4gQ3JlYXRlLCBlZGl0IGFuZCBkZWxldGUgZXh0ZXJuYWwgKHRvIFRl
eHRwYXR0ZXJuKSBmaWxlcyBpbiBUZXh0cGF0dGVybiBhZG1pbi48L3A+CjxwPjxzdHJvbmc+
UkVRVUlSRVM6IFRleHBhdHRlcm4gNC41LjEgYW5kIFBIUCA1IGFuZCBzaGVsbCBhY2Nlc3Mg
KGZvciBzeW0tbGlua2luZyBleGlzdGluZyBmaWxlcykuPC9zdHJvbmc+PC9wPgo8cD48YSBo
cmVmPSJodHRwczovL2dpdGh1Yi5jb20vc3BpZmZpbi9zcGZfZXh0L2Jsb2IvbWFzdGVyL3Nw
Zl9leHRfdjAuMi50eHQiPlVzZSB0aGlzIHZlcnNpb24gZm9yIFRleHRwYXR0ZXJuIDQuNC4x
IGFuZCBiZWxvdzwvYT4uPC9wPgo8cD48c3Ryb25nPlBsZWFzZSByZWFkIHRoZSBpbnN0cnVj
dGlvbnMgYW5kIG5vdGVzIGJlbG93IGJlZm9yZSB1c2UuPC9zdHJvbmc+PC9wPgo8cD5UaGlz
IHBsdWdpbiBjcmVhdGVzIGV4dGVybmFsIGZpbGVzIHlvdSBjYW4gbWFuYWdlIGFuZCBlZGl0
IHZpYSB0aGUgYWRtaW4gaW50ZXJmYWNlLiBBbGwgZmlsZXMgYXJlIHNhdmVkIHRvIHRoZSBk
aXJlY3RvcnkgeW91IGNyZWF0ZSBpbiBzdGVwIDEgb2YgdGhlIGluc3RydWN0aW9ucyBiZWxv
dy4gU3ludGF4IGhpZ2hsaWdodGluZyBpcyBhdmFpbGFibGUgdmlhIDxhIGhyZWY9Imh0dHBz
Oi8vZ2l0aHViLmNvbS9zcGlmZmluL3NwZl9jb2RlbWlycm9yIj5zcGZfY29kZW1pcnJvcjwv
YT4gKGN1cnJlbnRseSBIVE1MLCBQSFAgYW5kIEphdmFTY3JpcHQgLSBtb3JlIHRvIGNvbWUp
LjwvcD4KCjxoMj5XaHk/PC9oMj4KPHVsPgo8bGk+VGhpcyBwbHVnaW4gYWxsb3dzIHlvdSB0
byBlZGl0IGFuZCBtYW5hZ2Ugc2l0ZSBmaWxlcyByZXNpZGluZyBvdXRzaWRlIFRleHRwYXR0
ZXJuIHdpdGhpbiB0aGUgVGV4dHBhdHRlcm4gYWRtaW4gYXJlYSAoc2VlIOKAmFByb2NlZHVy
ZSBmb3IgbWFuYWdpbmcgZXhpc3RpbmcgZmlsZXPigJkgYmVsb3cpLjwvbGk+CjxsaT5JdCBv
ZmZlcnMgYW4gZWFzeSB3YXkgdG8gY3JlYXRlIHN0YXRpYyBmaWxlcyB5b3UgY2FuIGVkaXQg
YW5kIGFjY2VzcyB2aWEgeW91ciBwYWdlIHRlbXBsYXRlczogPGNvZGU+Jmx0O3R4cDpzaXRl
X3VybCAvJmd0O2V4dF9maWxlcy95b3VyZmlsZS5odG1sPC9jb2RlPjwvbGk+CjwvdWw+Cgo8
aHIgLz4KCjxoMj5JbnN0cnVjdGlvbnM6PC9oMj4KCjxvbD4KPGxpPkNyZWF0ZSBhIGRpcmVj
dG9yeSBmb3IgdGhlIHN0YXRpYyBleHRlcm5hbCBmaWxlcyBpbiB0aGUgcm9vdCBvZiB5b3Vy
IHRleHRwYXR0ZXJuIGluc3RhbGxhdGlvbiBjYWxsZWQg4oCYZXh0X2ZpbGVz4oCZIChvciB3
aGF0ZXZlciB5b3UgbGlrZSkuIFlvdSBzaG91bGQgbWFrZSBzdXJlIHRoYXQgUEhQIGlzIGFi
bGUgdG8gd3JpdGUgdG8gdGhhdCBkaXJlY3RvcnkuPC9saT4KPGxpPlZpc2l0IHRoZSBhZHZh
bmNlZCBwcmVmZXJlbmNlcyBhbmQgbWFrZSBzdXJlIHRoZSDigJxFeHRlcm5hbCBmaWxlcyBk
aXJlY3RvcnnigJ0gcHJlZmVyZW5jZSBjb250YWlucyB0aGUgZGlyZWN0b3J5IHlvdSBjcmVh
dGVkIGluIHN0ZXAgMSAoYnkgZGVmYXVsdCDigJhleHRfZmlsZXPigJkpLiBUaGlzIHBhdGgg
aXMgcmVsYXRpdmUgcGF0aCB0byB0aGUgZGlyZWN0b3J5IG9mIHlvdXIgcm9vdCBUZXh0cGF0
dGVybiBpbnN0YWxsYXRpb24uPC9saT4KPGxpPkFjdGl2YXRlIHRoaXMgcGx1Z2luLjwvbGk+
CjxsaT5HbyB0byBFeHRlbnNpb25zICZndDsgRXh0ZXJuYWwgRmlsZXMgYW5kIGNyZWF0ZSBm
aWxlcyB5b3XigJlkIGxpa2UgdG8gbWFuYWdlLjwvbGk+CjxsaT5BbHdheXMgaW5jbHVkZSBh
IGZpbGUgZXh0ZW5zaW9uIGluIHRoZSBmaWxlIG5hbWUgKC5odG1sLCAucGhwLCBldGMuKS48
L2xpPgo8L29sPgoKPGgyPlByb2NlZHVyZSBmb3IgbWFuYWdpbmcgZXhpc3RpbmcgZmlsZXM6
PC9oMj4KPG9sPgo8bGk+Q29weSB0aGUgY29udGVudHMgb2YgdGhlIGZpbGUgKGNhbGxlZCBm
b3IgZXhhbXBsZSBteWZpbGUucGhwKSBpbnRvIGEgbmV3IGZpbGUgaW4gRXh0ZW5zaW9ucyAm
Z3Q7IEV4dGVybmFsIEZpbGVzICZndDsgQ3JlYXRlIG5ldyBmaWxlLjwvbGk+CjxsaT5OYW1l
IHRoZSBuZXcgZmlsZSAoRXh0ZXJuYWwgZmlsZSBuYW1lOikg4oCYbXlmaWxlLnBocOKAmS48
L2xpPgo8bGk+UmVuYW1lIHRoZSBvcmlnaW5hbCBmaWxlICh0bywgZm9yIGV4YW1wbGUsIOKA
mG15ZmlsZV9vcmlnaW5hbC5waHDigJkpIC0gdGhlbiB5b3XigJlsbCBoYXZlIGEgYmFja3Vw
LjwvbGk+CjxsaT5NYWtlIGEgc3ltYm9saWMgbGluaywgaW4gdGhlIG9yaWdpbmFsIGZpbGUg
bG9jYXRpb24sIHRvIHRoZSBuZXcgZmlsZSAoZS5nLiBjZCB0byB0aGUg4oCYZXh0X2ZpbGVz
4oCZIGRpcmVjdG9yeSBhbmQgdGhlbiDigJhsbiAtcyAvb3JpZ2luYWxfZGlyZWN0b3J5X3Bh
dGgvbXlmaWxlLnBocCAuL215ZmlsZS5waHDigJkpLjwvbGk+Cjwvb2w+Cgo8aHIgLz4KCjxo
Mj5Ob3Rlczo8L2gyPgo8b2w+CjxsaT5Zb3UgY2FuIG9ubHkgbWFuYWdlIGZpbGVzIHdoaWNo
IGFyZSByZWFkL3dyaXRlIHRvIHlvdXIgd2ViIHNlcnZlciBlLmcuIE1pbmlmeSBjb25maWcg
ZmlsZXMsIGV4dGVybmFsIHNjcmlwdHMsIGV0Yy48L2xpPgo8bGk+RGVsZXRpbmcgYSBmaWxl
IHZpYSB0aGUgRXh0ZXJuYWwgRmlsZXMgdGFiIGRlbGV0ZXMgdGhlIGFjdHVhbCBmaWxlIGlu
IHRoZSDigJlleHRfZmlsZXPigJkgZGlyZWN0b3J5IChhcyB3ZWxsIGFzIHRoZSBkYXRhYmFz
ZSBlbnRyeSkgLSB1c2Ugd2l0aCBjYXJlIS48L2xpPgo8L29sPgoKCjxoMj5MYW5ndWFnZXMg
KFRleHRwYWNrKTwvaDI+Cjx1bD4KPGxpPlRoaXMgcGx1Z2luIGluc3RhbGxzIGFuIEVuZ2xp
c2ggVGV4dHBhY2sgYnkgZGVmYXVsdC48L2xpPgo8bGk+VG8gaW5zdGFsbCBhIFRleHRwYWNr
IGZvciB5b3VyIG93biBsYW5ndWFnZSBzZWUgdGhlIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHVi
LmNvbS9zcGlmZmluL3NwZl9leHQvYmxvYi9tYXN0ZXIvc3BmX2V4dF90ZXh0cGFjay50eHQi
Pmluc3RydWN0aW9ucyBvbiBHaXRIdWI8L2E+LjwvbGk+CjwvdWw+Cgo8aDI+VmVyc2lvbiBo
aXN0b3J5PC9oMj4KPHVsPgo8bGk+MC40IC0gMyBEZWNlbWJlciAyMDEyIC0gZml4ZWQgYSBz
aWxseSB0eXBvLjwvbGk+CjxsaT4wLjMxIC0gNyBOb3ZlbWJlciAyMDEyIC0gcmV3cml0dGVu
IGZvciBUZXh0cGF0dGVybiA0LjUueC48L2xpPgo8bGk+MC4yIC0gMjYgQXVndXN0IDIwMTIg
LSBzZWN1cml0eSBlbmhhbmNlbWVudHMgKHRoYW5rcyBKdWtrYSkuPC9saT4KPGxpPjAuMSAt
IEFwcmlsIDIwMTIgLSBmaXJzdCByZWxlYXNlLjwvbGk+CjwvdWw+IjtzOjQ6ImNvZGUiO3M6
ODg4MjoiLyoqCiAqIHNwZl9leHQgLSBFeHRlcm5hbCBmaWxlIGVkaXRvciBmb3IgVGV4dHBh
dHRlcm4KICoKICogwqkgMjAxMiBTaW1vbiBGaW5jaCAtIGh0dHBzOi8vZ2l0aHViLmNvbS9z
cGlmZmluL3NwZl9leHQKICoKICogTGljZW5zZWQgdW5kZXIgR05VIEdlbmVyYWwgUHVibGlj
IExpY2Vuc2UgdmVyc2lvbiAyCiAqIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwt
Mi4wLmh0bWwKICoKICogVmVyc2lvbiAwLjQgLS0gMyBEZWNlbWJlciAyMDEyCiAqLwoKLyoq
CiAqIFNldHVwIHRhYnMgYW5kIGNhbGxiYWNrCiAqLwoKaWYgKEB0eHBpbnRlcmZhY2UgPT0g
J2FkbWluJykgewoKICAgIGFkZF9wcml2cygnc3BmX2V4dCcsICcxJyk7CiAgICByZWdpc3Rl
cl90YWIoJ2V4dGVuc2lvbnMnLCAnc3BmX2V4dCcsIGdUeHQoJ3NwZl9leHRfZmlsZXMnKSk7
CiAgICByZWdpc3Rlcl9jYWxsYmFjaygnc3BmX2V4dF9ndWknLCAnc3BmX2V4dCcpOwogICAg
cmVnaXN0ZXJfY2FsbGJhY2soJ3NwZl9leHRfaW5zdGFsbCcsICdwbHVnaW5fbGlmZWN5Y2xl
LnNwZl9leHQnLCAnaW5zdGFsbGVkJyk7CiAgICByZWdpc3Rlcl9jYWxsYmFjaygnc3BmX2V4
dF9yZW1vdmUnLCAncGx1Z2luX2xpZmVjeWNsZS5zcGZfZXh0JywgJ2RlbGV0ZWQnKTsKCn0K
Ci8qKgogKiBHVUkgZnVuY3Rpb25zIC8gc3RlcCBkaXNwYXRjaGVyCiAqLwoKZnVuY3Rpb24g
c3BmX2V4dF9ndWkoKSB7CgogICAgZ2xvYmFsICRldmVudCwgJHN0ZXA7CgogICAgaWYgKCRl
dmVudCA9PSAnc3BmX2V4dCcpIHsKICAgICAgICByZXF1aXJlX3ByaXZzKCdzcGZfZXh0Jyk7
CgogICAgICAgIGJvdW5jZXIoJHN0ZXAsCiAgICAgICAgICAgIGFycmF5KAogICAgICAgICAg
ICAgICAgJ3NwZl9leHRfZWRpdF9yYXcnICAgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAn
cG91cicgICAgICAgICAgICAgID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ3NwZl9leHRf
c2F2ZScgICAgICAgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdzcGZfZXh0X2NvcHknICAg
ICAgID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3BmX2V4dF9kZWxldGUnICAgICA9PiB0
cnVlLAogICAgICAgICAgICAgICAgJ3NwZl9leHRfZWRpdCcgICAgICAgPT4gZmFsc2UsCiAg
ICAgICAgICAgICkKICAgICAgICApOwoKICAgICAgICBzd2l0Y2ggKCRzdGVwKSB7CiAgICAg
ICAgICAgIGNhc2UgJyc6IHNwZl9leHRfZWRpdCgpOyAgICAgICAgICAgICAgICAgICAgICAg
ICBicmVhazsKICAgICAgICAgICAgY2FzZSAnc3BmX2V4dF9lZGl0X3Jhdyc6IHNwZl9leHRf
ZWRpdCgpOyAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAncG91cic6IHNwZl9l
eHRfZWRpdCgpOyAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl
ICdzcGZfZXh0X3NhdmUnOiBzcGZfZXh0X3NhdmUoKTsgICAgICAgICAgICAgIGJyZWFrOwog
ICAgICAgICAgICBjYXNlICdzcGZfZXh0X2NvcHknOiBzcGZfZXh0X2NvcHkoKTsgICAgICAg
ICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdzcGZfZXh0X2RlbGV0ZSc6IHNwZl9l
eHRfZGVsZXRlKCk7ICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdzcGZfZXh0
X2VkaXQnOiBzcGZfZXh0X2VkaXQoKTsKICAgICAgICB9CiAgICB9Cn0KCi8qKgogKiBSZW1v
dmFsIGZ1bmN0aW9uCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9yZW1vdmUoJGV2ZW50LCAkc3Rl
cCkgewpnbG9iYWwgJHByZWZzLCAkc3RlcDsKCiAgICBpZihpc3NldCgkcHJlZnNbJ3NwZl9l
eHRfZGlyJ10pKSB7CgogICAgICAgIHNhZmVfZGVsZXRlKAogICAgICAgICAgICAndHhwX3By
ZWZzJywKICAgICAgICAgICAgIm5hbWU9J3NwZl9leHRfZGlyJyIKICAgICAgICApOwoKICAg
ICAgICAvLyBEb24ndCBkcm9wIHRoZSB0YWJsZSAtIGp1c3QgaW4gY2FzZS4uCiAgICAgICAg
Ly9Ac2FmZV9xdWVyeSgKICAgICAgICAvLyAgICAnRFJPUCBUQUJMRSBJRiBFWElTVFMgJy5z
YWZlX3BmeCgnc3BmX2V4dCcpCiAgICAgICAgLy8pOwoKICAgICAgICAvLyBkZWxldGUgdGhl
IFRleHRwYWNrCgogICAgICAgIHNhZmVfZGVsZXRlKAogICAgICAgICAgICAndHhwX2xhbmcn
LAogICAgICAgICAgICAiZXZlbnQgPSAnc3BmX2V4dCciCiAgICAgICAgKTsKCiAgICB9Cgp9
CgovKioKICogSW5zdGFsbGVyIGZ1bmN0aW9uCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9pbnN0
YWxsKCRldmVudCwgJHN0ZXApIHsKZ2xvYmFsICRwcmVmcywgJHN0ZXA7CgogICAgaWYoIWlz
c2V0KCRwcmVmc1snc3BmX2V4dF9kaXInXSkpIHsKCiAgICAgICAgc2FmZV9xdWVyeSgKICAg
ICAgICAgICAgIkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTICIuc2FmZV9wZngoJ3NwZl9l
eHQnKS4iICgKICAgICAgICAgICAgICAgIGZpbGVuYW1lIHZhcmNoYXIoMjU1KSBOT1QgTlVM
TCBkZWZhdWx0ICcnLAogICAgICAgICAgICAgICAgY29udGVudCBsb25ndGV4dCBOT1QgTlVM
TCwKICAgICAgICAgICAgICAgIFBSSU1BUlkgS0VZKGZpbGVuYW1lKQogICAgICAgICAgICAp
IENIQVJTRVQ9dXRmOCIKICAgICAgICApOwoKICAgICAgICBpZighc2FmZV9jb3VudCgic3Bm
X2V4dCIsICJmaWxlbmFtZT0naG9sZGVyLnR4dCciKSkgewoKICAgICAgICAgICAgc2FmZV9p
bnNlcnQoInNwZl9leHQiLCAiZmlsZW5hbWU9J2hvbGRlci50eHQnLCBjb250ZW50PSdIb2xk
ZXIgdGV4dCBmaWxlLi4ueW91IG5lZWQgYXQgbGVhc3Qgb25lIGZpbGUgaGVyZS4nIik7Cgog
ICAgICAgIH0KCiAgICAgICAgc2FmZV9pbnNlcnQoCiAgICAgICAgICAgICd0eHBfcHJlZnMn
LAogICAgICAgICAgICAicHJlZnNfaWQ9MSwKICAgICAgICAgICAgbmFtZT0nc3BmX2V4dF9k
aXInLAogICAgICAgICAgICB2YWw9J2V4dF9maWxlcycsCiAgICAgICAgICAgIHR5cGU9MSwK
ICAgICAgICAgICAgZXZlbnQ9J2FkbWluJywKICAgICAgICAgICAgaHRtbD0ndGV4dF9pbnB1
dCcsCiAgICAgICAgICAgIHBvc2l0aW9uPTIyIgogICAgICAgICk7CiAgICB9Cn0KCi8qKgog
KiBMaXN0IGZ1bmN0aW9uCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9saXN0KCRjdXJyZW50KSB7
CgogICAgLy8kb3V0W10gPSBzdGFydFRhYmxlKCdsaXN0JywgJ2xlZnQnKTsKCiRvdXRbXSA9
IHN0YXJ0VGFibGUoJycsICcnLCAndHhwLWxpc3QnKTsKCiAgICAkcnMgPSBzYWZlX3Jvd3Nf
c3RhcnQoJ2ZpbGVuYW1lJywgJ3NwZl9leHQnLCAiMT0xIik7CgogICAgaWYgKCRycykgewoK
ICAgICAgICB3aGlsZSAoJGEgPSBuZXh0Um93KCRycykpIHsKICAgICAgICAgICAgZXh0cmFj
dCgkYSk7CiAgICAgICAgICAgICRlZGl0ID0gKCRjdXJyZW50ICE9ICRmaWxlbmFtZSkgPyBl
TGluaygnc3BmX2V4dCcsICcnLCAnZmlsZW5hbWUnLCAkZmlsZW5hbWUsICRmaWxlbmFtZSkg
OiB0eHBzcGVjaWFsY2hhcnMoJGZpbGVuYW1lKTsKICAgICAgICAgICAgJGRlbGV0ZSA9ICgk
ZmlsZW5hbWUpID8gZExpbmsoJ3NwZl9leHQnLCAnc3BmX2V4dF9kZWxldGUnLCAnZmlsZW5h
bWUnLCAkZmlsZW5hbWUpIDogJyc7CiAgICAgICAgICAgICRvdXRbXSA9IHRyKHRkKCRlZGl0
KS50ZCgkZGVsZXRlKSk7CiAgICAgICAgfQoKICAgICAgICAkb3V0W10gPSAgZW5kVGFibGUo
KTsKCiAgICAgICAgcmV0dXJuIGpvaW4oJycsICRvdXQpOwoKICAgIH0KfQoKLyoqCiAqIEVk
aXQgZnVuY3Rpb24KICovCgpmdW5jdGlvbiBzcGZfZXh0X2VkaXQoJG1lc3NhZ2U9JycpIHsK
CiAgICBwYWdldG9wKGdUeHQoJ3NwZl9leHRfZmlsZXMnKSwkbWVzc2FnZSk7CiAgICBnbG9i
YWwgJHN0ZXAsICRwcmVmczsKICAgIHNwZl9leHRfZWRpdF9yYXcoKTsKCn0KCi8qKgogKiBF
ZGl0IGZ1bmN0aW9uIChyYXcpCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9lZGl0X3JhdygpIHsK
CiAgICBnbG9iYWwgJGV2ZW50LCAkc3RlcDsKCiAgICAkZmlyc3QgPSBzYWZlX3JvdygnZmls
ZW5hbWUnLCAnc3BmX2V4dCcsICIxPTEiKTsKICAgICRmaXJzdF9maWxlID0gJGZpcnN0Wydm
aWxlbmFtZSddOwoKICAgIGV4dHJhY3QoZ3BzYShhcnJheSgnZmlsZW5hbWUnLCAnbmV3bmFt
ZScsICdjb3B5JywgJ3NhdmVuZXcnKSkpOwoKICAgIGlmICgkc3RlcCA9PSAnc3BmX2V4dF9k
ZWxldGUnIHx8IGVtcHR5KCRmaWxlbmFtZSkgJiYgJHN0ZXAgIT0gJ3BvdXInICYmICEkc2F2
ZW5ldykgewoKICAgICAgICAkZmlsZW5hbWUgPSAkZmlyc3RfZmlsZTsKCiAgICB9CgogICAg
ZWxzZWlmICgoJGNvcHkgfHwgJHNhdmVuZXcpICYmIHRyaW0ocHJlZ19yZXBsYWNlKCcvWzw+
JiJcJ10vJywgJycsICRuZXduYW1lKSkpIHsKCiAgICAgICAgJGZpbGVuYW1lID0gJG5ld25h
bWU7CgogICAgfQoKICAgIGlmIChlbXB0eSgkZmlsZW5hbWUpKSB7CgogICAgICAgICRidXR0
b25zID0gJzxkaXYgY2xhc3M9ImVkaXQtdGl0bGUiPicuCiAgICAgICAgZ1R4dCgnc3BmX2Zp
bGVfbmFtZScpLic6ICcKICAgICAgICAuZklucHV0KCd0ZXh0JywnbmV3bmFtZScsJycsJ2Vk
aXQnLCcnLCcnLDIwKS4KICAgICAgICBoSW5wdXQoJ3NhdmVuZXcnLCdzYXZlbmV3JykuCiAg
ICAgICAgJzwvZGl2Pic7CiAgICAgICAgJGZpbGVjb250ZW50ID0gZ3BzKCdzcGZfZXh0Jyk7
CgogICAgfSBlbHNlIHsKCiAgICAgICAgJGJ1dHRvbnMgPSAnPGRpdiBjbGFzcz0iZWRpdC10
aXRsZSI+Jy5nVHh0KCdzcGZfZWRpdF9zY3JpcHQnKS5zcC5zdHJvbmcodHhwc3BlY2lhbGNo
YXJzKCRmaWxlbmFtZSkpLic8L2Rpdj4nOwogICAgICAgICRmaWxlY29udGVudCA9IGZldGNo
KCJjb250ZW50Iiwnc3BmX2V4dCcsJ2ZpbGVuYW1lJywkZmlsZW5hbWUpOwoKICAgIH0KCiAg
ICBpZiAoIWVtcHR5KCRmaWxlbmFtZSkpIHsKCiAgICAgICAgJGNvcHkgPSAnPHNwYW4gY2xh
c3M9ImNvcHktYXMiPjxsYWJlbCBmb3I9ImNvcHktZmlsZSI+Jy5nVHh0KCdzcGZfY29weV9m
aWxlJykuJzwvbGFiZWw+Jy5zcC5mSW5wdXQoJ3RleHQnLCAnbmV3bmFtZScsICcnLCAnZWRp
dCcsICcnLCAnJywgJycsICcnLCAnY29weS1maWxlJykuc3AuCiAgICAgICAgICAgIGZJbnB1
dCgnc3VibWl0JywgJ2NvcHknLCBnVHh0KCdjb3B5JyksICdzbWFsbGVyYm94JykuJzwvc3Bh
bj4nOwoKICAgIH0gZWxzZSB7CgogICAgICAgICRjb3B5ID0gJyc7CgogICAgfQoKICAgICRy
aWdodCA9CiAgICAnPGRpdiBpZD0iY29udGVudF9zd2l0Y2hlciI+Jy4KICAgIGhlZChnVHh0
KCdzcGZfYWxsX2ZpbGVzJyksMikuCiAgICBncmFmKHNMaW5rKCdzcGZfZXh0JywgJ3BvdXIn
LCBnVHh0KCdzcGZfY3JlYXRlX25ld19maWxlJykpLCAnIGNsYXNzPSJhY3Rpb24tY3JlYXRl
IicpLgogICAgc3BmX2V4dF9saXN0KCRmaWxlbmFtZSkuCiAgICAnPC9kaXY+JzsKCiAgICBl
Y2hvCiAgICAnPGgxIGNsYXNzPSJ0eHAtaGVhZGluZyI+Jy5nVHh0KCdzcGZfZXh0X2ZpbGVz
JykuJzwvaDE+Jy4KICAgICc8ZGl2IGlkPSInLiRldmVudC4nX2NvbnRhaW5lciIgY2xhc3M9
InR4cC1jb250YWluZXIiPicuCiAgICBzdGFydFRhYmxlKCcnLCAnJywgJ3R4cC1jb2x1bW50
YWJsZScpLgogICAgdHIoCiAgICAgICAgdGQoCiAgICAgICAgICAgIGZvcm0oCiAgICAgICAg
ICAgICAgICAnPGRpdiBpZD0ibWFpbl9jb250ZW50Ij4nLgogICAgICAgICAgICAgICAgJGJ1
dHRvbnMuCiAgICAgICAgICAgICAgICAnPHRleHRhcmVhIGlkPSJzcGZfZXh0IiBjbGFzcz0i
Y29kZSIgbmFtZT0ic3BmX2V4dCIgY29scz0iJy5JTlBVVF9MQVJHRS4nIiByb3dzPSInLklO
UFVUX1JFR1VMQVIuJyIgc3R5bGU9ImhlaWdodDogMzkuMjVlbTsiPicudHhwc3BlY2lhbGNo
YXJzKCRmaWxlY29udGVudCkuJzwvdGV4dGFyZWE+Jy4KICAgICAgICAgICAgICAgICc8cD4n
LmZJbnB1dCgnc3VibWl0JywnJyxnVHh0KCdzYXZlJyksJ3B1Ymxpc2gnKS4KICAgICAgICAg
ICAgICAgIGVJbnB1dCgnc3BmX2V4dCcpLnNJbnB1dCgnc3BmX2V4dF9zYXZlJykuCiAgICAg
ICAgICAgICAgICBoSW5wdXQoJ2ZpbGVuYW1lJywkZmlsZW5hbWUpLic8L3A+JwogICAgICAg
ICAgICAgICAgLiRjb3B5LgogICAgICAgICAgICAgICAgJzwvZGl2PicKICAgICAgICAgICAg
LCAnJywgJycsICdwb3N0JywgJ2VkaXQtZm9ybScsICcnLCAnc3R5bGVfZm9ybScpCiAgICAg
ICAgLCAnJywgJ2NvbHVtbicpLgogICAgICAgIHRkdGwoCiAgICAgICAgICAgICRyaWdodAog
ICAgICAgICwgJyBjbGFzcz0iY29sdW1uIicpCiAgICApLgogICAgZW5kVGFibGUoKS4KICAg
ICc8L2Rpdj4nOwp9CgovKioKICogQ29weSBmdW5jdGlvbgogKgogKi8KCmZ1bmN0aW9uIHNw
Zl9leHRfY29weSgpIHsKCiAgICBleHRyYWN0KGdwc2EoYXJyYXkoJ29sZG5hbWUnLCAnbmV3
bmFtZScpKSk7CgogICAgJGNvbnRlbnQgPSBkb1NsYXNoKGZldGNoKCdjb250ZW50JywgJ3Nw
Zl9leHQnLCAnZmlsZW5hbWUnLCAkb2xkbmFtZSkpOwoKICAgICRycyA9IHNhZmVfaW5zZXJ0
KCdzcGZfZXh0JywgImNvbnRlbnQgPSAnJGNvbnRlbnQnLCBmaWxlbmFtZSA9ICciLmRvU2xh
c2goJG5ld25hbWUpLiInIik7CgogICAgc3BmX2V4dF9lZGl0KAogICAgICAgIGdUeHQoJ3Nw
Zl9maWxlX2NyZWF0ZWQnLCBhcnJheSgne25hbWV9JyA9PiAkbmV3bmFtZSkpCiAgICApOwp9
CgovKioKICogU2F2ZSBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNwZl9leHRfc2F2ZSgpIHsK
CiAgICBleHRyYWN0KGdwc2EoYXJyYXkoJ2ZpbGVuYW1lJywnc3BmX2V4dCcsJ3NhdmVuZXcn
LCduZXduYW1lJywnY29weScpKSk7CiAgICAkY29udGVudCA9IGRvU2xhc2goJHNwZl9leHQp
OwoKICAgIGlmICgkc2F2ZW5ldyBvciAkY29weSkgewoKICAgICAgICAkbmV3bmFtZSA9IGRv
U2xhc2godHJpbShwcmVnX3JlcGxhY2UoJy9bPD4mIlwnXS8nLCAnJywgZ3BzKCduZXduYW1l
JykpKSk7CgogICAgICAgIGlmICgkbmV3bmFtZSBhbmQgc2FmZV9maWVsZCgnZmlsZW5hbWUn
LCAnc3BmX2V4dCcsICJmaWxlbmFtZSA9ICckbmV3bmFtZSciKSkgewoKICAgICAgICAgICAg
JG1lc3NhZ2UgPSBnVHh0KCdzcGZfZmlsZV9leGlzdHMnLCBhcnJheSgne25hbWV9JyA9PiAk
bmV3bmFtZSkpOwoKICAgICAgICAgICAgaWYgKCRzYXZlbmV3KSB7CgogICAgICAgICAgICAg
ICAgJF9QT1NUWyduZXduYW1lJ10gPSAnJzsKCiAgICAgICAgICAgIH0KCiAgICAgICAgfSBl
bHNlaWYgKCRuZXduYW1lKSB7CgogICAgICAgICAgICBzYWZlX2luc2VydCgnc3BmX2V4dCcs
ICJmaWxlbmFtZSA9ICciLiRuZXduYW1lLiInLCBjb250ZW50ID0gJyRjb250ZW50JyIpOwoK
ICAgICAgICAgICAgJG1lc3NhZ2UgPSBnVHh0KCdzcGZfZmlsZV9jcmVhdGVkJywgYXJyYXko
J3tuYW1lfScgPT4gJG5ld25hbWUpKTsKCiAgICAgICAgICAgIHNwZl9leHRfd3JpdGUoKTsK
CiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICRtZXNzYWdlID0gYXJyYXkoZ1R4dCgn
c3BmX2ZpbGVfbmFtZV9yZXF1aXJlZCcpLCBFX0VSUk9SKTsKCiAgICAgICAgfQoKICAgICAg
ICBzcGZfZXh0X2VkaXQoJG1lc3NhZ2UpOwoKICAgIH0gZWxzZSB7CgogICAgICAgIHNhZmVf
dXBkYXRlKCdzcGZfZXh0JywgImNvbnRlbnQgPSAnJGNvbnRlbnQnIiwgImZpbGVuYW1lID0g
JyIuZG9TbGFzaCgkZmlsZW5hbWUpLiInIik7CgogICAgICAgICRtZXNzYWdlID0gZ1R4dCgn
c3BmX2ZpbGVfdXBkYXRlZCcsIGFycmF5KCd7bmFtZX0nID0+ICRmaWxlbmFtZSkpOwoKICAg
ICAgICBzcGZfZXh0X3dyaXRlKCk7CgogICAgICAgIHNwZl9leHRfZWRpdCgkbWVzc2FnZSk7
CgogICAgfQoKfQoKLyoqCiAqIFdyaXRlIGZ1bmN0aW9uCiAqLwoKZnVuY3Rpb24gc3BmX2V4
dF93cml0ZSgpIHsKCiAgICBnbG9iYWwgJHByZWZzOwogICAgZXh0cmFjdChncHNhKGFycmF5
KCdmaWxlbmFtZScsJ3NwZl9leHQnLCdzYXZlbmV3JywnbmV3bmFtZScsJ2NvcHknKSkpOwoK
ICAgICRmaWxlbmFtZSA9IChwcygnY29weScpIG9yIHBzKCdzYXZlbmV3JykpID8gcHMoJ25l
d25hbWUnKSA6IHBzKCdmaWxlbmFtZScpOwogICAgJGZpbGUgPSAkcHJlZnNbJ3BhdGhfdG9f
c2l0ZSddLicvJy4kcHJlZnNbJ3NwZl9leHRfZGlyJ10uJy8nLnNhbml0aXplRm9yRmlsZSgk
ZmlsZW5hbWUpOwoKICAgIGlmIChlbXB0eSgkcHJlZnNbJ3NwZl9leHRfZGlyJ10pIG9yICEk
ZmlsZW5hbWUpIHsKCiAgICAgICAgcmV0dXJuOwoKICAgIH0gZWxzZSB7CgogICAgJGNvbnRl
bnRfcmF3ID0gZmV0Y2goImNvbnRlbnQiLCAic3BmX2V4dCIsICdmaWxlbmFtZScsICRmaWxl
bmFtZSk7IC8vIE1vdmVkIGhlcmUgdG8gc2F2ZSBuZXdseS1jcmVhdGVkIGZpbGVzCgogICAg
ICAgICRoYW5kbGUgPSBmb3BlbigkZmlsZSwgJ3diJyk7CiAgICAgICAgZndyaXRlKCRoYW5k
bGUsICRjb250ZW50X3Jhdyk7CiAgICAgICAgZmNsb3NlKCRoYW5kbGUpOwogICAgICAgIGNo
bW9kKCRmaWxlLCAwNjQ0KTsKICAgIH0KCn0KCi8qKgogKiBEZWxldGUgZnVuY3Rpb24KICov
CgpmdW5jdGlvbiBzcGZfZXh0X2RlbGV0ZSgpIHsKCiAgICBnbG9iYWwgJHByZWZzOwoKICAg
ICRmaWxlbmFtZSA9IHBzKCdmaWxlbmFtZScpOwogICAgJGZpbGUgPSAkcHJlZnNbJ3BhdGhf
dG9fc2l0ZSddLicvJy4kcHJlZnNbJ3NwZl9leHRfZGlyJ10uJy8nLiRmaWxlbmFtZTsKCiAg
ICAgICAgaWYgKCFlbXB0eSgkcHJlZnNbJ3NwZl9leHRfZGlyJ10pIGFuZCAkZmlsZW5hbWUp
IHsKCiAgICAgICAgICAgIHNhZmVfZGVsZXRlKCdzcGZfZXh0JywgImZpbGVuYW1lID0gJyIu
ZG9TbGFzaCgkZmlsZW5hbWUpLiInIik7CgogICAgICAgICAgICBAdW5saW5rKCRmaWxlKTsK
CiAgICAgICAgc3BmX2V4dF9lZGl0KAoKICAgICAgICAgICAgZ1R4dCgnc3BmX2ZpbGVfZGVs
ZXRlZCcsIGFycmF5KCd7bmFtZX0nID0+ICRmaWxlbmFtZSkpCiAgICAgICAgKTsKCiAgICB9
IGVsc2UgewogICAgICAgIHJldHVybjsKICAgIH0KCn0iO3M6MzoibWQ1IjtzOjMyOiIxNjU5
Nzg3YjdlNTc4ZjdmNDYwOTc3MjEzZDBhZjI5NiI7fQ==