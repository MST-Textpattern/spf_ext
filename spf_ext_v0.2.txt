# spf_ext v0.2
# External file editor
# Simon Finch
# https://github.com/spiffin/spf_ext

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMjp7czo0OiJuYW1lIjtzOjc6InNwZl9leHQiO3M6NzoidmVyc2lvbiI7czozOiIwLjIi
O3M6NjoiYXV0aG9yIjtzOjExOiJTaW1vbiBGaW5jaCI7czoxMDoiYXV0aG9yX3VyaSI7czoz
NDoiaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dCI7czoxMToiZGVzY3JpcHRp
b24iO3M6MjA6IkV4dGVybmFsIGZpbGUgZWRpdG9yIjtzOjU6Im9yZGVyIjtzOjE6IjUiO3M6
NDoidHlwZSI7czoxOiIzIjtzOjU6ImZsYWdzIjtzOjE6IjIiO3M6ODoidGV4dHBhY2siO3M6
NTg3OiIjQHNwZl9leHQKc3BmX2V4dF9maWxlcyA9PiBFeHRlcm5hbCBGaWxlcwpzcGZfZXh0
X2RpciA9PiBFeHRlcm5hbCBmaWxlcyBkaXJlY3RvcnkKc3BmX2ZpbGVuYW1lID0+IEZpbGVu
YW1lCnNwZl9lZGl0X2ZpbGUgPT4gWW91IGFyZSBlZGl0aW5nIGZpbGUKc3BmX2FsbF9maWxl
cyA9PiBBbGwgRmlsZXMKc3BmX2ZpbGVfdXBkYXRlZCA9PiBGaWxlIDxzdHJvbmc+e25hbWV9
PC9zdHJvbmc+IHVwZGF0ZWQuCnNwZl9maWxlX25hbWUgPT4gRXh0ZXJuYWwgZmlsZSBuYW1l
CnNwZl9jb3B5X2ZpbGUgPT4gJiM4MjMwO29yIGNvcHkgZmlsZSBhcwpzcGZfY3JlYXRlX25l
d19maWxlID0+IENyZWF0ZSBuZXcgZmlsZQpzcGZfZmlsZV9jcmVhdGVkID0+IEZpbGUgPHN0
cm9uZz57bmFtZX08L3N0cm9uZz4gY3JlYXRlZC4Kc3BmX2ZpbGVfbmFtZV9yZXF1aXJlZCA9
PiBQbGVhc2UgcHJvdmlkZSBhIG5hbWUgZm9yIHlvdXIgZmlsZS4Kc3BmX2ZpbGVfZXhpc3Rz
ID0+IEZpbGUgPHN0cm9uZz57bmFtZX08L3N0cm9uZz4gYWxyZWFkeSBleGlzdHMuCnNwZl9m
aWxlX2RlbGV0ZWQgPT4gRmlsZSA8c3Ryb25nPntuYW1lfTwvc3Ryb25nPiBkZWxldGVkLiI7
czo0OiJoZWxwIjtzOjMxODE6IjxoMSBpZD0ic3BmX2V4dCI+c3BmX2V4dDwvaDE+Cgo8cD5F
eHRlcm5hbCBmaWxlIGVkaXRvciBwbHVnaW4uIENyZWF0ZSwgZWRpdCBhbmQgZGVsZXRlIGV4
dGVybmFsICh0byBUZXh0cGF0dGVybikgZmlsZXMgaW4gVGV4dHBhdHRlcm4gYWRtaW4uPC9w
Pgo8cD5SRVFVSVJFUzogVGV4cGF0dGVybiA0LjQuMSBhbmQgUEhQIDUgYW5kIHNoZWxsIGFj
Y2VzcyAoZm9yIHN5bS1saW5raW5nIGV4aXN0aW5nIGZpbGVzKS48L3A+CjxwPjxzdHJvbmc+
UGxlYXNlIHJlYWQgdGhlIGluc3RydWN0aW9ucyBhbmQgbm90ZXMgYmVsb3cgYmVmb3JlIHVz
ZS48L3N0cm9uZz48L3A+CjxwPlRoaXMgcGx1Z2luIGNyZWF0ZXMgZXh0ZXJuYWwgZmlsZXMg
eW91IGNhbiBtYW5hZ2UgYW5kIGVkaXQgdmlhIHRoZSBhZG1pbiBpbnRlcmZhY2UuIEFsbCBm
aWxlcyBhcmUgc2F2ZWQgdG8gdGhlIGRpcmVjdG9yeSB5b3UgY3JlYXRlIGluIHN0ZXAgMSBv
ZiB0aGUgaW5zdHJ1Y3Rpb25zIGJlbG93LiBTeW50YXggaGlnaGxpZ2h0aW5nIGlzIGF2YWls
YWJsZSB2aWEgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2NvZGVt
aXJyb3IiPnNwZl9jb2RlbWlycm9yPC9hPiAoY3VycmVudGx5IEhUTUwsIFBIUCBhbmQgSmF2
YVNjcmlwdCAtIG1vcmUgdG8gY29tZSkuPC9wPgoKPGgyIGlkPSJ3aHkiPldoeT88L2gyPgo8
dWw+CjxsaT5UaGlzIHBsdWdpbiBhbGxvd3MgeW91IHRvIGVkaXQgYW5kIG1hbmFnZSBzaXRl
IGZpbGVzIHJlc2lkaW5nIG91dHNpZGUgVGV4dHBhdHRlcm4gd2l0aGluIHRoZSBUZXh0cGF0
dGVybiBhZG1pbiBhcmVhIChzZWUg4oCYUHJvY2VkdXJlIGZvciBtYW5hZ2luZyBleGlzdGlu
ZyBmaWxlc+KAmSBiZWxvdykuPC9saT4KPGxpPkl0IG9mZmVycyBhbiBlYXN5IHdheSB0byBj
cmVhdGUgc3RhdGljIGZpbGVzIHlvdSBjYW4gZWRpdCBhbmQgYWNjZXNzIHZpYSB5b3VyIHBh
Z2UgdGVtcGxhdGVzOiA8Y29kZT4mbHQ7dHhwOnNpdGVfdXJsIC8mZ3Q7ZXh0X2ZpbGVzL3lv
dXJmaWxlLmh0bWw8L2NvZGU+PC9saT4KPC91bD4KCjxociAvPgoKPGgyIGlkPSJpbnN0cnVj
dGlvbnMiPkluc3RydWN0aW9uczo8L2gyPgoKPG9sPgo8bGk+Q3JlYXRlIGEgZGlyZWN0b3J5
IGZvciB0aGUgc3RhdGljIGV4dGVybmFsIGZpbGVzIGluIHRoZSByb290IG9mIHlvdXIgdGV4
dHBhdHRlcm4gaW5zdGFsbGF0aW9uIGNhbGxlZCDigJhleHRfZmlsZXPigJkgKG9yIHdoYXRl
dmVyIHlvdSBsaWtlKS4gWW91IHNob3VsZCBtYWtlIHN1cmUgdGhhdCBQSFAgaXMgYWJsZSB0
byB3cml0ZSB0byB0aGF0IGRpcmVjdG9yeS48L2xpPgo8bGk+VmlzaXQgdGhlIGFkdmFuY2Vk
IHByZWZlcmVuY2VzIGFuZCBtYWtlIHN1cmUgdGhlIOKAnEV4dGVybmFsIGZpbGVzIGRpcmVj
dG9yeeKAnSBwcmVmZXJlbmNlIGNvbnRhaW5zIHRoZSBkaXJlY3RvcnkgeW91IGNyZWF0ZWQg
aW4gc3RlcCAxIChieSBkZWZhdWx0IOKAmGV4dF9maWxlc+KAmSkuIFRoaXMgcGF0aCBpcyBy
ZWxhdGl2ZSBwYXRoIHRvIHRoZSBkaXJlY3Rvcnkgb2YgeW91ciByb290IFRleHRwYXR0ZXJu
IGluc3RhbGxhdGlvbi48L2xpPgo8bGk+QWN0aXZhdGUgdGhpcyBwbHVnaW4uPC9saT4KPGxp
PkdvIHRvIEV4dGVuc2lvbnMgJmd0OyBFeHRlcm5hbCBGaWxlcyBhbmQgY3JlYXRlIGZpbGVz
IHlvdeKAmWQgbGlrZSB0byBtYW5hZ2UuPC9saT4KPGxpPkFsd2F5cyBpbmNsdWRlIGEgZmls
ZSBleHRlbnNpb24gaW4gdGhlIGZpbGUgbmFtZSAoLmh0bWwsIC5waHAsIGV0Yy4pLjwvbGk+
Cjwvb2w+Cgo8aDIgaWQ9InByb2NlZHVyZS1mb3ItbWFuYWdpbmctZXhpc3RpbmctZmlsZXMi
PlByb2NlZHVyZSBmb3IgbWFuYWdpbmcgZXhpc3RpbmcgZmlsZXM6PC9oMj4KPG9sPgo8bGk+
Q29weSB0aGUgY29udGVudHMgb2YgdGhlIGZpbGUgKGNhbGxlZCBmb3IgZXhhbXBsZSBteWZp
bGUucGhwKSBpbnRvIGEgbmV3IGZpbGUgaW4gRXh0ZW5zaW9ucyAmZ3Q7IEV4dGVybmFsIEZp
bGVzICZndDsgQ3JlYXRlIG5ldyBmaWxlLjwvbGk+CjxsaT5OYW1lIHRoZSBuZXcgZmlsZSAo
RXh0ZXJuYWwgZmlsZSBuYW1lOikg4oCYbXlmaWxlLnBocOKAmS48L2xpPgo8bGk+UmVuYW1l
IHRoZSBvcmlnaW5hbCBmaWxlICh0bywgZm9yIGV4YW1wbGUsIOKAmG15ZmlsZV9vcmlnaW5h
bC5waHDigJkpIC0gdGhlbiB5b3XigJlsbCBoYXZlIGEgYmFja3VwLjwvbGk+CjxsaT5NYWtl
IGEgc3ltYm9saWMgbGluaywgaW4gdGhlIG9yaWdpbmFsIGZpbGUgbG9jYXRpb24sIHRvIHRo
ZSBuZXcgZmlsZSAoZS5nLiBjZCB0byB0aGUg4oCYZXh0X2ZpbGVz4oCZIGRpcmVjdG9yeSBh
bmQgdGhlbiDigJhsbiAtcyAvb3JpZ2luYWxfZGlyZWN0b3J5X3BhdGgvbXlmaWxlLnBocCAu
L215ZmlsZS5waHDigJkpLjwvbGk+Cjwvb2w+Cgo8aHIgLz4KCjxoMiBpZD0ibm90ZXMiPk5v
dGVzOjwvaDI+CjxvbD4KPGxpPllvdSBjYW4gb25seSBtYW5hZ2UgZmlsZXMgd2hpY2ggYXJl
IHJlYWQvd3JpdGUgdG8geW91ciB3ZWIgc2VydmVyIGUuZy4gTWluaWZ5IGNvbmZpZyBmaWxl
cywgZXh0ZXJuYWwgc2NyaXB0cywgZXRjLjwvbGk+CjxsaT5EZWxldGluZyBhIGZpbGUgdmlh
IHRoZSBFeHRlcm5hbCBGaWxlcyB0YWIgZGVsZXRlcyB0aGUgYWN0dWFsIGZpbGUgaW4gdGhl
IOKAmWV4dF9maWxlc+KAmSBkaXJlY3RvcnkgKGFzIHdlbGwgYXMgdGhlIGRhdGFiYXNlIGVu
dHJ5KSAtIHVzZSB3aXRoIGNhcmUhLjwvbGk+Cjwvb2w+CgoKPGgyIGlkPSJsYW5ndWFnZXMt
dGV4dHBhY2siPkxhbmd1YWdlcyAoVGV4dHBhY2spPC9oMj4KPHVsPgo8bGk+VGhpcyBwbHVn
aW4gaW5zdGFsbHMgYW4gRW5nbGlzaCBUZXh0cGFjayBieSBkZWZhdWx0LjwvbGk+CjxsaT5U
byBpbnN0YWxsIGEgVGV4dHBhY2sgZm9yIHlvdXIgb3duIGxhbmd1YWdlIHNlZSB0aGUgPGEg
aHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dC9ibG9iL21hc3Rlci9z
cGZfZXh0X3RleHRwYWNrLnR4dCI+aW5zdHJ1Y3Rpb25zIG9uIEdpdEh1YjwvYT4uPC9saT4K
PC91bD4KCjxoMiBpZD0idmVyc2lvbi1oaXN0b3J5Ij5WZXJzaW9uIGhpc3Rvcnk8L2gyPgo8
dWw+CjxsaT4wLjIgLSAyNiBBdWd1c3QgMjAxMiAtIHNlY3VyaXR5IGVuaGFuY2VtZW50cyAo
dGhhbmtzIEp1a2thKS48L2xpPgo8bGk+MC4xIC0gQXByaWwgMjAxMiAtIGZpcnN0IHJlbGVh
c2UuPC9saT4KPC91bD4iO3M6NDoiY29kZSI7czo4NTkyOiIvKioKICogc3BmX2V4dCAtIEV4
dGVybmFsIGZpbGUgZWRpdG9yIGZvciBUZXh0cGF0dGVybgogKgogKiDCqSAyMDEyIFNpbW9u
IEZpbmNoIC0gaHR0cHM6Ly9naXRodWIuY29tL3NwaWZmaW4vc3BmX2V4dAogKgogKiBMaWNl
bnNlZCB1bmRlciBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2ZXJzaW9uIDIKICogaHR0
cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0yLjAuaHRtbAogKgogKiBWZXJzaW9uIDAu
MiAtLSAyNiBBdWd1c3QgMjAxMgogKi8KCi8qKgogKiBTZXR1cCB0YWJzIGFuZCBjYWxsYmFj
awogKi8KCmlmIChAdHhwaW50ZXJmYWNlID09ICdhZG1pbicpIHsKCiAgICBhZGRfcHJpdnMo
J3NwZl9leHQnLCAnMScpOwogICAgcmVnaXN0ZXJfdGFiKCdleHRlbnNpb25zJywgJ3NwZl9l
eHQnLCBnVHh0KCdzcGZfZXh0X2ZpbGVzJykpOwogICAgcmVnaXN0ZXJfY2FsbGJhY2soJ3Nw
Zl9leHRfZ3VpJywgJ3NwZl9leHQnKTsKICAgIHJlZ2lzdGVyX2NhbGxiYWNrKCdzcGZfZXh0
X2luc3RhbGwnLCAncGx1Z2luX2xpZmVjeWNsZS5zcGZfZXh0Jyk7Cgp9CgovKioKICogR1VJ
IGZ1bmN0aW9ucyAvIHN0ZXAgZGlzcGF0Y2hlcgogKi8KCmZ1bmN0aW9uIHNwZl9leHRfZ3Vp
KCkgewoKICAgIGdsb2JhbCAkZXZlbnQsICRzdGVwOwoKICAgIGlmICgkZXZlbnQgPT0gJ3Nw
Zl9leHQnKSB7CiAgICAgICAgcmVxdWlyZV9wcml2cygnc3BmX2V4dCcpOwoKICAgICAgICBi
b3VuY2VyKCRzdGVwLAogICAgICAgICAgICBhcnJheSgKICAgICAgICAgICAgICAgICdzcGZf
ZXh0X2VkaXRfcmF3JyAgID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ3BvdXInICAgICAg
ICAgICAgICA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdzcGZfZXh0X3NhdmUnICAgICAg
ID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3BmX2V4dF9jb3B5JyAgICAgICA9PiB0cnVl
LAogICAgICAgICAgICAgICAgJ3NwZl9leHRfZGVsZXRlJyAgICAgPT4gdHJ1ZSwKICAgICAg
ICAgICAgICAgICdzcGZfZXh0X2VkaXQnICAgICAgID0+IGZhbHNlLAogICAgICAgICAgICAp
CiAgICAgICAgKTsKCiAgICAgICAgc3dpdGNoICgkc3RlcCkgewogICAgICAgICAgICBjYXNl
ICcnOiBzcGZfZXh0X2VkaXQoKTsgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg
ICAgICAgICAgIGNhc2UgJ3NwZl9leHRfZWRpdF9yYXcnOiBzcGZfZXh0X2VkaXQoKTsgICAg
ICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3BvdXInOiBzcGZfZXh0X2VkaXQoKTsg
ICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnc3BmX2V4dF9z
YXZlJzogc3BmX2V4dF9zYXZlKCk7ICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg
Y2FzZSAnc3BmX2V4dF9jb3B5Jzogc3BmX2V4dF9jb3B5KCk7ICAgICAgICAgICAgICBicmVh
azsKICAgICAgICAgICAgY2FzZSAnc3BmX2V4dF9kZWxldGUnOiBzcGZfZXh0X2RlbGV0ZSgp
OyAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnc3BmX2V4dF9lZGl0Jzogc3Bm
X2V4dF9lZGl0KCk7CiAgICAgICAgfQogICAgfQp9CgovKioKICogSW5zdGFsbGVyIGZ1bmN0
aW9uCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9pbnN0YWxsKCRldmVudD0nJywgJHN0ZXA9Jycp
IHsKCiAgICBnbG9iYWwgJHByZWZzOwoKICAgIGlmKCRzdGVwID09ICdkZWxldGVkJykgewoK
ICAgICAgICBzYWZlX2RlbGV0ZSgKICAgICAgICAgICAgJ3R4cF9wcmVmcycsCiAgICAgICAg
ICAgICJuYW1lPSdzcGZfZXh0X2RpciciCiAgICAgICAgKTsKCiAgICAgICAgLy8gRG9uJ3Qg
ZHJvcCB0aGUgdGFibGUgLSBqdXN0IGluIGNhc2UuLgogICAgICAgIC8vQHNhZmVfcXVlcnko
CiAgICAgICAgLy8gICAgJ0RST1AgVEFCTEUgSUYgRVhJU1RTICcuc2FmZV9wZngoJ3NwZl9l
eHQnKQogICAgICAgIC8vKTsKCiAgICAgICAgLy8gZGVsZXRlIHRoZSBUZXh0cGFjawoKICAg
ICAgICBzYWZlX2RlbGV0ZSgKICAgICAgICAgICAgJ3R4cF9sYW5nJywKICAgICAgICAgICAg
ImV2ZW50ID0gJ3NwZl9leHQnIgogICAgICAgICk7CgogICAgICAgIHJldHVybjsKCiAgICB9
CgogICAgaWYoIWlzc2V0KCRwcmVmc1snc3BmX2V4dF9kaXInXSkpIHsKCiAgICAgICAgc2Fm
ZV9xdWVyeSgKICAgICAgICAgICAgIkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTICIuc2Fm
ZV9wZngoJ3NwZl9leHQnKS4iICgKICAgICAgICAgICAgICAgIGZpbGVuYW1lIHZhcmNoYXIo
MjU1KSBOT1QgTlVMTCBkZWZhdWx0ICcnLAogICAgICAgICAgICAgICAgY29udGVudCBsb25n
dGV4dCBOT1QgTlVMTCwKICAgICAgICAgICAgICAgIFBSSU1BUlkgS0VZKGZpbGVuYW1lKQog
ICAgICAgICAgICApIENIQVJTRVQ9dXRmOCIKICAgICAgICApOwoKICAgICAgICBpZighc2Fm
ZV9jb3VudCgic3BmX2V4dCIsICJmaWxlbmFtZT0naG9sZGVyLnR4dCciKSkgewoKICAgICAg
ICAgICAgc2FmZV9pbnNlcnQoInNwZl9leHQiLCAiZmlsZW5hbWU9J2hvbGRlci50eHQnLCBj
b250ZW50PSdIb2xkZXIgdGV4dCBmaWxlLi4ueW91IG5lZWQgYXQgbGVhc3Qgb25lIGZpbGUg
aGVyZS4nIik7CgogICAgICAgIH0KCiAgICAgICAgc2FmZV9pbnNlcnQoCiAgICAgICAgICAg
ICd0eHBfcHJlZnMnLAogICAgICAgICAgICAicHJlZnNfaWQ9MSwKICAgICAgICAgICAgbmFt
ZT0nc3BmX2V4dF9kaXInLAogICAgICAgICAgICB2YWw9J2V4dF9maWxlcycsCiAgICAgICAg
ICAgIHR5cGU9MSwKICAgICAgICAgICAgZXZlbnQ9J2FkbWluJywKICAgICAgICAgICAgaHRt
bD0ndGV4dF9pbnB1dCcsCiAgICAgICAgICAgIHBvc2l0aW9uPTIyIgogICAgICAgICk7CiAg
ICB9Cn0KCi8qKgogKiBMaXN0IGZ1bmN0aW9uCiAqLwoKZnVuY3Rpb24gc3BmX2V4dF9saXN0
KCRjdXJyZW50KSB7CgogICAgJG91dFtdID0gc3RhcnRUYWJsZSgnbGlzdCcsICdsZWZ0Jyk7
CgogICAgJHJzID0gc2FmZV9yb3dzX3N0YXJ0KCdmaWxlbmFtZScsICdzcGZfZXh0JywgIjE9
MSIpOwoKICAgIGlmICgkcnMpIHsKCiAgICAgICAgd2hpbGUgKCRhID0gbmV4dFJvdygkcnMp
KSB7CiAgICAgICAgICAgIGV4dHJhY3QoJGEpOwogICAgICAgICAgICAkZWRpdCA9ICgkY3Vy
cmVudCAhPSAkZmlsZW5hbWUpID8gZUxpbmsoJ3NwZl9leHQnLCAnJywgJ2ZpbGVuYW1lJywg
JGZpbGVuYW1lLCAkZmlsZW5hbWUpIDogaHRtbHNwZWNpYWxjaGFycygkZmlsZW5hbWUpOwog
ICAgICAgICAgICAkZGVsZXRlID0gKCRmaWxlbmFtZSkgPyBkTGluaygnc3BmX2V4dCcsICdz
cGZfZXh0X2RlbGV0ZScsICdmaWxlbmFtZScsICRmaWxlbmFtZSkgOiAnJzsKICAgICAgICAg
ICAgJG91dFtdID0gdHIodGQoJGVkaXQpLnRkKCRkZWxldGUpKTsKICAgICAgICB9CgogICAg
ICAgICRvdXRbXSA9ICBlbmRUYWJsZSgpOwoKICAgICAgICByZXR1cm4gam9pbignJywgJG91
dCk7CgogICAgfQp9CgovKioKICogRWRpdCBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNwZl9l
eHRfZWRpdCgkbWVzc2FnZT0nJykgewoKICAgIHBhZ2V0b3AoZ1R4dCgnc3BmX2V4dF9maWxl
cycpLCRtZXNzYWdlKTsKICAgIGdsb2JhbCAkc3RlcCwgJHByZWZzOwogICAgc3BmX2V4dF9l
ZGl0X3JhdygpOwoKfQoKLyoqCiAqIEVkaXQgZnVuY3Rpb24gKHJhdykKICovCgpmdW5jdGlv
biBzcGZfZXh0X2VkaXRfcmF3KCkgewoKICAgIGdsb2JhbCAkZXZlbnQsICRzdGVwOwoKICAg
ICRmaXJzdCA9IHNhZmVfcm93KCdmaWxlbmFtZScsICdzcGZfZXh0JywgIjE9MSIpOwogICAg
JGZpcnN0X2ZpbGUgPSAkZmlyc3RbJ2ZpbGVuYW1lJ107CgogICAgZXh0cmFjdChncHNhKGFy
cmF5KCdmaWxlbmFtZScsICduZXduYW1lJywgJ2NvcHknLCAnc2F2ZW5ldycpKSk7CgogICAg
aWYgKCRzdGVwID09ICdzcGZfZXh0X2RlbGV0ZScgfHwgZW1wdHkoJGZpbGVuYW1lKSAmJiAk
c3RlcCAhPSAncG91cicgJiYgISRzYXZlbmV3KSB7CgogICAgICAgICRmaWxlbmFtZSA9ICRm
aXJzdF9maWxlOwoKICAgIH0KCiAgICBlbHNlaWYgKCgkY29weSB8fCAkc2F2ZW5ldykgJiYg
dHJpbShwcmVnX3JlcGxhY2UoJy9bPD4mIlwnXS8nLCAnJywgJG5ld25hbWUpKSkgewoKICAg
ICAgICAkZmlsZW5hbWUgPSAkbmV3bmFtZTsKCiAgICB9CgogICAgaWYgKGVtcHR5KCRmaWxl
bmFtZSkpIHsKCiAgICAgICAgJGJ1dHRvbnMgPSAnPGRpdiBjbGFzcz0iZWRpdC10aXRsZSI+
Jy4KICAgICAgICBnVHh0KCdzcGZfZmlsZV9uYW1lJykuJzogJwogICAgICAgIC5mSW5wdXQo
J3RleHQnLCduZXduYW1lJywnJywnZWRpdCcsJycsJycsMjApLgogICAgICAgIGhJbnB1dCgn
c2F2ZW5ldycsJ3NhdmVuZXcnKS4KICAgICAgICAnPC9kaXY+JzsKICAgICAgICAkZmlsZWNv
bnRlbnQgPSBncHMoJ3NwZl9leHQnKTsKCiAgICB9IGVsc2UgewoKICAgICAgICAkYnV0dG9u
cyA9ICc8ZGl2IGNsYXNzPSJlZGl0LXRpdGxlIj4nLmdUeHQoJ3NwZl9lZGl0X3NjcmlwdCcp
LnNwLnN0cm9uZyhodG1sc3BlY2lhbGNoYXJzKCRmaWxlbmFtZSkpLic8L2Rpdj4nOwogICAg
ICAgICRmaWxlY29udGVudCA9IGZldGNoKCJjb250ZW50Iiwnc3BmX2V4dCcsJ2ZpbGVuYW1l
JywkZmlsZW5hbWUpOwoKICAgIH0KCiAgICBpZiAoIWVtcHR5KCRmaWxlbmFtZSkpIHsKCiAg
ICAgICAgJGNvcHkgPSAnPHNwYW4gY2xhc3M9ImNvcHktYXMiPjxsYWJlbCBmb3I9ImNvcHkt
ZmlsZSI+Jy5nVHh0KCdzcGZfY29weV9maWxlJykuJzwvbGFiZWw+Jy5zcC5mSW5wdXQoJ3Rl
eHQnLCAnbmV3bmFtZScsICcnLCAnZWRpdCcsICcnLCAnJywgJycsICcnLCAnY29weS1maWxl
Jykuc3AuCiAgICAgICAgICAgIGZJbnB1dCgnc3VibWl0JywgJ2NvcHknLCBnVHh0KCdjb3B5
JyksICdzbWFsbGVyYm94JykuJzwvc3Bhbj4nOwoKICAgIH0gZWxzZSB7CgogICAgICAgICRj
b3B5ID0gJyc7CgogICAgfQoKICAgICRyaWdodCA9CiAgICAnPGRpdiBpZD0iY29udGVudF9z
d2l0Y2hlciI+Jy4KICAgIGhlZChnVHh0KCdzcGZfYWxsX2ZpbGVzJyksMikuCiAgICBncmFm
KHNMaW5rKCdzcGZfZXh0JywgJ3BvdXInLCBnVHh0KCdzcGZfY3JlYXRlX25ld19maWxlJykp
LCAnIGNsYXNzPSJhY3Rpb24tY3JlYXRlIHNtYWxsZXJib3giJykuCiAgICBzcGZfZXh0X2xp
c3QoJGZpbGVuYW1lKS4KICAgICc8L2Rpdj4nOwoKICAgIGVjaG8KICAgICc8ZGl2IGlkPSIn
LiRldmVudC4nX2NvbnRhaW5lciIgY2xhc3M9InR4cC1jb250YWluZXIgdHhwLWVkaXQiPicu
CiAgICBzdGFydFRhYmxlKCdlZGl0JykuCiAgICB0cigKICAgICAgICB0ZCgKICAgICAgICAg
ICAgZm9ybSgKICAgICAgICAgICAgICAgICc8ZGl2IGlkPSJtYWluX2NvbnRlbnQiPicuCiAg
ICAgICAgICAgICAgICAkYnV0dG9ucy4KICAgICAgICAgICAgICAgICc8dGV4dGFyZWEgaWQ9
InNwZl9leHQiIGNsYXNzPSJjb2RlIiBuYW1lPSJzcGZfZXh0IiBjb2xzPSI3OCIgcm93cz0i
MzIiIHN0eWxlPSJtYXJnaW4tdG9wOiA2cHg7IHdpZHRoOiA3MDBweDsgaGVpZ2h0OiA1MTVw
eDsiPicuaHRtbHNwZWNpYWxjaGFycygkZmlsZWNvbnRlbnQpLic8L3RleHRhcmVhPicuYnIu
CiAgICAgICAgICAgICAgICBmSW5wdXQoJ3N1Ym1pdCcsJycsZ1R4dCgnc2F2ZScpLCdwdWJs
aXNoJykuCiAgICAgICAgICAgICAgICBlSW5wdXQoJ3NwZl9leHQnKS5zSW5wdXQoJ3NwZl9l
eHRfc2F2ZScpLgogICAgICAgICAgICAgICAgaElucHV0KCdmaWxlbmFtZScsJGZpbGVuYW1l
KQogICAgICAgICAgICAgICAgLiRjb3B5LgogICAgICAgICAgICAgICAgJzwvZGl2PicKICAg
ICAgICAgICAgLCAnJywgJycsICdwb3N0JywgJ2VkaXQtZm9ybScsICcnLCAnc3R5bGVfZm9y
bScpCiAgICAgICAgLCAnJywgJ2NvbHVtbicpLgogICAgICAgIHRkdGwoCiAgICAgICAgICAg
ICRyaWdodAogICAgICAgICwgJyBjbGFzcz0iY29sdW1uIicpCiAgICApLgogICAgZW5kVGFi
bGUoKS4KICAgICc8L2Rpdj4nOwp9CgovKioKICogQ29weSBmdW5jdGlvbgogKgogKi8KCmZ1
bmN0aW9uIHNwZl9leHRfY29weSgpIHsKCiAgICBleHRyYWN0KGdwc2EoYXJyYXkoJ29sZG5h
bWUnLCAnbmV3bmFtZScpKSk7CgogICAgJGNvbnRlbnQgPSBkb1NsYXNoKGZldGNoKCdjb250
ZW50JywgJ3NwZl9leHQnLCAnZmlsZW5hbWUnLCAkb2xkbmFtZSkpOwoKICAgICRycyA9IHNh
ZmVfaW5zZXJ0KCdzcGZfZXh0JywgImNvbnRlbnQgPSAnJGNvbnRlbnQnLCBmaWxlbmFtZSA9
ICciLmRvU2xhc2goJG5ld25hbWUpLiInIik7CgogICAgc3BmX2V4dF9lZGl0KAogICAgICAg
IGdUeHQoJ3NwZl9maWxlX2NyZWF0ZWQnLCBhcnJheSgne25hbWV9JyA9PiAkbmV3bmFtZSkp
CiAgICApOwp9CgovKioKICogU2F2ZSBmdW5jdGlvbgogKi8KCmZ1bmN0aW9uIHNwZl9leHRf
c2F2ZSgpIHsKCiAgICBleHRyYWN0KGdwc2EoYXJyYXkoJ2ZpbGVuYW1lJywnc3BmX2V4dCcs
J3NhdmVuZXcnLCduZXduYW1lJywnY29weScpKSk7CiAgICAkY29udGVudCA9IGRvU2xhc2go
JHNwZl9leHQpOwoKICAgIGlmICgkc2F2ZW5ldyBvciAkY29weSkgewoKICAgICAgICAkbmV3
bmFtZSA9IGRvU2xhc2godHJpbShwcmVnX3JlcGxhY2UoJy9bPD4mIlwnXS8nLCAnJywgZ3Bz
KCduZXduYW1lJykpKSk7CgogICAgICAgIGlmICgkbmV3bmFtZSBhbmQgc2FmZV9maWVsZCgn
ZmlsZW5hbWUnLCAnc3BmX2V4dCcsICJmaWxlbmFtZSA9ICckbmV3bmFtZSciKSkgewoKICAg
ICAgICAgICAgJG1lc3NhZ2UgPSBnVHh0KCdzcGZfZmlsZV9leGlzdHMnLCBhcnJheSgne25h
bWV9JyA9PiAkbmV3bmFtZSkpOwoKICAgICAgICAgICAgaWYgKCRzYXZlbmV3KSB7CgogICAg
ICAgICAgICAgICAgJF9QT1NUWyduZXduYW1lJ10gPSAnJzsKCiAgICAgICAgICAgIH0KCiAg
ICAgICAgfSBlbHNlaWYgKCRuZXduYW1lKSB7CgogICAgICAgICAgICBzYWZlX2luc2VydCgn
c3BmX2V4dCcsICJmaWxlbmFtZSA9ICciLiRuZXduYW1lLiInLCBjb250ZW50ID0gJyRjb250
ZW50JyIpOwoKICAgICAgICAgICAgJG1lc3NhZ2UgPSBnVHh0KCdzcGZfZmlsZV9jcmVhdGVk
JywgYXJyYXkoJ3tuYW1lfScgPT4gJG5ld25hbWUpKTsKCiAgICAgICAgICAgIHNwZl9leHRf
d3JpdGUoKTsKCiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICRtZXNzYWdlID0gYXJy
YXkoZ1R4dCgnc3BmX2ZpbGVfbmFtZV9yZXF1aXJlZCcpLCBFX0VSUk9SKTsKCiAgICAgICAg
fQoKICAgICAgICBzcGZfZXh0X2VkaXQoJG1lc3NhZ2UpOwoKICAgIH0gZWxzZSB7CgogICAg
ICAgIHNhZmVfdXBkYXRlKCdzcGZfZXh0JywgImNvbnRlbnQgPSAnJGNvbnRlbnQnIiwgImZp
bGVuYW1lID0gJyIuZG9TbGFzaCgkZmlsZW5hbWUpLiInIik7CgogICAgICAgICRtZXNzYWdl
ID0gZ1R4dCgnc3BmX2ZpbGVfdXBkYXRlZCcsIGFycmF5KCd7bmFtZX0nID0+ICRmaWxlbmFt
ZSkpOwoKICAgICAgICBzcGZfZXh0X3dyaXRlKCk7CgogICAgICAgIHNwZl9leHRfZWRpdCgk
bWVzc2FnZSk7CgogICAgfQoKfQoKLyoqCiAqIFdyaXRlIGZ1bmN0aW9uCiAqLwoKZnVuY3Rp
b24gc3BmX2V4dF93cml0ZSgpIHsKCiAgICBnbG9iYWwgJHByZWZzOwogICAgZXh0cmFjdChn
cHNhKGFycmF5KCdmaWxlbmFtZScsJ3NwZl9leHQnLCdzYXZlbmV3JywnbmV3bmFtZScsJ2Nv
cHknKSkpOwoKICAgICRmaWxlbmFtZSA9IChwcygnY29weScpIG9yIHBzKCdzYXZlbmV3Jykp
ID8gcHMoJ25ld25hbWUnKSA6IHBzKCdmaWxlbmFtZScpOwogICAgJGZpbGUgPSAkcHJlZnNb
J3BhdGhfdG9fc2l0ZSddLicvJy4kcHJlZnNbJ3NwZl9leHRfZGlyJ10uJy8nLnNhbml0aXpl
Rm9yRmlsZSgkZmlsZW5hbWUpOwoKICAgIGlmIChlbXB0eSgkcHJlZnNbJ3NwZl9leHRfZGly
J10pIG9yICEkZmlsZW5hbWUpIHsKCiAgICAgICAgcmV0dXJuOwoKICAgIH0gZWxzZSB7Cgog
ICAgJGNvbnRlbnRfcmF3ID0gZmV0Y2goImNvbnRlbnQiLCAic3BmX2V4dCIsICdmaWxlbmFt
ZScsICRmaWxlbmFtZSk7IC8vIE1vdmVkIGhlcmUgdG8gc2F2ZSBuZXdseS1jcmVhdGVkIGZp
bGVzCgogICAgICAgICRoYW5kbGUgPSBmb3BlbigkZmlsZSwgJ3diJyk7CiAgICAgICAgZndy
aXRlKCRoYW5kbGUsICRjb250ZW50X3Jhdyk7CiAgICAgICAgZmNsb3NlKCRoYW5kbGUpOwog
ICAgICAgIGNobW9kKCRmaWxlLCAwNjQ0KTsKICAgIH0KCn0KCi8qKgogKiBEZWxldGUgZnVu
Y3Rpb24KICovCgpmdW5jdGlvbiBzcGZfZXh0X2RlbGV0ZSgpIHsKCiAgICBnbG9iYWwgJHBy
ZWZzOwoKICAgICRmaWxlbmFtZSA9IHBzKCdmaWxlbmFtZScpOwogICAgJGZpbGUgPSAkcHJl
ZnNbJ3BhdGhfdG9fc2l0ZSddLicvJy4kcHJlZnNbJ3NwZl9leHRfZGlyJ10uJy8nLiRmaWxl
bmFtZTsKCiAgICAgICAgaWYgKCFlbXB0eSgkcHJlZnNbJ3NwZl9leHRfZGlyJ10pIGFuZCAk
ZmlsZW5hbWUpIHsKCiAgICAgICAgICAgIHNhZmVfZGVsZXRlKCdzcGZfZXh0JywgImZpbGVu
YW1lID0gJyIuZG9TbGFzaCgkZmlsZW5hbWUpLiInIik7CgogICAgICAgICAgICBAdW5saW5r
KCRmaWxlKTsKCiAgICAgICAgc3BmX2V4dF9lZGl0KAoKICAgICAgICAgICAgZ1R4dCgnc3Bm
X2ZpbGVfZGVsZXRlZCcsIGFycmF5KCd7bmFtZX0nID0+ICRmaWxlbmFtZSkpCiAgICAgICAg
KTsKCiAgICB9IGVsc2UgewogICAgICAgIHJldHVybjsKICAgIH0KCn0iO3M6MzoibWQ1Ijtz
OjMyOiIzODQzYzM2NjhiODY4NTg2YTc4MDg0NjE0ZjBmYjhhMCI7fQ==